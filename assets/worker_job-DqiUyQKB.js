var e=Object.create,t=Object.defineProperty,n=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,i=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,o=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),s=(e,i,o,s)=>{if(i&&typeof i==`object`||typeof i==`function`)for(var c=r(i),l=0,u=c.length,d;l<u;l++)d=c[l],!a.call(e,d)&&d!==o&&t(e,d,{get:(e=>i[e]).bind(null,d),enumerable:!(s=n(i,d))||s.enumerable});return e},c=(n,r,a)=>(a=n==null?{}:e(i(n)),s(r||!n||!n.__esModule?t(a,`default`,{value:n,enumerable:!0}):a,n)),l=e=>t=>c(t.default,e);async function u(e={}){var t;(function(){function e(e){e=e.split(`-`)[0];for(var t=e.split(`.`).slice(0,3);t.length<3;)t.push(`00`);return t=t.map((e,t,n)=>e.padStart(2,`0`)),t.join(``)}var t=e=>[e/1e4|0,(e/100|0)%100,e%100].join(`.`),n=2147483647,r=typeof process<`u`&&process?.versions?.node?e(process.versions.node):n;if(r<16e4)throw Error(`This emscripten-generated code requires node v${t(16e4)} (detected v${t(r)})`);var i=typeof navigator<`u`&&navigator?.userAgent?.includes(`Safari/`)&&navigator.userAgent.match(/Version\/(\d+\.?\d*\.?\d*)/)?e(navigator.userAgent.match(/Version\/(\d+\.?\d*\.?\d*)/)[1]):n;if(i<15e4)throw Error(`This emscripten-generated code requires Safari v${t(15e4)} (detected v${i})`);var a=typeof navigator<`u`&&navigator?.userAgent?.match(/Firefox\/(\d+(?:\.\d+)?)/)?parseFloat(navigator.userAgent.match(/Firefox\/(\d+(?:\.\d+)?)/)[1]):n;if(a<79)throw Error(`This emscripten-generated code requires Firefox v79 (detected v${a})`);var o=typeof navigator<`u`&&navigator?.userAgent?.match(/Chrome\/(\d+(?:\.\d+)?)/)?parseFloat(navigator.userAgent.match(/Chrome\/(\d+(?:\.\d+)?)/)[1]):n;if(o<85)throw Error(`This emscripten-generated code requires Chrome v85 (detected v${o})`)})();var n=e,r=!!globalThis.window,i=!!globalThis.WorkerGlobalScope,a=globalThis.process?.versions?.node&&globalThis.process?.type!=`renderer`,o=!r&&!a&&!i;if(a){let{createRequire:e}=await import(`./__vite-browser-external-C3nVRGGf.js`).then(l(1));var s=e(import.meta.url)}var c=`./this.program`,u=import.meta.url,d=``;function f(e){return n.locateFile?n.locateFile(e,d):d+e}var p,m;if(a){if(!(globalThis.process?.versions?.node&&globalThis.process?.type!=`renderer`))throw Error(`not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)`);var h=s(`fs`);u.startsWith(`file:`)&&(d=s(`path`).dirname(s(`url`).fileURLToPath(u))+`/`),m=e=>{e=ne(e)?new URL(e):e;var t=h.readFileSync(e);return v(Buffer.isBuffer(t)),t},p=async(e,t=!0)=>{e=ne(e)?new URL(e):e;var n=h.readFileSync(e,t?void 0:`utf8`);return v(t?Buffer.isBuffer(n):typeof n==`string`),n},process.argv.length>1&&(c=process.argv[1].replace(/\\/g,`/`)),process.argv.slice(2)}else if(!o)if(r||i){try{d=new URL(`.`,u).href}catch{}if(!(globalThis.window||globalThis.WorkerGlobalScope))throw Error(`not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)`);i&&(m=e=>{var t=new XMLHttpRequest;return t.open(`GET`,e,!1),t.responseType=`arraybuffer`,t.send(null),new Uint8Array(t.response)}),p=async e=>{if(ne(e))return new Promise((t,n)=>{var r=new XMLHttpRequest;r.open(`GET`,e,!0),r.responseType=`arraybuffer`,r.onload=()=>{if(r.status==200||r.status==0&&r.response){t(r.response);return}n(r.status)},r.onerror=n,r.send(null)});var t=await fetch(e,{credentials:`same-origin`});if(t.ok)return t.arrayBuffer();throw Error(t.status+` : `+t.url)}}else throw Error(`environment detection error`);var ee=console.log.bind(console),g=console.error.bind(console);v(!o,"shell environment detected but not enabled at build time.  Add `shell` to `-sENVIRONMENT` to enable.");var te;globalThis.WebAssembly||g(`no native wasm support detected`);var _=!1;function v(e,t){e||j(`Assertion failed`+(t?`: `+t:``))}var ne=e=>e.startsWith(`file://`);function y(){var e=Z();v((e&3)==0),e==0&&(e+=4),O[e>>2]=34821223,O[e+4>>2]=2310721022,O[0]=1668509029}function b(){if(!_){var e=Z();e==0&&(e+=4);var t=O[e>>2],n=O[e+4>>2];(t!=34821223||n!=2310721022)&&j(`Stack overflow! Stack cookie has been overwritten at ${Ee(e)}, expected hex dwords 0x89BACDFE and 0x2135467, but received ${Ee(n)} ${Ee(t)}`),O[0]!=1668509029&&j(`Runtime error: The application has corrupted its heap memory area (address zero)!`)}}(()=>{var e=new Int16Array(1),t=new Int8Array(e.buffer);e[0]=25459,(t[0]!==115||t[1]!==99)&&j(`Runtime error: expected the system to be little-endian! (Run with -sSUPPORT_BIG_ENDIAN to bypass)`)})();function re(e){Object.getOwnPropertyDescriptor(n,e)||Object.defineProperty(n,e,{configurable:!0,set(){j(`Attempt to set \`Module.${e}\` after it has already been processed.  This can happen, for example, when code is injected via '--post-js' rather than '--pre-js'`)}})}function x(e){return()=>v(!1,`call to '${e}' via reference taken before Wasm module initialization`)}function S(e){Object.getOwnPropertyDescriptor(n,e)&&j(`\`Module.${e}\` was supplied but \`${e}\` not included in INCOMING_MODULE_JS_API`)}function C(e){return e===`FS_createPath`||e===`FS_createDataFile`||e===`FS_createPreloadedFile`||e===`FS_preloadFile`||e===`FS_unlink`||e===`addRunDependency`||e===`FS_createLazyFile`||e===`FS_createDevice`||e===`removeRunDependency`}function w(e){ie(e)}function ie(e){Object.getOwnPropertyDescriptor(n,e)||Object.defineProperty(n,e,{configurable:!0,get(){var t=`'${e}' was not exported. add it to EXPORTED_RUNTIME_METHODS (see the Emscripten FAQ)`;C(e)&&(t+=`. Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you`),j(t)}})}var ae,oe,T,E,se,D,O,ce,k,A,le=!1;function ue(){var e=Ct.buffer;T=new Int8Array(e),se=new Int16Array(e),E=new Uint8Array(e),new Uint16Array(e),D=new Int32Array(e),O=new Uint32Array(e),ce=new Float32Array(e),k=new Float64Array(e),A=new BigInt64Array(e),new BigUint64Array(e)}v(globalThis.Int32Array&&globalThis.Float64Array&&Int32Array.prototype.subarray&&Int32Array.prototype.set,`JS engine does not provide full typed array support`);function de(){if(n.preRun)for(typeof n.preRun==`function`&&(n.preRun=[n.preRun]);n.preRun.length;)we(n.preRun.shift());re(`preRun`),Se(P)}function fe(){v(!le),le=!0,b(),!n.noFSInit&&!J.initialized&&J.init(),B.init(),Ot.__wasm_call_ctors(),J.ignorePermissions=!1}function pe(){if(b(),n.postRun)for(typeof n.postRun==`function`&&(n.postRun=[n.postRun]);n.postRun.length;)Ce(n.postRun.shift());re(`postRun`),Se(N)}function j(e){n.onAbort?.(e),e=`Aborted(`+e+`)`,g(e),_=!0;var t=new WebAssembly.RuntimeError(e);throw oe?.(t),t}function M(e,t){return(...n)=>{v(le,`native function \`${e}\` called before runtime initialization`);var r=Ot[e];return v(r,`exported native function \`${e}\` not found`),v(n.length<=t,`native function \`${e}\` called with ${n.length} args but expects ${t}`),r(...n)}}var me;function he(){return n.locateFile?f(`hopefox.wasm`):new URL(`hopefox.wasm`,``+import.meta.url).href}function ge(e){if(e==me&&te)return new Uint8Array(te);if(m)return m(e);throw`both async and sync fetching of the wasm failed`}async function _e(e){if(!te)try{var t=await p(e);return new Uint8Array(t)}catch{}return ge(e)}async function ve(e,t){try{var n=await _e(e);return await WebAssembly.instantiate(n,t)}catch(t){g(`failed to asynchronously prepare wasm: ${t}`),ne(e)&&g(`warning: Loading from a file URI (${e}) is not supported in most browsers. See https://emscripten.org/docs/getting_started/FAQ.html#how-do-i-run-a-local-webserver-for-testing-why-does-my-program-stall-in-downloading-or-preparing`),j(t)}}async function ye(e,t,n){if(!e&&!ne(t)&&!a)try{var r=fetch(t,{credentials:`same-origin`});return await WebAssembly.instantiateStreaming(r,n)}catch(e){g(`wasm streaming compile failed: ${e}`),g(`falling back to ArrayBuffer instantiation`)}return ve(t,n)}function be(){return{env:wt,wasi_snapshot_preview1:wt}}async function xe(){function e(e,t){return Ot=e.exports,Q(Ot),ue(),Ot}var t=n;function r(r){return v(n===t,`the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?`),t=null,e(r.instance)}var i=be();return n.instantiateWasm?new Promise((t,r)=>{try{n.instantiateWasm(i,(n,r)=>{t(e(n,r))})}catch(e){g(`Module.instantiateWasm callback failed with error: ${e}`),r(e)}}):(me??=he(),r(await ye(te,me,i)))}var Se=e=>{for(;e.length>0;)e.shift()(n)},N=[],Ce=e=>N.push(e),P=[],we=e=>P.push(e);function Te(e,t=`i8`){switch(t.endsWith(`*`)&&(t=`*`),t){case`i1`:return T[e];case`i8`:return T[e];case`i16`:return se[e>>1];case`i32`:return D[e>>2];case`i64`:return A[e>>3];case`float`:return ce[e>>2];case`double`:return k[e>>3];case`*`:return O[e>>2];default:j(`invalid type for getValue: ${t}`)}}var Ee=e=>(v(typeof e==`number`,`ptrToString expects a number, got ${typeof e}`),e>>>=0,`0x`+e.toString(16).padStart(8,`0`));function De(e,t,n=`i8`){switch(n.endsWith(`*`)&&(n=`*`),n){case`i1`:T[e]=t;break;case`i8`:T[e]=t;break;case`i16`:se[e>>1]=t;break;case`i32`:D[e>>2]=t;break;case`i64`:A[e>>3]=BigInt(t);break;case`float`:ce[e>>2]=t;break;case`double`:k[e>>3]=t;break;case`*`:O[e>>2]=t;break;default:j(`invalid type for setValue: ${n}`)}}var Oe=e=>{Oe.shown||={},Oe.shown[e]||(Oe.shown[e]=1,a&&(e=`warning: `+e),g(e))},ke=globalThis.TextDecoder&&new TextDecoder,Ae=(e,t,n,r)=>{var i=t+n;if(r)return i;for(;e[t]&&!(t>=i);)++t;return t},F=(e,t=0,n,r)=>{var i=Ae(e,t,n,r);if(i-t>16&&e.buffer&&ke)return ke.decode(e.subarray(t,i));for(var a=``;t<i;){var o=e[t++];if(!(o&128)){a+=String.fromCharCode(o);continue}var s=e[t++]&63;if((o&224)==192){a+=String.fromCharCode((o&31)<<6|s);continue}var c=e[t++]&63;if((o&240)==224?o=(o&15)<<12|s<<6|c:((o&248)!=240&&Oe(`Invalid UTF-8 leading byte `+Ee(o)+` encountered when deserializing a UTF-8 string in wasm memory to a JS string!`),o=(o&7)<<18|s<<12|c<<6|e[t++]&63),o<65536)a+=String.fromCharCode(o);else{var l=o-65536;a+=String.fromCharCode(55296|l>>10,56320|l&1023)}}return a},I=(e,t,n)=>(v(typeof e==`number`,`UTF8ToString expects a number (got ${typeof e})`),e?F(E,e,t,n):``),je=(e,t,n,r)=>j(`Assertion failed: ${I(e)}, at: `+[t?I(t):`unknown filename`,n,r?I(r):`unknown function`]);class Me{constructor(e){this.excPtr=e,this.ptr=e-24}set_type(e){O[this.ptr+4>>2]=e}get_type(){return O[this.ptr+4>>2]}set_destructor(e){O[this.ptr+8>>2]=e}get_destructor(){return O[this.ptr+8>>2]}set_caught(e){e=e?1:0,T[this.ptr+12]=e}get_caught(){return T[this.ptr+12]!=0}set_rethrown(e){e=e?1:0,T[this.ptr+13]=e}get_rethrown(){return T[this.ptr+13]!=0}init(e,t){this.set_adjusted_ptr(0),this.set_type(e),this.set_destructor(t)}set_adjusted_ptr(e){O[this.ptr+16>>2]=e}get_adjusted_ptr(){return O[this.ptr+16>>2]}}var Ne=0,Pe=(e,t,n)=>{new Me(e).init(t,n),Ne++,v(!1,`Exception thrown, but exception catching is not enabled. Compile with -sNO_DISABLE_EXCEPTION_CATCHING or -sEXCEPTION_CATCHING_ALLOWED=[..] to catch.`)},Fe=()=>j(`native code called abort()`),L=(e,t,n,r)=>{if(v(typeof e==`string`,`stringToUTF8Array expects a string (got ${typeof e})`),!(r>0))return 0;for(var i=n,a=n+r-1,o=0;o<e.length;++o){var s=e.codePointAt(o);if(s<=127){if(n>=a)break;t[n++]=s}else if(s<=2047){if(n+1>=a)break;t[n++]=192|s>>6,t[n++]=128|s&63}else if(s<=65535){if(n+2>=a)break;t[n++]=224|s>>12,t[n++]=128|s>>6&63,t[n++]=128|s&63}else{if(n+3>=a)break;s>1114111&&Oe(`Invalid Unicode code point `+Ee(s)+` encountered when serializing a JS string to a UTF-8 string in wasm memory! (Valid unicode code points should be in range 0-0x10FFFF).`),t[n++]=240|s>>18,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|s&63,o++}}return t[n]=0,n-i},R=(e,t,n)=>(v(typeof n==`number`,`stringToUTF8(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!`),L(e,E,t,n)),Ie=e=>{for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);r<=127?t++:r<=2047?t+=2:r>=55296&&r<=57343?(t+=4,++n):t+=3}return t},Le=(e,t,n,r)=>{var i=new Date().getFullYear(),a=new Date(i,0,1),o=new Date(i,6,1),s=a.getTimezoneOffset(),c=o.getTimezoneOffset(),l=Math.max(s,c);O[e>>2]=l*60,D[t>>2]=Number(s!=c);var u=e=>{var t=e>=0?`-`:`+`,n=Math.abs(e);return`UTC${t}${String(Math.floor(n/60)).padStart(2,`0`)}${String(n%60).padStart(2,`0`)}`},d=u(s),f=u(c);v(d),v(f),v(Ie(d)<=16,`timezone name truncated to fit in TZNAME_MAX (${d})`),v(Ie(f)<=16,`timezone name truncated to fit in TZNAME_MAX (${f})`),c<s?(R(d,n,17),R(f,r,17)):(R(d,r,17),R(f,n,17))},Re=()=>2147483648,ze=(e,t)=>(v(t,`alignment argument is required`),Math.ceil(e/t)*t),Be=e=>{var t=Ct.buffer.byteLength,n=(e-t+65535)/65536|0;try{return Ct.grow(n),ue(),1}catch(n){g(`growMemory: Attempted to grow heap from ${t} bytes to ${e} bytes, but got error: ${n}`)}},Ve=e=>{var t=E.length;e>>>=0,v(e>t);var n=Re();if(e>n)return g(`Cannot enlarge memory, requested ${e} bytes, but the limit is ${n} bytes!`),!1;for(var r=1;r<=4;r*=2){var i=t*(1+.2/r);i=Math.min(i,e+100663296);var a=Math.min(n,ze(Math.max(e,i),65536));if(Be(a))return!0}return g(`Failed to grow the heap from ${t} bytes to ${a} bytes, not enough memory!`),!1},He={},Ue=()=>c||`./this.program`,We=()=>{if(!We.strings){var e={USER:`web_user`,LOGNAME:`web_user`,PATH:`/`,PWD:`/`,HOME:`/home/web_user`,LANG:(typeof navigator==`object`&&navigator.language||`C`).replace(`-`,`_`)+`.UTF-8`,_:Ue()};for(var t in He)He[t]===void 0?delete e[t]:e[t]=He[t];var n=[];for(var t in e)n.push(`${t}=${e[t]}`);We.strings=n}return We.strings},Ge=(e,t)=>{var n=0,r=0;for(var i of We()){var a=t+n;O[e+r>>2]=a,n+=R(i,a,1/0)+1,r+=4}return 0},Ke=(e,t)=>{var n=We();O[e>>2]=n.length;var r=0;for(var i of n)r+=Ie(i)+1;return O[t>>2]=r,0},z={isAbs:e=>e.charAt(0)===`/`,splitPath:e=>/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1),normalizeArray:(e,t)=>{for(var n=0,r=e.length-1;r>=0;r--){var i=e[r];i===`.`?e.splice(r,1):i===`..`?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n;n--)e.unshift(`..`);return e},normalize:e=>{var t=z.isAbs(e),n=e.slice(-1)===`/`;return e=z.normalizeArray(e.split(`/`).filter(e=>!!e),!t).join(`/`),!e&&!t&&(e=`.`),e&&n&&(e+=`/`),(t?`/`:``)+e},dirname:e=>{var t=z.splitPath(e),n=t[0],r=t[1];return!n&&!r?`.`:(r&&=r.slice(0,-1),n+r)},basename:e=>e&&e.match(/([^\/]+|\/)\/*$/)[1],join:(...e)=>z.normalize(e.join(`/`)),join2:(e,t)=>z.normalize(e+`/`+t)},qe=()=>{if(a){var e=s(`crypto`);return t=>e.randomFillSync(t)}return e=>crypto.getRandomValues(e)},Je=e=>{(Je=qe())(e)},Ye={resolve:(...e)=>{for(var t=``,n=!1,r=e.length-1;r>=-1&&!n;r--){var i=r>=0?e[r]:J.cwd();if(typeof i!=`string`)throw TypeError(`Arguments to path.resolve must be strings`);if(!i)return``;t=i+`/`+t,n=z.isAbs(i)}return t=z.normalizeArray(t.split(`/`).filter(e=>!!e),!n).join(`/`),(n?`/`:``)+t||`.`},relative:(e,t)=>{e=Ye.resolve(e).slice(1),t=Ye.resolve(t).slice(1);function n(e){for(var t=0;t<e.length&&e[t]===``;t++);for(var n=e.length-1;n>=0&&e[n]===``;n--);return t>n?[]:e.slice(t,n-t+1)}for(var r=n(e.split(`/`)),i=n(t.split(`/`)),a=Math.min(r.length,i.length),o=a,s=0;s<a;s++)if(r[s]!==i[s]){o=s;break}for(var c=[],s=o;s<r.length;s++)c.push(`..`);return c=c.concat(i.slice(o)),c.join(`/`)}},Xe=[],Ze=(e,t,n)=>{var r=n>0?n:Ie(e)+1,i=Array(r),a=L(e,i,0,i.length);return t&&(i.length=a),i},Qe=()=>{if(!Xe.length){var e=null;if(a){var t=256,n=Buffer.alloc(t),r=0,i=process.stdin.fd;try{r=h.readSync(i,n,0,t)}catch(e){if(e.toString().includes(`EOF`))r=0;else throw e}r>0&&(e=n.slice(0,r).toString(`utf-8`))}else globalThis.window?.prompt&&(e=window.prompt(`Input: `),e!==null&&(e+=`
`));if(!e)return null;Xe=Ze(e,!0)}return Xe.shift()},B={ttys:[],init(){},shutdown(){},register(e,t){B.ttys[e]={input:[],output:[],ops:t},J.registerDevice(e,B.stream_ops)},stream_ops:{open(e){var t=B.ttys[e.node.rdev];if(!t)throw new J.ErrnoError(43);e.tty=t,e.seekable=!1},close(e){e.tty.ops.fsync(e.tty)},fsync(e){e.tty.ops.fsync(e.tty)},read(e,t,n,r,i){if(!e.tty||!e.tty.ops.get_char)throw new J.ErrnoError(60);for(var a=0,o=0;o<r;o++){var s;try{s=e.tty.ops.get_char(e.tty)}catch{throw new J.ErrnoError(29)}if(s===void 0&&a===0)throw new J.ErrnoError(6);if(s==null)break;a++,t[n+o]=s}return a&&(e.node.atime=Date.now()),a},write(e,t,n,r,i){if(!e.tty||!e.tty.ops.put_char)throw new J.ErrnoError(60);try{for(var a=0;a<r;a++)e.tty.ops.put_char(e.tty,t[n+a])}catch{throw new J.ErrnoError(29)}return r&&(e.node.mtime=e.node.ctime=Date.now()),a}},default_tty_ops:{get_char(e){return Qe()},put_char(e,t){t===null||t===10?(ee(F(e.output)),e.output=[]):t!=0&&e.output.push(t)},fsync(e){e.output?.length>0&&(ee(F(e.output)),e.output=[])},ioctl_tcgets(e){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(e,t,n){return 0},ioctl_tiocgwinsz(e){return[24,80]}},default_tty1_ops:{put_char(e,t){t===null||t===10?(g(F(e.output)),e.output=[]):t!=0&&e.output.push(t)},fsync(e){e.output?.length>0&&(g(F(e.output)),e.output=[])}}},$e=e=>{j("internal error: mmapAlloc called but `emscripten_builtin_memalign` native symbol not exported")},V={ops_table:null,mount(e){return V.createNode(null,`/`,16895,0)},createNode(e,t,n,r){if(J.isBlkdev(n)||J.isFIFO(n))throw new J.ErrnoError(63);V.ops_table||={dir:{node:{getattr:V.node_ops.getattr,setattr:V.node_ops.setattr,lookup:V.node_ops.lookup,mknod:V.node_ops.mknod,rename:V.node_ops.rename,unlink:V.node_ops.unlink,rmdir:V.node_ops.rmdir,readdir:V.node_ops.readdir,symlink:V.node_ops.symlink},stream:{llseek:V.stream_ops.llseek}},file:{node:{getattr:V.node_ops.getattr,setattr:V.node_ops.setattr},stream:{llseek:V.stream_ops.llseek,read:V.stream_ops.read,write:V.stream_ops.write,mmap:V.stream_ops.mmap,msync:V.stream_ops.msync}},link:{node:{getattr:V.node_ops.getattr,setattr:V.node_ops.setattr,readlink:V.node_ops.readlink},stream:{}},chrdev:{node:{getattr:V.node_ops.getattr,setattr:V.node_ops.setattr},stream:J.chrdev_stream_ops}};var i=J.createNode(e,t,n,r);return J.isDir(i.mode)?(i.node_ops=V.ops_table.dir.node,i.stream_ops=V.ops_table.dir.stream,i.contents={}):J.isFile(i.mode)?(i.node_ops=V.ops_table.file.node,i.stream_ops=V.ops_table.file.stream,i.usedBytes=0,i.contents=null):J.isLink(i.mode)?(i.node_ops=V.ops_table.link.node,i.stream_ops=V.ops_table.link.stream):J.isChrdev(i.mode)&&(i.node_ops=V.ops_table.chrdev.node,i.stream_ops=V.ops_table.chrdev.stream),i.atime=i.mtime=i.ctime=Date.now(),e&&(e.contents[t]=i,e.atime=e.mtime=e.ctime=i.atime),i},getFileDataAsTypedArray(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array},expandFileStorage(e,t){var n=e.contents?e.contents.length:0;if(!(n>=t)){t=Math.max(t,n*(n<1024*1024?2:1.125)>>>0),n!=0&&(t=Math.max(t,256));var r=e.contents;e.contents=new Uint8Array(t),e.usedBytes>0&&e.contents.set(r.subarray(0,e.usedBytes),0)}},resizeFileStorage(e,t){if(e.usedBytes!=t)if(t==0)e.contents=null,e.usedBytes=0;else{var n=e.contents;e.contents=new Uint8Array(t),n&&e.contents.set(n.subarray(0,Math.min(t,e.usedBytes))),e.usedBytes=t}},node_ops:{getattr(e){var t={};return t.dev=J.isChrdev(e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,J.isDir(e.mode)?t.size=4096:J.isFile(e.mode)?t.size=e.usedBytes:J.isLink(e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.atime),t.mtime=new Date(e.mtime),t.ctime=new Date(e.ctime),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},setattr(e,t){for(let n of[`mode`,`atime`,`mtime`,`ctime`])t[n]!=null&&(e[n]=t[n]);t.size!==void 0&&V.resizeFileStorage(e,t.size)},lookup(e,t){throw new J.ErrnoError(44)},mknod(e,t,n,r){return V.createNode(e,t,n,r)},rename(e,t,n){var r;try{r=J.lookupNode(t,n)}catch{}if(r){if(J.isDir(e.mode))for(var i in r.contents)throw new J.ErrnoError(55);J.hashRemoveNode(r)}delete e.parent.contents[e.name],t.contents[n]=e,e.name=n,t.ctime=t.mtime=e.parent.ctime=e.parent.mtime=Date.now()},unlink(e,t){delete e.contents[t],e.ctime=e.mtime=Date.now()},rmdir(e,t){for(var n in J.lookupNode(e,t).contents)throw new J.ErrnoError(55);delete e.contents[t],e.ctime=e.mtime=Date.now()},readdir(e){return[`.`,`..`,...Object.keys(e.contents)]},symlink(e,t,n){var r=V.createNode(e,t,41471,0);return r.link=n,r},readlink(e){if(!J.isLink(e.mode))throw new J.ErrnoError(28);return e.link}},stream_ops:{read(e,t,n,r,i){var a=e.node.contents;if(i>=e.node.usedBytes)return 0;var o=Math.min(e.node.usedBytes-i,r);if(v(o>=0),o>8&&a.subarray)t.set(a.subarray(i,i+o),n);else for(var s=0;s<o;s++)t[n+s]=a[i+s];return o},write(e,t,n,r,i,a){if(v(!(t instanceof ArrayBuffer)),t.buffer===T.buffer&&(a=!1),!r)return 0;var o=e.node;if(o.mtime=o.ctime=Date.now(),t.subarray&&(!o.contents||o.contents.subarray)){if(a)return v(i===0,`canOwn must imply no weird position inside the file`),o.contents=t.subarray(n,n+r),o.usedBytes=r,r;if(o.usedBytes===0&&i===0)return o.contents=t.slice(n,n+r),o.usedBytes=r,r;if(i+r<=o.usedBytes)return o.contents.set(t.subarray(n,n+r),i),r}if(V.expandFileStorage(o,i+r),o.contents.subarray&&t.subarray)o.contents.set(t.subarray(n,n+r),i);else for(var s=0;s<r;s++)o.contents[i+s]=t[n+s];return o.usedBytes=Math.max(o.usedBytes,i+r),r},llseek(e,t,n){var r=t;if(n===1?r+=e.position:n===2&&J.isFile(e.node.mode)&&(r+=e.node.usedBytes),r<0)throw new J.ErrnoError(28);return r},mmap(e,t,n,r,i){if(!J.isFile(e.node.mode))throw new J.ErrnoError(43);var a,o,s=e.node.contents;if(!(i&2)&&s&&s.buffer===T.buffer)o=!1,a=s.byteOffset;else{if(o=!0,a=$e(t),!a)throw new J.ErrnoError(48);s&&((n>0||n+t<s.length)&&(s=s.subarray?s.subarray(n,n+t):Array.prototype.slice.call(s,n,n+t)),T.set(s,a))}return{ptr:a,allocated:o}},msync(e,t,n,r,i){return V.stream_ops.write(e,t,0,r,n,!1),0}}},et=e=>{var t={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[e];if(t===void 0)throw Error(`Unknown file open mode: ${e}`);return t},H=(e,t)=>{var n=0;return e&&(n|=365),t&&(n|=146),n},tt=e=>I(xt(e)),nt={EPERM:63,ENOENT:44,ESRCH:71,EINTR:27,EIO:29,ENXIO:60,E2BIG:1,ENOEXEC:45,EBADF:8,ECHILD:12,EAGAIN:6,EWOULDBLOCK:6,ENOMEM:48,EACCES:2,EFAULT:21,ENOTBLK:105,EBUSY:10,EEXIST:20,EXDEV:75,ENODEV:43,ENOTDIR:54,EISDIR:31,EINVAL:28,ENFILE:41,EMFILE:33,ENOTTY:59,ETXTBSY:74,EFBIG:22,ENOSPC:51,ESPIPE:70,EROFS:69,EMLINK:34,EPIPE:64,EDOM:18,ERANGE:68,ENOMSG:49,EIDRM:24,ECHRNG:106,EL2NSYNC:156,EL3HLT:107,EL3RST:108,ELNRNG:109,EUNATCH:110,ENOCSI:111,EL2HLT:112,EDEADLK:16,ENOLCK:46,EBADE:113,EBADR:114,EXFULL:115,ENOANO:104,EBADRQC:103,EBADSLT:102,EDEADLOCK:16,EBFONT:101,ENOSTR:100,ENODATA:116,ETIME:117,ENOSR:118,ENONET:119,ENOPKG:120,EREMOTE:121,ENOLINK:47,EADV:122,ESRMNT:123,ECOMM:124,EPROTO:65,EMULTIHOP:36,EDOTDOT:125,EBADMSG:9,ENOTUNIQ:126,EBADFD:127,EREMCHG:128,ELIBACC:129,ELIBBAD:130,ELIBSCN:131,ELIBMAX:132,ELIBEXEC:133,ENOSYS:52,ENOTEMPTY:55,ENAMETOOLONG:37,ELOOP:32,EOPNOTSUPP:138,EPFNOSUPPORT:139,ECONNRESET:15,ENOBUFS:42,EAFNOSUPPORT:5,EPROTOTYPE:67,ENOTSOCK:57,ENOPROTOOPT:50,ESHUTDOWN:140,ECONNREFUSED:14,EADDRINUSE:3,ECONNABORTED:13,ENETUNREACH:40,ENETDOWN:38,ETIMEDOUT:73,EHOSTDOWN:142,EHOSTUNREACH:23,EINPROGRESS:26,EALREADY:7,EDESTADDRREQ:17,EMSGSIZE:35,EPROTONOSUPPORT:66,ESOCKTNOSUPPORT:137,EADDRNOTAVAIL:4,ENETRESET:39,EISCONN:30,ENOTCONN:53,ETOOMANYREFS:141,EUSERS:136,EDQUOT:19,ESTALE:72,ENOTSUP:138,ENOMEDIUM:148,EILSEQ:25,EOVERFLOW:61,ECANCELED:11,ENOTRECOVERABLE:56,EOWNERDEAD:62,ESTRPIPE:135},rt=async e=>{var t=await p(e);return v(t,`Loading data file "${e}" failed (no arrayBuffer).`),new Uint8Array(t)},it=(...e)=>J.createDataFile(...e),at=e=>{for(var t=e;;){if(!ot[e])return e;e=t+Math.random()}},U=0,W=null,ot={},G=null,st=e=>{if(U--,n.monitorRunDependencies?.(U),v(e,`removeRunDependency requires an ID`),v(ot[e]),delete ot[e],U==0&&(G!==null&&(clearInterval(G),G=null),W)){var t=W;W=null,t()}},ct=e=>{U++,n.monitorRunDependencies?.(U),v(e,`addRunDependency requires an ID`),v(!ot[e]),ot[e]=1,G===null&&globalThis.setInterval&&(G=setInterval(()=>{if(_){clearInterval(G),G=null;return}var e=!1;for(var t in ot)e||(e=!0,g(`still waiting on run dependencies:`)),g(`dependency: ${t}`);e&&g(`(end of list)`)},1e4),G.unref?.())},lt=[],ut=async(e,t)=>{typeof Browser<`u`&&Browser.init();for(var n of lt)if(n.canHandle(t))return v(n.handle.constructor.name===`AsyncFunction`,`Filesystem plugin handlers must be async functions (See #24914)`),n.handle(e,t);return e},K=async(e,t,n,r,i,a,o,s)=>{var c=t?Ye.resolve(z.join2(e,t)):e,l=at(`cp ${c}`);ct(l);try{var u=n;typeof n==`string`&&(u=await rt(n)),u=await ut(u,c),s?.(),a||it(e,t,u,r,i,o)}finally{st(l)}},q=(e,t,n,r,i,a,o,s,c,l)=>{K(e,t,n,r,i,s,c,l).then(a).catch(o)},J={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:`/`,initialized:!1,ignorePermissions:!0,filesystems:null,syncFSRequests:0,readFiles:{},ErrnoError:class extends Error{name=`ErrnoError`;constructor(e){for(var t in super(le?tt(e):``),this.errno=e,nt)if(nt[t]===e){this.code=t;break}}},FSStream:class{shared={};get object(){return this.node}set object(e){this.node=e}get isRead(){return(this.flags&2097155)!=1}get isWrite(){return(this.flags&2097155)!=0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(e){this.shared.flags=e}get position(){return this.shared.position}set position(e){this.shared.position=e}},FSNode:class{node_ops={};stream_ops={};readMode=365;writeMode=146;mounted=null;constructor(e,t,n,r){e||=this,this.parent=e,this.mount=e.mount,this.id=J.nextInode++,this.name=t,this.mode=n,this.rdev=r,this.atime=this.mtime=this.ctime=Date.now()}get read(){return(this.mode&this.readMode)===this.readMode}set read(e){e?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(e){e?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return J.isDir(this.mode)}get isDevice(){return J.isChrdev(this.mode)}},lookupPath(e,t={}){if(!e)throw new J.ErrnoError(44);t.follow_mount??=!0,z.isAbs(e)||(e=J.cwd()+`/`+e);linkloop:for(var n=0;n<40;n++){for(var r=e.split(`/`).filter(e=>!!e),i=J.root,a=`/`,o=0;o<r.length;o++){var s=o===r.length-1;if(s&&t.parent)break;if(r[o]!==`.`){if(r[o]===`..`){if(a=z.dirname(a),J.isRoot(i)){e=a+`/`+r.slice(o+1).join(`/`),n--;continue linkloop}else i=i.parent;continue}a=z.join2(a,r[o]);try{i=J.lookupNode(i,r[o])}catch(e){if(e?.errno===44&&s&&t.noent_okay)return{path:a};throw e}if(J.isMountpoint(i)&&(!s||t.follow_mount)&&(i=i.mounted.root),J.isLink(i.mode)&&(!s||t.follow)){if(!i.node_ops.readlink)throw new J.ErrnoError(52);var c=i.node_ops.readlink(i);z.isAbs(c)||(c=z.dirname(a)+`/`+c),e=c+`/`+r.slice(o+1).join(`/`);continue linkloop}}}return{path:a,node:i}}throw new J.ErrnoError(32)},getPath(e){for(var t;;){if(J.isRoot(e)){var n=e.mount.mountpoint;return t?n[n.length-1]===`/`?n+t:`${n}/${t}`:n}t=t?`${e.name}/${t}`:e.name,e=e.parent}},hashName(e,t){for(var n=0,r=0;r<t.length;r++)n=(n<<5)-n+t.charCodeAt(r)|0;return(e+n>>>0)%J.nameTable.length},hashAddNode(e){var t=J.hashName(e.parent.id,e.name);e.name_next=J.nameTable[t],J.nameTable[t]=e},hashRemoveNode(e){var t=J.hashName(e.parent.id,e.name);if(J.nameTable[t]===e)J.nameTable[t]=e.name_next;else for(var n=J.nameTable[t];n;){if(n.name_next===e){n.name_next=e.name_next;break}n=n.name_next}},lookupNode(e,t){var n=J.mayLookup(e);if(n)throw new J.ErrnoError(n);for(var r=J.hashName(e.id,t),i=J.nameTable[r];i;i=i.name_next){var a=i.name;if(i.parent.id===e.id&&a===t)return i}return J.lookup(e,t)},createNode(e,t,n,r){v(typeof e==`object`);var i=new J.FSNode(e,t,n,r);return J.hashAddNode(i),i},destroyNode(e){J.hashRemoveNode(e)},isRoot(e){return e===e.parent},isMountpoint(e){return!!e.mounted},isFile(e){return(e&61440)==32768},isDir(e){return(e&61440)==16384},isLink(e){return(e&61440)==40960},isChrdev(e){return(e&61440)==8192},isBlkdev(e){return(e&61440)==24576},isFIFO(e){return(e&61440)==4096},isSocket(e){return(e&49152)==49152},flagsToPermissionString(e){var t=[`r`,`w`,`rw`][e&3];return e&512&&(t+=`w`),t},nodePermissions(e,t){return J.ignorePermissions?0:t.includes(`r`)&&!(e.mode&292)||t.includes(`w`)&&!(e.mode&146)||t.includes(`x`)&&!(e.mode&73)?2:0},mayLookup(e){return J.isDir(e.mode)?J.nodePermissions(e,`x`)||(e.node_ops.lookup?0:2):54},mayCreate(e,t){if(!J.isDir(e.mode))return 54;try{return J.lookupNode(e,t),20}catch{}return J.nodePermissions(e,`wx`)},mayDelete(e,t,n){var r;try{r=J.lookupNode(e,t)}catch(e){return e.errno}var i=J.nodePermissions(e,`wx`);if(i)return i;if(n){if(!J.isDir(r.mode))return 54;if(J.isRoot(r)||J.getPath(r)===J.cwd())return 10}else if(J.isDir(r.mode))return 31;return 0},mayOpen(e,t){return e?J.isLink(e.mode)?32:J.isDir(e.mode)&&(J.flagsToPermissionString(t)!==`r`||t&576)?31:J.nodePermissions(e,J.flagsToPermissionString(t)):44},checkOpExists(e,t){if(!e)throw new J.ErrnoError(t);return e},MAX_OPEN_FDS:4096,nextfd(){for(var e=0;e<=J.MAX_OPEN_FDS;e++)if(!J.streams[e])return e;throw new J.ErrnoError(33)},getStreamChecked(e){var t=J.getStream(e);if(!t)throw new J.ErrnoError(8);return t},getStream:e=>J.streams[e],createStream(e,t=-1){return v(t>=-1),e=Object.assign(new J.FSStream,e),t==-1&&(t=J.nextfd()),e.fd=t,J.streams[t]=e,e},closeStream(e){J.streams[e]=null},dupStream(e,t=-1){var n=J.createStream(e,t);return n.stream_ops?.dup?.(n),n},doSetAttr(e,t,n){var r=e?.stream_ops.setattr,i=r?e:t;r??=t.node_ops.setattr,J.checkOpExists(r,63),r(i,n)},chrdev_stream_ops:{open(e){e.stream_ops=J.getDevice(e.node.rdev).stream_ops,e.stream_ops.open?.(e)},llseek(){throw new J.ErrnoError(70)}},major:e=>e>>8,minor:e=>e&255,makedev:(e,t)=>e<<8|t,registerDevice(e,t){J.devices[e]={stream_ops:t}},getDevice:e=>J.devices[e],getMounts(e){for(var t=[],n=[e];n.length;){var r=n.pop();t.push(r),n.push(...r.mounts)}return t},syncfs(e,t){typeof e==`function`&&(t=e,e=!1),J.syncFSRequests++,J.syncFSRequests>1&&g(`warning: ${J.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var n=J.getMounts(J.root.mount),r=0;function i(e){return v(J.syncFSRequests>0),J.syncFSRequests--,t(e)}function a(e){if(e)return a.errored?void 0:(a.errored=!0,i(e));++r>=n.length&&i(null)}n.forEach(t=>{if(!t.type.syncfs)return a(null);t.type.syncfs(t,e,a)})},mount(e,t,n){if(typeof e==`string`)throw e;var r=n===`/`,i=!n,a;if(r&&J.root)throw new J.ErrnoError(10);if(!r&&!i){var o=J.lookupPath(n,{follow_mount:!1});if(n=o.path,a=o.node,J.isMountpoint(a))throw new J.ErrnoError(10);if(!J.isDir(a.mode))throw new J.ErrnoError(54)}var s={type:e,opts:t,mountpoint:n,mounts:[]},c=e.mount(s);return c.mount=s,s.root=c,r?J.root=c:a&&(a.mounted=s,a.mount&&a.mount.mounts.push(s)),c},unmount(e){var t=J.lookupPath(e,{follow_mount:!1});if(!J.isMountpoint(t.node))throw new J.ErrnoError(28);var n=t.node,r=n.mounted,i=J.getMounts(r);Object.keys(J.nameTable).forEach(e=>{for(var t=J.nameTable[e];t;){var n=t.name_next;i.includes(t.mount)&&J.destroyNode(t),t=n}}),n.mounted=null;var a=n.mount.mounts.indexOf(r);v(a!==-1),n.mount.mounts.splice(a,1)},lookup(e,t){return e.node_ops.lookup(e,t)},mknod(e,t,n){var r=J.lookupPath(e,{parent:!0}).node,i=z.basename(e);if(!i)throw new J.ErrnoError(28);if(i===`.`||i===`..`)throw new J.ErrnoError(20);var a=J.mayCreate(r,i);if(a)throw new J.ErrnoError(a);if(!r.node_ops.mknod)throw new J.ErrnoError(63);return r.node_ops.mknod(r,i,t,n)},statfs(e){return J.statfsNode(J.lookupPath(e,{follow:!0}).node)},statfsStream(e){return J.statfsNode(e.node)},statfsNode(e){var t={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:J.nextInode,ffree:J.nextInode-1,fsid:42,flags:2,namelen:255};return e.node_ops.statfs&&Object.assign(t,e.node_ops.statfs(e.mount.opts.root)),t},create(e,t=438){return t&=4095,t|=32768,J.mknod(e,t,0)},mkdir(e,t=511){return t&=1023,t|=16384,J.mknod(e,t,0)},mkdirTree(e,t){var n=e.split(`/`),r=``;for(var i of n)if(i){(r||z.isAbs(e))&&(r+=`/`),r+=i;try{J.mkdir(r,t)}catch(e){if(e.errno!=20)throw e}}},mkdev(e,t,n){return n===void 0&&(n=t,t=438),t|=8192,J.mknod(e,t,n)},symlink(e,t){if(!Ye.resolve(e))throw new J.ErrnoError(44);var n=J.lookupPath(t,{parent:!0}).node;if(!n)throw new J.ErrnoError(44);var r=z.basename(t),i=J.mayCreate(n,r);if(i)throw new J.ErrnoError(i);if(!n.node_ops.symlink)throw new J.ErrnoError(63);return n.node_ops.symlink(n,r,e)},rename(e,t){var n=z.dirname(e),r=z.dirname(t),i=z.basename(e),a=z.basename(t),o=J.lookupPath(e,{parent:!0}),s=o.node,c;if(o=J.lookupPath(t,{parent:!0}),c=o.node,!s||!c)throw new J.ErrnoError(44);if(s.mount!==c.mount)throw new J.ErrnoError(75);var l=J.lookupNode(s,i),u=Ye.relative(e,r);if(u.charAt(0)!==`.`)throw new J.ErrnoError(28);if(u=Ye.relative(t,n),u.charAt(0)!==`.`)throw new J.ErrnoError(55);var d;try{d=J.lookupNode(c,a)}catch{}if(l!==d){var f=J.isDir(l.mode),p=J.mayDelete(s,i,f);if(p||(p=d?J.mayDelete(c,a,f):J.mayCreate(c,a),p))throw new J.ErrnoError(p);if(!s.node_ops.rename)throw new J.ErrnoError(63);if(J.isMountpoint(l)||d&&J.isMountpoint(d))throw new J.ErrnoError(10);if(c!==s&&(p=J.nodePermissions(s,`w`),p))throw new J.ErrnoError(p);J.hashRemoveNode(l);try{s.node_ops.rename(l,c,a),l.parent=c}catch(e){throw e}finally{J.hashAddNode(l)}}},rmdir(e){var t=J.lookupPath(e,{parent:!0}).node,n=z.basename(e),r=J.lookupNode(t,n),i=J.mayDelete(t,n,!0);if(i)throw new J.ErrnoError(i);if(!t.node_ops.rmdir)throw new J.ErrnoError(63);if(J.isMountpoint(r))throw new J.ErrnoError(10);t.node_ops.rmdir(t,n),J.destroyNode(r)},readdir(e){var t=J.lookupPath(e,{follow:!0}).node;return J.checkOpExists(t.node_ops.readdir,54)(t)},unlink(e){var t=J.lookupPath(e,{parent:!0}).node;if(!t)throw new J.ErrnoError(44);var n=z.basename(e),r=J.lookupNode(t,n),i=J.mayDelete(t,n,!1);if(i)throw new J.ErrnoError(i);if(!t.node_ops.unlink)throw new J.ErrnoError(63);if(J.isMountpoint(r))throw new J.ErrnoError(10);t.node_ops.unlink(t,n),J.destroyNode(r)},readlink(e){var t=J.lookupPath(e).node;if(!t)throw new J.ErrnoError(44);if(!t.node_ops.readlink)throw new J.ErrnoError(28);return t.node_ops.readlink(t)},stat(e,t){var n=J.lookupPath(e,{follow:!t}).node;return J.checkOpExists(n.node_ops.getattr,63)(n)},fstat(e){var t=J.getStreamChecked(e),n=t.node,r=t.stream_ops.getattr,i=r?t:n;return r??=n.node_ops.getattr,J.checkOpExists(r,63),r(i)},lstat(e){return J.stat(e,!0)},doChmod(e,t,n,r){J.doSetAttr(e,t,{mode:n&4095|t.mode&-4096,ctime:Date.now(),dontFollow:r})},chmod(e,t,n){var r=typeof e==`string`?J.lookupPath(e,{follow:!n}).node:e;J.doChmod(null,r,t,n)},lchmod(e,t){J.chmod(e,t,!0)},fchmod(e,t){var n=J.getStreamChecked(e);J.doChmod(n,n.node,t,!1)},doChown(e,t,n){J.doSetAttr(e,t,{timestamp:Date.now(),dontFollow:n})},chown(e,t,n,r){var i=typeof e==`string`?J.lookupPath(e,{follow:!r}).node:e;J.doChown(null,i,r)},lchown(e,t,n){J.chown(e,t,n,!0)},fchown(e,t,n){var r=J.getStreamChecked(e);J.doChown(r,r.node,!1)},doTruncate(e,t,n){if(J.isDir(t.mode))throw new J.ErrnoError(31);if(!J.isFile(t.mode))throw new J.ErrnoError(28);var r=J.nodePermissions(t,`w`);if(r)throw new J.ErrnoError(r);J.doSetAttr(e,t,{size:n,timestamp:Date.now()})},truncate(e,t){if(t<0)throw new J.ErrnoError(28);var n=typeof e==`string`?J.lookupPath(e,{follow:!0}).node:e;J.doTruncate(null,n,t)},ftruncate(e,t){var n=J.getStreamChecked(e);if(t<0||!(n.flags&2097155))throw new J.ErrnoError(28);J.doTruncate(n,n.node,t)},utime(e,t,n){var r=J.lookupPath(e,{follow:!0}).node;J.checkOpExists(r.node_ops.setattr,63)(r,{atime:t,mtime:n})},open(e,t,r=438){if(e===``)throw new J.ErrnoError(44);t=typeof t==`string`?et(t):t,r=t&64?r&4095|32768:0;var i,a;if(typeof e==`object`)i=e;else{a=e.endsWith(`/`);var o=J.lookupPath(e,{follow:!(t&131072),noent_okay:!0});i=o.node,e=o.path}var s=!1;if(t&64)if(i){if(t&128)throw new J.ErrnoError(20)}else if(a)throw new J.ErrnoError(31);else i=J.mknod(e,r|511,0),s=!0;if(!i)throw new J.ErrnoError(44);if(J.isChrdev(i.mode)&&(t&=-513),t&65536&&!J.isDir(i.mode))throw new J.ErrnoError(54);if(!s){var c=J.mayOpen(i,t);if(c)throw new J.ErrnoError(c)}t&512&&!s&&J.truncate(i,0),t&=-131713;var l=J.createStream({node:i,path:J.getPath(i),flags:t,seekable:!0,position:0,stream_ops:i.stream_ops,ungotten:[],error:!1});return l.stream_ops.open&&l.stream_ops.open(l),s&&J.chmod(i,r&511),n.logReadFiles&&!(t&1)&&(e in J.readFiles||(J.readFiles[e]=1)),l},close(e){if(J.isClosed(e))throw new J.ErrnoError(8);e.getdents&&=null;try{e.stream_ops.close&&e.stream_ops.close(e)}catch(e){throw e}finally{J.closeStream(e.fd)}e.fd=null},isClosed(e){return e.fd===null},llseek(e,t,n){if(J.isClosed(e))throw new J.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new J.ErrnoError(70);if(n!=0&&n!=1&&n!=2)throw new J.ErrnoError(28);return e.position=e.stream_ops.llseek(e,t,n),e.ungotten=[],e.position},read(e,t,n,r,i){if(v(n>=0),r<0||i<0)throw new J.ErrnoError(28);if(J.isClosed(e)||(e.flags&2097155)==1)throw new J.ErrnoError(8);if(J.isDir(e.node.mode))throw new J.ErrnoError(31);if(!e.stream_ops.read)throw new J.ErrnoError(28);var a=i!==void 0;if(!a)i=e.position;else if(!e.seekable)throw new J.ErrnoError(70);var o=e.stream_ops.read(e,t,n,r,i);return a||(e.position+=o),o},write(e,t,n,r,i,a){if(v(n>=0),r<0||i<0)throw new J.ErrnoError(28);if(J.isClosed(e)||!(e.flags&2097155))throw new J.ErrnoError(8);if(J.isDir(e.node.mode))throw new J.ErrnoError(31);if(!e.stream_ops.write)throw new J.ErrnoError(28);e.seekable&&e.flags&1024&&J.llseek(e,0,2);var o=i!==void 0;if(!o)i=e.position;else if(!e.seekable)throw new J.ErrnoError(70);var s=e.stream_ops.write(e,t,n,r,i,a);return o||(e.position+=s),s},mmap(e,t,n,r,i){if(r&2&&!(i&2)&&(e.flags&2097155)!=2||(e.flags&2097155)==1)throw new J.ErrnoError(2);if(!e.stream_ops.mmap)throw new J.ErrnoError(43);if(!t)throw new J.ErrnoError(28);return e.stream_ops.mmap(e,t,n,r,i)},msync(e,t,n,r,i){return v(n>=0),e.stream_ops.msync?e.stream_ops.msync(e,t,n,r,i):0},ioctl(e,t,n){if(!e.stream_ops.ioctl)throw new J.ErrnoError(59);return e.stream_ops.ioctl(e,t,n)},readFile(e,t={}){t.flags=t.flags||0,t.encoding=t.encoding||`binary`,t.encoding!==`utf8`&&t.encoding!==`binary`&&j(`Invalid encoding type "${t.encoding}"`);var n=J.open(e,t.flags),r=J.stat(e).size,i=new Uint8Array(r);return J.read(n,i,0,r,0),t.encoding===`utf8`&&(i=F(i)),J.close(n),i},writeFile(e,t,n={}){n.flags=n.flags||577;var r=J.open(e,n.flags,n.mode);typeof t==`string`&&(t=new Uint8Array(Ze(t,!0))),ArrayBuffer.isView(t)?J.write(r,t,0,t.byteLength,void 0,n.canOwn):j(`Unsupported data type`),J.close(r)},cwd:()=>J.currentPath,chdir(e){var t=J.lookupPath(e,{follow:!0});if(t.node===null)throw new J.ErrnoError(44);if(!J.isDir(t.node.mode))throw new J.ErrnoError(54);var n=J.nodePermissions(t.node,`x`);if(n)throw new J.ErrnoError(n);J.currentPath=t.path},createDefaultDirectories(){J.mkdir(`/tmp`),J.mkdir(`/home`),J.mkdir(`/home/web_user`)},createDefaultDevices(){J.mkdir(`/dev`),J.registerDevice(J.makedev(1,3),{read:()=>0,write:(e,t,n,r,i)=>r,llseek:()=>0}),J.mkdev(`/dev/null`,J.makedev(1,3)),B.register(J.makedev(5,0),B.default_tty_ops),B.register(J.makedev(6,0),B.default_tty1_ops),J.mkdev(`/dev/tty`,J.makedev(5,0)),J.mkdev(`/dev/tty1`,J.makedev(6,0));var e=new Uint8Array(1024),t=0,n=()=>(t===0&&(Je(e),t=e.byteLength),e[--t]);J.createDevice(`/dev`,`random`,n),J.createDevice(`/dev`,`urandom`,n),J.mkdir(`/dev/shm`),J.mkdir(`/dev/shm/tmp`)},createSpecialDirectories(){J.mkdir(`/proc`);var e=J.mkdir(`/proc/self`);J.mkdir(`/proc/self/fd`),J.mount({mount(){var t=J.createNode(e,`fd`,16895,73);return t.stream_ops={llseek:V.stream_ops.llseek},t.node_ops={lookup(e,t){var n=+t,r=J.getStreamChecked(n),i={parent:null,mount:{mountpoint:`fake`},node_ops:{readlink:()=>r.path},id:n+1};return i.parent=i,i},readdir(){return Array.from(J.streams.entries()).filter(([e,t])=>t).map(([e,t])=>e.toString())}},t}},{},`/proc/self/fd`)},createStandardStreams(e,t,n){e?J.createDevice(`/dev`,`stdin`,e):J.symlink(`/dev/tty`,`/dev/stdin`),t?J.createDevice(`/dev`,`stdout`,null,t):J.symlink(`/dev/tty`,`/dev/stdout`),n?J.createDevice(`/dev`,`stderr`,null,n):J.symlink(`/dev/tty1`,`/dev/stderr`);var r=J.open(`/dev/stdin`,0),i=J.open(`/dev/stdout`,1),a=J.open(`/dev/stderr`,1);v(r.fd===0,`invalid handle for stdin (${r.fd})`),v(i.fd===1,`invalid handle for stdout (${i.fd})`),v(a.fd===2,`invalid handle for stderr (${a.fd})`)},staticInit(){J.nameTable=Array(4096),J.mount(V,{},`/`),J.createDefaultDirectories(),J.createDefaultDevices(),J.createSpecialDirectories(),J.filesystems={MEMFS:V}},init(e,t,r){v(!J.initialized,`FS.init was previously called. If you want to initialize later with custom parameters, remove any earlier calls (note that one is automatically added to the generated code)`),J.initialized=!0,e??=n.stdin,t??=n.stdout,r??=n.stderr,J.createStandardStreams(e,t,r)},quit(){J.initialized=!1,bt(0);for(var e of J.streams)e&&J.close(e)},findObject(e,t){var n=J.analyzePath(e,t);return n.exists?n.object:null},analyzePath(e,t){try{var n=J.lookupPath(e,{follow:!t});e=n.path}catch{}var r={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var n=J.lookupPath(e,{parent:!0});r.parentExists=!0,r.parentPath=n.path,r.parentObject=n.node,r.name=z.basename(e),n=J.lookupPath(e,{follow:!t}),r.exists=!0,r.path=n.path,r.object=n.node,r.name=n.node.name,r.isRoot=n.path===`/`}catch(e){r.error=e.errno}return r},createPath(e,t,n,r){e=typeof e==`string`?e:J.getPath(e);for(var i=t.split(`/`).reverse();i.length;){var a=i.pop();if(a){var o=z.join2(e,a);try{J.mkdir(o)}catch(e){if(e.errno!=20)throw e}e=o}}return o},createFile(e,t,n,r,i){var a=z.join2(typeof e==`string`?e:J.getPath(e),t),o=H(r,i);return J.create(a,o)},createDataFile(e,t,n,r,i,a){var o=t;e&&(e=typeof e==`string`?e:J.getPath(e),o=t?z.join2(e,t):e);var s=H(r,i),c=J.create(o,s);if(n){if(typeof n==`string`){for(var l=Array(n.length),u=0,d=n.length;u<d;++u)l[u]=n.charCodeAt(u);n=l}J.chmod(c,s|146);var f=J.open(c,577);J.write(f,n,0,n.length,0,a),J.close(f),J.chmod(c,s)}},createDevice(e,t,n,r){var i=z.join2(typeof e==`string`?e:J.getPath(e),t),a=H(!!n,!!r);J.createDevice.major??=64;var o=J.makedev(J.createDevice.major++,0);return J.registerDevice(o,{open(e){e.seekable=!1},close(e){r?.buffer?.length&&r(10)},read(e,t,r,i,a){for(var o=0,s=0;s<i;s++){var c;try{c=n()}catch{throw new J.ErrnoError(29)}if(c===void 0&&o===0)throw new J.ErrnoError(6);if(c==null)break;o++,t[r+s]=c}return o&&(e.node.atime=Date.now()),o},write(e,t,n,i,a){for(var o=0;o<i;o++)try{r(t[n+o])}catch{throw new J.ErrnoError(29)}return i&&(e.node.mtime=e.node.ctime=Date.now()),o}}),J.mkdev(i,a,o)},forceLoadFile(e){if(e.isDevice||e.isFolder||e.link||e.contents)return!0;if(globalThis.XMLHttpRequest)j(`Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.`);else try{e.contents=m(e.url)}catch{throw new J.ErrnoError(29)}},createLazyFile(e,t,n,r,a){class o{lengthKnown=!1;chunks=[];get(e){if(!(e>this.length-1||e<0)){var t=e%this.chunkSize,n=e/this.chunkSize|0;return this.getter(n)[t]}}setDataGetter(e){this.getter=e}cacheLength(){var e=new XMLHttpRequest;e.open(`HEAD`,n,!1),e.send(null),e.status>=200&&e.status<300||e.status===304||j(`Couldn't load `+n+`. Status: `+e.status);var t=Number(e.getResponseHeader(`Content-length`)),r,i=(r=e.getResponseHeader(`Accept-Ranges`))&&r===`bytes`,a=(r=e.getResponseHeader(`Content-Encoding`))&&r===`gzip`,o=1024*1024;i||(o=t);var s=(e,r)=>{e>r&&j(`invalid range (`+e+`, `+r+`) or no bytes requested!`),r>t-1&&j(`only `+t+` bytes available! programmer error!`);var i=new XMLHttpRequest;return i.open(`GET`,n,!1),t!==o&&i.setRequestHeader(`Range`,`bytes=`+e+`-`+r),i.responseType=`arraybuffer`,i.overrideMimeType&&i.overrideMimeType(`text/plain; charset=x-user-defined`),i.send(null),i.status>=200&&i.status<300||i.status===304||j(`Couldn't load `+n+`. Status: `+i.status),i.response===void 0?Ze(i.responseText||``,!0):new Uint8Array(i.response||[])},c=this;c.setDataGetter(e=>{var n=e*o,r=(e+1)*o-1;return r=Math.min(r,t-1),c.chunks[e]===void 0&&(c.chunks[e]=s(n,r)),c.chunks[e]===void 0&&j(`doXHR failed!`),c.chunks[e]}),(a||!t)&&(o=t=1,t=this.getter(0).length,o=t,ee(`LazyFiles on gzip forces download of the whole file when length is accessed`)),this._length=t,this._chunkSize=o,this.lengthKnown=!0}get length(){return this.lengthKnown||this.cacheLength(),this._length}get chunkSize(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}if(globalThis.XMLHttpRequest){i||j(`Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc`);var s={isDevice:!1,contents:new o}}else var s={isDevice:!1,url:n};var c=J.createFile(e,t,s,r,a);s.contents?c.contents=s.contents:s.url&&(c.contents=null,c.url=s.url),Object.defineProperties(c,{usedBytes:{get:function(){return this.contents.length}}});var l={};Object.keys(c.stream_ops).forEach(e=>{var t=c.stream_ops[e];l[e]=(...e)=>(J.forceLoadFile(c),t(...e))});function u(e,t,n,r,i){var a=e.node.contents;if(i>=a.length)return 0;var o=Math.min(a.length-i,r);if(v(o>=0),a.slice)for(var s=0;s<o;s++)t[n+s]=a[i+s];else for(var s=0;s<o;s++)t[n+s]=a.get(i+s);return o}return l.read=(e,t,n,r,i)=>(J.forceLoadFile(c),u(e,t,n,r,i)),l.mmap=(e,t,n,r,i)=>{J.forceLoadFile(c);var a=$e(t);if(!a)throw new J.ErrnoError(48);return u(e,T,a,t,n),{ptr:a,allocated:!0}},c.stream_ops=l,c},absolutePath(){j(`FS.absolutePath has been removed; use PATH_FS.resolve instead`)},createFolder(){j(`FS.createFolder has been removed; use FS.mkdir instead`)},createLink(){j(`FS.createLink has been removed; use FS.symlink instead`)},joinPath(){j(`FS.joinPath has been removed; use PATH.join instead`)},mmapAlloc(){j(`FS.mmapAlloc has been replaced by the top level function mmapAlloc`)},standardizePath(){j(`FS.standardizePath has been removed; use PATH.normalize instead`)}},Y={DEFAULT_POLLMASK:5,calculateAt(e,t,n){if(z.isAbs(t))return t;var r=e===-100?J.cwd():Y.getStreamFromFD(e).path;if(t.length==0){if(!n)throw new J.ErrnoError(44);return r}return r+`/`+t},writeStat(e,t){O[e>>2]=t.dev,O[e+4>>2]=t.mode,O[e+8>>2]=t.nlink,O[e+12>>2]=t.uid,O[e+16>>2]=t.gid,O[e+20>>2]=t.rdev,A[e+24>>3]=BigInt(t.size),D[e+32>>2]=4096,D[e+36>>2]=t.blocks;var n=t.atime.getTime(),r=t.mtime.getTime(),i=t.ctime.getTime();return A[e+40>>3]=BigInt(Math.floor(n/1e3)),O[e+48>>2]=n%1e3*1e3*1e3,A[e+56>>3]=BigInt(Math.floor(r/1e3)),O[e+64>>2]=r%1e3*1e3*1e3,A[e+72>>3]=BigInt(Math.floor(i/1e3)),O[e+80>>2]=i%1e3*1e3*1e3,A[e+88>>3]=BigInt(t.ino),0},writeStatFs(e,t){O[e+4>>2]=t.bsize,O[e+60>>2]=t.bsize,A[e+8>>3]=BigInt(t.blocks),A[e+16>>3]=BigInt(t.bfree),A[e+24>>3]=BigInt(t.bavail),A[e+32>>3]=BigInt(t.files),A[e+40>>3]=BigInt(t.ffree),O[e+48>>2]=t.fsid,O[e+64>>2]=t.flags,O[e+56>>2]=t.namelen},doMsync(e,t,n,r,i){if(!J.isFile(t.node.mode))throw new J.ErrnoError(43);if(r&2)return 0;var a=E.slice(e,e+n);J.msync(t,a,i,n,r)},getStreamFromFD(e){return J.getStreamChecked(e)},varargs:void 0,getStr(e){return I(e)}};function dt(e){try{var t=Y.getStreamFromFD(e);return J.close(t),0}catch(e){if(J===void 0||e.name!==`ErrnoError`)throw e;return e.errno}}var ft=(e,t,n,r)=>{for(var i=0,a=0;a<n;a++){var o=O[t>>2],s=O[t+4>>2];t+=8;var c=J.read(e,T,o,s,r);if(c<0)return-1;if(i+=c,c<s)break;r!==void 0&&(r+=c)}return i};function X(e,t,n,r){try{var i=ft(Y.getStreamFromFD(e),t,n);return O[r>>2]=i,0}catch(e){if(J===void 0||e.name!==`ErrnoError`)throw e;return e.errno}}var pt=9007199254740992,mt=-9007199254740992,ht=e=>e<mt||e>pt?NaN:Number(e);function gt(e,t,n,r){t=ht(t);try{if(isNaN(t))return 61;var i=Y.getStreamFromFD(e);return J.llseek(i,t,n),A[r>>3]=BigInt(i.position),i.getdents&&t===0&&n===0&&(i.getdents=null),0}catch(e){if(J===void 0||e.name!==`ErrnoError`)throw e;return e.errno}}var _t=(e,t,n,r)=>{for(var i=0,a=0;a<n;a++){var o=O[t>>2],s=O[t+4>>2];t+=8;var c=J.write(e,T,o,s,r);if(c<0)return-1;if(i+=c,c<s)break;r!==void 0&&(r+=c)}return i};function vt(e,t,n,r){try{var i=_t(Y.getStreamFromFD(e),t,n);return O[r>>2]=i,0}catch(e){if(J===void 0||e.name!==`ErrnoError`)throw e;return e.errno}}if(J.createPreloadedFile=q,J.preloadFile=K,J.staticInit(),n.noExitRuntime&&n.noExitRuntime,n.preloadPlugins&&(lt=n.preloadPlugins),n.print&&(ee=n.print),n.printErr&&(g=n.printErr),n.wasmBinary&&(te=n.wasmBinary),yt(),n.arguments&&n.arguments,n.thisProgram&&(c=n.thisProgram),v(n.memoryInitializerPrefixURL===void 0,`Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead`),v(n.pthreadMainPrefixURL===void 0,`Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead`),v(n.cdInitializerPrefixURL===void 0,`Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead`),v(n.filePackagePrefixURL===void 0,`Module.filePackagePrefixURL option was removed, use Module.locateFile instead`),v(n.read===void 0,`Module.read option was removed`),v(n.readAsync===void 0,`Module.readAsync option was removed (modify readAsync in JS)`),v(n.readBinary===void 0,`Module.readBinary option was removed (modify readBinary in JS)`),v(n.setWindowTitle===void 0,`Module.setWindowTitle option was removed (modify emscripten_set_window_title in JS)`),v(n.TOTAL_MEMORY===void 0,`Module.TOTAL_MEMORY has been renamed Module.INITIAL_MEMORY`),v(n.ENVIRONMENT===void 0,`Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -sENVIRONMENT=web or -sENVIRONMENT=node)`),v(n.STACK_SIZE===void 0,`STACK_SIZE can no longer be set at runtime.  Use -sSTACK_SIZE at link time`),v(n.wasmMemory===void 0,"Use of `wasmMemory` detected.  Use -sIMPORTED_MEMORY to define wasmMemory externally"),v(n.INITIAL_MEMORY===void 0,`Detected runtime INITIAL_MEMORY setting.  Use -sIMPORTED_MEMORY to define wasmMemory dynamically`),n.preInit)for(typeof n.preInit==`function`&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.shift()();re(`preInit`),`writeI53ToI64.writeI53ToI64Clamped.writeI53ToI64Signaling.writeI53ToU64Clamped.writeI53ToU64Signaling.readI53FromI64.readI53FromU64.convertI32PairToI53.convertI32PairToI53Checked.convertU32PairToI53.stackAlloc.getTempRet0.setTempRet0.createNamedFunction.zeroMemory.exitJS.withStackSave.inetPton4.inetNtop4.inetPton6.inetNtop6.readSockaddr.writeSockaddr.readEmAsmArgs.jstoi_q.autoResumeAudioContext.getDynCaller.dynCall.handleException.keepRuntimeAlive.runtimeKeepalivePush.runtimeKeepalivePop.callUserCallback.maybeExit.asmjsMangle.HandleAllocator.addOnInit.addOnPostCtor.addOnPreMain.addOnExit.STACK_SIZE.STACK_ALIGN.POINTER_SIZE.ASSERTIONS.ccall.cwrap.convertJsFunctionToWasm.getEmptyTableSlot.updateTableMap.getFunctionAddress.addFunction.removeFunction.intArrayToString.AsciiToString.stringToAscii.UTF16ToString.stringToUTF16.lengthBytesUTF16.UTF32ToString.stringToUTF32.lengthBytesUTF32.stringToNewUTF8.stringToUTF8OnStack.writeArrayToMemory.registerKeyEventCallback.maybeCStringToJsString.findEventTarget.getBoundingClientRect.fillMouseEventData.registerMouseEventCallback.registerWheelEventCallback.registerUiEventCallback.registerFocusEventCallback.fillDeviceOrientationEventData.registerDeviceOrientationEventCallback.fillDeviceMotionEventData.registerDeviceMotionEventCallback.screenOrientation.fillOrientationChangeEventData.registerOrientationChangeEventCallback.fillFullscreenChangeEventData.registerFullscreenChangeEventCallback.JSEvents_requestFullscreen.JSEvents_resizeCanvasForFullscreen.registerRestoreOldStyle.hideEverythingExceptGivenElement.restoreHiddenElements.setLetterbox.softFullscreenResizeWebGLRenderTarget.doRequestFullscreen.fillPointerlockChangeEventData.registerPointerlockChangeEventCallback.registerPointerlockErrorEventCallback.requestPointerLock.fillVisibilityChangeEventData.registerVisibilityChangeEventCallback.registerTouchEventCallback.fillGamepadEventData.registerGamepadEventCallback.registerBeforeUnloadEventCallback.fillBatteryEventData.registerBatteryEventCallback.setCanvasElementSize.getCanvasElementSize.jsStackTrace.getCallstack.convertPCtoSourceLocation.checkWasiClock.wasiRightsToMuslOFlags.wasiOFlagsToMuslOFlags.safeSetTimeout.setImmediateWrapped.safeRequestAnimationFrame.clearImmediateWrapped.registerPostMainLoop.registerPreMainLoop.getPromise.makePromise.idsToPromises.makePromiseCallback.findMatchingCatch.Browser_asyncPrepareDataCounter.isLeapYear.ydayFromDate.arraySum.addDays.getSocketFromFD.getSocketAddress.FS_mkdirTree._setNetworkCallback.heapObjectForWebGLType.toTypedArrayIndex.webgl_enable_ANGLE_instanced_arrays.webgl_enable_OES_vertex_array_object.webgl_enable_WEBGL_draw_buffers.webgl_enable_WEBGL_multi_draw.webgl_enable_EXT_polygon_offset_clamp.webgl_enable_EXT_clip_control.webgl_enable_WEBGL_polygon_mode.emscriptenWebGLGet.computeUnpackAlignedImageSize.colorChannelsInGlTextureFormat.emscriptenWebGLGetTexPixelData.emscriptenWebGLGetUniform.webglGetUniformLocation.webglPrepareUniformLocationsBeforeFirstUse.webglGetLeftBracePos.emscriptenWebGLGetVertexAttrib.__glGetActiveAttribOrUniform.writeGLArray.registerWebGlEventCallback.runAndAbortIfError.ALLOC_NORMAL.ALLOC_STACK.allocate.writeStringToMemory.writeAsciiToMemory.allocateUTF8.allocateUTF8OnStack.demangle.stackTrace.getNativeTypeSize`.split(`.`).forEach(w),`run.out.err.callMain.abort.wasmExports.HEAPF32.HEAPF64.HEAP8.HEAPU8.HEAP16.HEAPU16.HEAP32.HEAPU32.HEAP64.HEAPU64.writeStackCookie.checkStackCookie.INT53_MAX.INT53_MIN.bigintToI53Checked.stackSave.stackRestore.ptrToString.getHeapMax.growMemory.ENV.ERRNO_CODES.strError.DNS.Protocols.Sockets.timers.warnOnce.readEmAsmArgsArray.getExecutableName.asyncLoad.alignMemory.mmapAlloc.wasmTable.wasmMemory.getUniqueRunDependency.noExitRuntime.addRunDependency.removeRunDependency.addOnPreRun.addOnPostRun.freeTableIndexes.functionsInTableMap.PATH.PATH_FS.UTF8Decoder.UTF8ArrayToString.stringToUTF8Array.lengthBytesUTF8.intArrayFromString.UTF16Decoder.JSEvents.specialHTMLTargets.findCanvasEventTarget.currentFullscreenStrategy.restoreOldWindowedStyle.UNWIND_CACHE.ExitStatus.getEnvStrings.doReadv.doWritev.initRandomFill.randomFill.emSetImmediate.emClearImmediate_deps.emClearImmediate.promiseMap.uncaughtExceptionCount.exceptionLast.exceptionCaught.ExceptionInfo.Browser.requestFullscreen.requestFullScreen.setCanvasSize.getUserMedia.createContext.getPreloadedImageData__data.wget.MONTH_DAYS_REGULAR.MONTH_DAYS_LEAP.MONTH_DAYS_REGULAR_CUMULATIVE.MONTH_DAYS_LEAP_CUMULATIVE.SYSCALLS.preloadPlugins.FS_createPreloadedFile.FS_preloadFile.FS_modeStringToFlags.FS_getMode.FS_stdin_getChar_buffer.FS_stdin_getChar.FS_unlink.FS_createPath.FS_createDevice.FS_readFile.FS.FS_root.FS_mounts.FS_devices.FS_streams.FS_nextInode.FS_nameTable.FS_currentPath.FS_initialized.FS_ignorePermissions.FS_filesystems.FS_syncFSRequests.FS_readFiles.FS_lookupPath.FS_getPath.FS_hashName.FS_hashAddNode.FS_hashRemoveNode.FS_lookupNode.FS_createNode.FS_destroyNode.FS_isRoot.FS_isMountpoint.FS_isFile.FS_isDir.FS_isLink.FS_isChrdev.FS_isBlkdev.FS_isFIFO.FS_isSocket.FS_flagsToPermissionString.FS_nodePermissions.FS_mayLookup.FS_mayCreate.FS_mayDelete.FS_mayOpen.FS_checkOpExists.FS_nextfd.FS_getStreamChecked.FS_getStream.FS_createStream.FS_closeStream.FS_dupStream.FS_doSetAttr.FS_chrdev_stream_ops.FS_major.FS_minor.FS_makedev.FS_registerDevice.FS_getDevice.FS_getMounts.FS_syncfs.FS_mount.FS_unmount.FS_lookup.FS_mknod.FS_statfs.FS_statfsStream.FS_statfsNode.FS_create.FS_mkdir.FS_mkdev.FS_symlink.FS_rename.FS_rmdir.FS_readdir.FS_readlink.FS_stat.FS_fstat.FS_lstat.FS_doChmod.FS_chmod.FS_lchmod.FS_fchmod.FS_doChown.FS_chown.FS_lchown.FS_fchown.FS_doTruncate.FS_truncate.FS_ftruncate.FS_utime.FS_open.FS_close.FS_isClosed.FS_llseek.FS_read.FS_write.FS_mmap.FS_msync.FS_ioctl.FS_writeFile.FS_cwd.FS_chdir.FS_createDefaultDirectories.FS_createDefaultDevices.FS_createSpecialDirectories.FS_createStandardStreams.FS_staticInit.FS_init.FS_quit.FS_findObject.FS_analyzePath.FS_createFile.FS_createDataFile.FS_forceLoadFile.FS_createLazyFile.FS_absolutePath.FS_createFolder.FS_createLink.FS_joinPath.FS_mmapAlloc.FS_standardizePath.MEMFS.TTY.PIPEFS.SOCKFS.tempFixedLengthArray.miniTempWebGLFloatBuffers.miniTempWebGLIntBuffers.GL.AL.GLUT.EGL.GLEW.IDBStore.SDL.SDL_gfx.print.printErr.jstoi_s`.split(`.`).forEach(ie),n.getValue=Te,n.setValue=De,n.UTF8ToString=I,n.stringToUTF8=R;function yt(){S(`fetchSettings`)}n._create_position=x(`_create_position`),n._delete_position=x(`_delete_position`),n._make_move=x(`_make_move`),n._unmake_move=x(`_unmake_move`),n._get_legal_moves=x(`_get_legal_moves`),n._malloc=x(`_malloc`),n._free_legal_moves=x(`_free_legal_moves`),n._free=x(`_free`),n._attacks=x(`_attacks`),n._pos_attacks=x(`_pos_attacks`),n._pawn_pushes=x(`_pawn_pushes`),n._get_pieces_bb=x(`_get_pieces_bb`),n._get_pieces_color_bb=x(`_get_pieces_color_bb`),n._get_occupied=x(`_get_occupied`),n._get_turn=x(`_get_turn`),n._get_at=x(`_get_at`),n._is_checkmate=x(`_is_checkmate`),n._checkers=x(`_checkers`),n._get_fen=x(`_get_fen`),n._init=x(`_init`);var bt=x(`_fflush`),xt=x(`_strerror`),Z=x(`_emscripten_stack_get_end`),St=x(`_emscripten_stack_init`),Ct=x(`wasmMemory`);function Q(e){v(e.create_position,`missing Wasm export: create_position`),n._create_position=M(`create_position`,1),v(e.delete_position,`missing Wasm export: delete_position`),n._delete_position=M(`delete_position`,1),v(e.make_move,`missing Wasm export: make_move`),n._make_move=M(`make_move`,2),v(e.unmake_move,`missing Wasm export: unmake_move`),n._unmake_move=M(`unmake_move`,2),v(e.get_legal_moves,`missing Wasm export: get_legal_moves`),n._get_legal_moves=M(`get_legal_moves`,2),v(e.malloc,`missing Wasm export: malloc`),n._malloc=M(`malloc`,1),v(e.free_legal_moves,`missing Wasm export: free_legal_moves`),n._free_legal_moves=M(`free_legal_moves`,1),v(e.free,`missing Wasm export: free`),n._free=M(`free`,1),v(e.attacks,`missing Wasm export: attacks`),n._attacks=M(`attacks`,5),v(e.pos_attacks,`missing Wasm export: pos_attacks`),n._pos_attacks=M(`pos_attacks`,3),v(e.pawn_pushes,`missing Wasm export: pawn_pushes`),n._pawn_pushes=M(`pawn_pushes`,3),v(e.get_pieces_bb,`missing Wasm export: get_pieces_bb`),n._get_pieces_bb=M(`get_pieces_bb`,4),v(e.get_pieces_color_bb,`missing Wasm export: get_pieces_color_bb`),n._get_pieces_color_bb=M(`get_pieces_color_bb`,3),v(e.get_occupied,`missing Wasm export: get_occupied`),n._get_occupied=M(`get_occupied`,2),v(e.get_turn,`missing Wasm export: get_turn`),n._get_turn=M(`get_turn`,1),v(e.get_at,`missing Wasm export: get_at`),n._get_at=M(`get_at`,2),v(e.is_checkmate,`missing Wasm export: is_checkmate`),n._is_checkmate=M(`is_checkmate`,1),v(e.checkers,`missing Wasm export: checkers`),n._checkers=M(`checkers`,2),v(e.get_fen,`missing Wasm export: get_fen`),n._get_fen=M(`get_fen`,1),v(e.init,`missing Wasm export: init`),n._init=M(`init`,0),v(e.main,`missing Wasm export: main`),v(e.fflush,`missing Wasm export: fflush`),bt=M(`fflush`,1),v(e.strerror,`missing Wasm export: strerror`),xt=M(`strerror`,1),v(e.emscripten_stack_get_end,`missing Wasm export: emscripten_stack_get_end`),Z=e.emscripten_stack_get_end,v(e.emscripten_stack_get_base,`missing Wasm export: emscripten_stack_get_base`),e.emscripten_stack_get_base,v(e.emscripten_stack_init,`missing Wasm export: emscripten_stack_init`),St=e.emscripten_stack_init,v(e.emscripten_stack_get_free,`missing Wasm export: emscripten_stack_get_free`),e.emscripten_stack_get_free,v(e._emscripten_stack_restore,`missing Wasm export: _emscripten_stack_restore`),e._emscripten_stack_restore,v(e._emscripten_stack_alloc,`missing Wasm export: _emscripten_stack_alloc`),e._emscripten_stack_alloc,v(e.emscripten_stack_get_current,`missing Wasm export: emscripten_stack_get_current`),e.emscripten_stack_get_current,v(e.memory,`missing Wasm export: memory`),Ct=e.memory,v(e.__indirect_function_table,`missing Wasm export: __indirect_function_table`),e.__indirect_function_table}var wt={__assert_fail:je,__cxa_throw:Pe,_abort_js:Fe,_tzset_js:Le,emscripten_resize_heap:Ve,environ_get:Ge,environ_sizes_get:Ke,fd_close:dt,fd_read:X,fd_seek:gt,fd_write:vt},Tt;function Et(){St(),y()}function Dt(){if(U>0){W=Dt;return}if(Et(),de(),U>0){W=Dt;return}function e(){v(!Tt),Tt=!0,n.calledRun=!0,!_&&(fe(),ae?.(n),n.onRuntimeInitialized?.(),re(`onRuntimeInitialized`),v(!n._main,`compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]`),pe())}n.setStatus?(n.setStatus(`Running...`),setTimeout(()=>{setTimeout(()=>n.setStatus(``),1),e()},1)):e(),b()}var Ot=await xe();Dt(),t=le?n:new Promise((e,t)=>{ae=e,oe=t});for(let t of Object.keys(n))t in e||Object.defineProperty(e,t,{configurable:!0,get(){j(`Access to module property ('${t}') is no longer possible via the module constructor argument; Instead, use the result of the module constructor.`)}});return t}var d=u,f=class{unwrap(e,t){let n=this._chain(t=>h.ok(e?e(t):t),e=>t?h.ok(t(e)):h.err(e));if(n.isErr)throw n.error;return n.value}map(e,t){return this._chain(t=>h.ok(e(t)),e=>h.err(t?t(e):e))}chain(e,t){return this._chain(e,t||(e=>h.err(e)))}},p=class extends f{constructor(e){super(),this.value=void 0,this.isOk=!0,this.isErr=!1,this.value=e}_chain(e,t){return e(this.value)}},m=class extends f{constructor(e){super(),this.error=void 0,this.isOk=!1,this.isErr=!0,this.error=e}_chain(e,t){return t(this.error)}},h;(function(e){e.ok=function(e){return new p(e)},e.err=function(e){return new m(e||Error())},e.all=function(t){if(Array.isArray(t)){let n=[];for(let e=0;e<t.length;e++){let r=t[e];if(r.isErr)return r;n.push(r.value)}return e.ok(n)}let n={},r=Object.keys(t);for(let e=0;e<r.length;e++){let i=t[r[e]];if(i.isErr)return i;n[r[e]]=i.value}return e.ok(n)}})(h||={});const ee=e=>(e-=e>>>1&1431655765,e=(e&858993459)+(e>>>2&858993459),Math.imul(e+(e>>>4)&252645135,16843009)>>24),g=e=>(e=e>>>8&16711935|(e&16711935)<<8,e>>>16&65535|(e&65535)<<16),te=e=>(e=e>>>1&1431655765|(e&1431655765)<<1,e=e>>>2&858993459|(e&858993459)<<2,e=e>>>4&252645135|(e&252645135)<<4,g(e));var _=class e{lo;hi;constructor(e,t){this.lo=e|0,this.hi=t|0}static fromSquare(t){return t>=32?new e(0,1<<t-32):new e(1<<t,0)}static fromRank(t){return new e(255,0).shl64(8*t)}static fromFile(t){return new e(16843009<<t,16843009<<t)}static empty(){return new e(0,0)}static full(){return new e(4294967295,4294967295)}static corners(){return new e(129,2164260864)}static center(){return new e(402653184,24)}static backranks(){return new e(255,4278190080)}static backrank(t){return t===`white`?new e(255,0):new e(0,4278190080)}static lightSquares(){return new e(1437226410,1437226410)}static darkSquares(){return new e(2857740885,2857740885)}complement(){return new e(~this.lo,~this.hi)}xor(t){return new e(this.lo^t.lo,this.hi^t.hi)}union(t){return new e(this.lo|t.lo,this.hi|t.hi)}intersect(t){return new e(this.lo&t.lo,this.hi&t.hi)}diff(t){return new e(this.lo&~t.lo,this.hi&~t.hi)}intersects(e){return this.intersect(e).nonEmpty()}isDisjoint(e){return this.intersect(e).isEmpty()}supersetOf(e){return e.diff(this).isEmpty()}subsetOf(e){return this.diff(e).isEmpty()}shr64(t){return t>=64?e.empty():t>=32?new e(this.hi>>>t-32,0):t>0?new e(this.lo>>>t^this.hi<<32-t,this.hi>>>t):this}shl64(t){return t>=64?e.empty():t>=32?new e(0,this.lo<<t-32):t>0?new e(this.lo<<t,this.hi<<t^this.lo>>>32-t):this}bswap64(){return new e(g(this.hi),g(this.lo))}rbit64(){return new e(te(this.hi),te(this.lo))}minus64(t){let n=this.lo-t.lo,r=(n&t.lo&1)+(t.lo>>>1)+(n>>>1)>>>31;return new e(n,this.hi-(t.hi+r))}equals(e){return this.lo===e.lo&&this.hi===e.hi}size(){return ee(this.lo)+ee(this.hi)}isEmpty(){return this.lo===0&&this.hi===0}nonEmpty(){return this.lo!==0||this.hi!==0}has(e){return(e>=32?this.hi&1<<e-32:this.lo&1<<e)!=0}set(e,t){return t?this.with(e):this.without(e)}with(t){return t>=32?new e(this.lo,this.hi|1<<t-32):new e(this.lo|1<<t,this.hi)}without(t){return t>=32?new e(this.lo,this.hi&~(1<<t-32)):new e(this.lo&~(1<<t),this.hi)}toggle(t){return t>=32?new e(this.lo,this.hi^1<<t-32):new e(this.lo^1<<t,this.hi)}last(){if(this.hi!==0)return 63-Math.clz32(this.hi);if(this.lo!==0)return 31-Math.clz32(this.lo)}first(){if(this.lo!==0)return 31-Math.clz32(this.lo&-this.lo);if(this.hi!==0)return 63-Math.clz32(this.hi&-this.hi)}withoutFirst(){return this.lo===0?new e(0,this.hi&this.hi-1):new e(this.lo&this.lo-1,this.hi)}moreThanOne(){return this.hi!==0&&this.lo!==0||(this.lo&this.lo-1)!=0||(this.hi&this.hi-1)!=0}singleSquare(){return this.moreThanOne()?void 0:this.last()}*[Symbol.iterator](){let e=this.lo,t=this.hi;for(;e!==0;){let t=31-Math.clz32(e&-e);e^=1<<t,yield t}for(;t!==0;){let e=31-Math.clz32(t&-t);t^=1<<e,yield 32+e}}*reversed(){let e=this.lo,t=this.hi;for(;t!==0;){let e=31-Math.clz32(t);t^=1<<e,yield 32+e}for(;e!==0;){let t=31-Math.clz32(e);e^=1<<t,yield t}}};const v=[`a`,`b`,`c`,`d`,`e`,`f`,`g`,`h`],ne=[`1`,`2`,`3`,`4`,`5`,`6`,`7`,`8`],y=[`white`,`black`],b=[`pawn`,`knight`,`bishop`,`rook`,`queen`,`king`],re=[`a`,`h`],x=e=>e!==void 0,S=e=>e===`white`?`black`:`white`,C=e=>e>>3,w=e=>e&7,ie=(e,t)=>0<=e&&e<8&&0<=t&&t<8?e+8*t:void 0,ae=e=>{switch(e){case`pawn`:return`p`;case`knight`:return`n`;case`bishop`:return`b`;case`rook`:return`r`;case`queen`:return`q`;case`king`:return`k`}};function oe(e){switch(e.toLowerCase()){case`p`:return`pawn`;case`n`:return`knight`;case`b`:return`bishop`;case`r`:return`rook`;case`q`:return`queen`;case`k`:return`king`;default:return}}function T(e){if(e.length===2)return ie(e.charCodeAt(0)-97,e.charCodeAt(1)-49)}const E=e=>v[w(e)]+ne[C(e)],se=e=>{if(!(e[1]===`@`&&e.length===4)&&(e.length===4||e.length===5)){let t=T(e.slice(0,2)),n=T(e.slice(2,4)),r;if(e.length===5&&(r=oe(e[4]),!r))return;if(x(t)&&x(n))return{from:t,to:n,promotion:r}}},D=(e,t)=>e===`white`?t===`a`?2:6:t===`a`?58:62,O=(e,t)=>e===`white`?t===`a`?3:5:t===`a`?59:61,ce=(e,t)=>{let n=_.empty();for(let r of t){let t=e+r;0<=t&&t<64&&Math.abs(w(e)-w(t))<=2&&(n=n.with(t))}return n},k=e=>{let t=[];for(let n=0;n<64;n++)t[n]=e(n);return t},A=k(e=>ce(e,[-9,-8,-7,-1,1,7,8,9])),le=k(e=>ce(e,[-17,-15,-10,-6,6,10,15,17])),ue={white:k(e=>ce(e,[7,9])),black:k(e=>ce(e,[-7,-9]))},de=e=>A[e],fe=e=>le[e],pe=(e,t)=>ue[e][t],j=k(e=>_.fromFile(w(e)).without(e)),M=k(e=>_.fromRank(C(e)).without(e)),me=k(e=>{let t=new _(134480385,2151686160),n=8*(C(e)-w(e));return(n>=0?t.shl64(n):t.shr64(-n)).without(e)}),he=k(e=>{let t=new _(270549120,16909320),n=8*(C(e)+w(e)-7);return(n>=0?t.shl64(n):t.shr64(-n)).without(e)}),ge=(e,t,n)=>{let r=n.intersect(t),i=r.bswap64();return r=r.minus64(e),i=i.minus64(e.bswap64()),r.xor(i.bswap64()).intersect(t)},_e=(e,t)=>ge(_.fromSquare(e),j[e],t),ve=(e,t)=>{let n=M[e],r=t.intersect(n),i=r.rbit64();return r=r.minus64(_.fromSquare(e)),i=i.minus64(_.fromSquare(63-e)),r.xor(i.rbit64()).intersect(n)},ye=(e,t)=>{let n=_.fromSquare(e);return ge(n,me[e],t).xor(ge(n,he[e],t))},be=(e,t)=>_e(e,t).xor(ve(e,t)),xe=(e,t)=>ye(e,t).xor(be(e,t)),Se=(e,t)=>{let n=_.fromSquare(t);return M[e].intersects(n)?M[e].with(e):he[e].intersects(n)?he[e].with(e):me[e].intersects(n)?me[e].with(e):j[e].intersects(n)?j[e].with(e):_.empty()},N=(e,t)=>Se(e,t).intersect(_.full().shl64(e).xor(_.full().shl64(t))).withoutFirst();var Ce=class e{occupied;promoted;white;black;pawn;knight;bishop;rook;queen;king;constructor(){}static default(){let t=new e;return t.reset(),t}reset(){this.occupied=new _(65535,4294901760),this.promoted=_.empty(),this.white=new _(65535,0),this.black=new _(0,4294901760),this.pawn=new _(65280,16711680),this.knight=new _(66,1107296256),this.bishop=new _(36,603979776),this.rook=new _(129,2164260864),this.queen=new _(8,134217728),this.king=new _(16,268435456)}static empty(){let t=new e;return t.clear(),t}clear(){this.occupied=_.empty(),this.promoted=_.empty();for(let e of y)this[e]=_.empty();for(let e of b)this[e]=_.empty()}clone(){let t=new e;t.occupied=this.occupied,t.promoted=this.promoted;for(let e of y)t[e]=this[e];for(let e of b)t[e]=this[e];return t}getColor(e){if(this.white.has(e))return`white`;if(this.black.has(e))return`black`}getRole(e){for(let t of b)if(this[t].has(e))return t}get(e){let t=this.getColor(e);if(t)return{color:t,role:this.getRole(e),promoted:this.promoted.has(e)}}take(e){let t=this.get(e);return t&&(this.occupied=this.occupied.without(e),this[t.color]=this[t.color].without(e),this[t.role]=this[t.role].without(e),t.promoted&&(this.promoted=this.promoted.without(e))),t}set(e,t){let n=this.take(e);return this.occupied=this.occupied.with(e),this[t.color]=this[t.color].with(e),this[t.role]=this[t.role].with(e),t.promoted&&(this.promoted=this.promoted.with(e)),n}has(e){return this.occupied.has(e)}*[Symbol.iterator](){for(let e of this.occupied)yield[e,this.get(e)]}pieces(e,t){return this[e].intersect(this[t])}rooksAndQueens(){return this.rook.union(this.queen)}bishopsAndQueens(){return this.bishop.union(this.queen)}kingOf(e){return this.pieces(e,`king`).singleSquare()}},P;(function(e){e.Empty=`ERR_EMPTY`,e.OppositeCheck=`ERR_OPPOSITE_CHECK`,e.PawnsOnBackrank=`ERR_PAWNS_ON_BACKRANK`,e.Kings=`ERR_KINGS`,e.Variant=`ERR_VARIANT`})(P||={});var we=class extends Error{};const Te=(e,t,n,r)=>n[t].intersect(be(e,r).intersect(n.rooksAndQueens()).union(ye(e,r).intersect(n.bishopsAndQueens())).union(fe(e).intersect(n.knight)).union(de(e).intersect(n.king)).union(pe(S(t),e).intersect(n.pawn)));var Ee=class e{castlingRights;rook;path;constructor(){}static default(){let t=new e;return t.castlingRights=_.corners(),t.rook={white:{a:0,h:7},black:{a:56,h:63}},t.path={white:{a:new _(14,0),h:new _(96,0)},black:{a:new _(0,234881024),h:new _(0,1610612736)}},t}static empty(){let t=new e;return t.castlingRights=_.empty(),t.rook={white:{a:void 0,h:void 0},black:{a:void 0,h:void 0}},t.path={white:{a:_.empty(),h:_.empty()},black:{a:_.empty(),h:_.empty()}},t}clone(){let t=new e;return t.castlingRights=this.castlingRights,t.rook={white:{a:this.rook.white.a,h:this.rook.white.h},black:{a:this.rook.black.a,h:this.rook.black.h}},t.path={white:{a:this.path.white.a,h:this.path.white.h},black:{a:this.path.black.a,h:this.path.black.h}},t}add(e,t,n,r){let i=D(e,t),a=O(e,t);this.castlingRights=this.castlingRights.with(r),this.rook[e][t]=r,this.path[e][t]=N(r,a).with(a).union(N(n,i).with(i)).without(n).without(r)}static fromSetup(t){let n=e.empty(),r=t.castlingRights.intersect(t.board.rook);for(let e of y){let i=_.backrank(e),a=t.board.kingOf(e);if(!x(a)||!i.has(a))continue;let o=r.intersect(t.board[e]).intersect(i),s=o.first();x(s)&&s<a&&n.add(e,`a`,a,s);let c=o.last();x(c)&&a<c&&n.add(e,`h`,a,c)}return n}discardRook(e){if(this.castlingRights.has(e)){this.castlingRights=this.castlingRights.without(e);for(let t of y)for(let n of re)this.rook[t][n]===e&&(this.rook[t][n]=void 0)}}discardColor(e){this.castlingRights=this.castlingRights.diff(_.backrank(e)),this.rook[e].a=void 0,this.rook[e].h=void 0}},De=class{rules;board;pockets;turn;castles;epSquare;remainingChecks;halfmoves;fullmoves;constructor(e){this.rules=e}reset(){this.board=Ce.default(),this.pockets=void 0,this.turn=`white`,this.castles=Ee.default(),this.epSquare=void 0,this.remainingChecks=void 0,this.halfmoves=0,this.fullmoves=1}setupUnchecked(e){this.board=e.board.clone(),this.board.promoted=_.empty(),this.pockets=void 0,this.turn=e.turn,this.castles=Ee.fromSetup(e),this.epSquare=ke(this,e.epSquare),this.remainingChecks=void 0,this.halfmoves=e.halfmoves,this.fullmoves=e.fullmoves}kingAttackers(e,t,n){return Te(e,t,this.board,n)}playCaptureAt(e,t){this.halfmoves=0,t.role===`rook`&&this.castles.discardRook(e),this.pockets&&this.pockets[S(t.color)][t.promoted?`pawn`:t.role]++}ctx(){let e=this.isVariantEnd(),t=this.board.kingOf(this.turn);if(!x(t))return{king:t,blockers:_.empty(),checkers:_.empty(),variantEnd:e,mustCapture:!1};let n=be(t,_.empty()).intersect(this.board.rooksAndQueens()).union(ye(t,_.empty()).intersect(this.board.bishopsAndQueens())).intersect(this.board[S(this.turn)]),r=_.empty();for(let e of n){let n=N(t,e).intersect(this.board.occupied);n.moreThanOne()||(r=r.union(n))}let i=this.kingAttackers(t,S(this.turn),this.board.occupied);return{king:t,blockers:r,checkers:i,variantEnd:e,mustCapture:!1}}clone(){let e=new this.constructor;return e.board=this.board.clone(),e.pockets=this.pockets?.clone(),e.turn=this.turn,e.castles=this.castles.clone(),e.epSquare=this.epSquare,e.remainingChecks=this.remainingChecks?.clone(),e.halfmoves=this.halfmoves,e.fullmoves=this.fullmoves,e}validate(){if(this.board.occupied.isEmpty())return h.err(new we(P.Empty));if(this.board.king.size()!==2||!x(this.board.kingOf(this.turn)))return h.err(new we(P.Kings));let e=this.board.kingOf(S(this.turn));return x(e)?this.kingAttackers(e,this.turn,this.board.occupied).nonEmpty()?h.err(new we(P.OppositeCheck)):_.backranks().intersects(this.board.pawn)?h.err(new we(P.PawnsOnBackrank)):h.ok(void 0):h.err(new we(P.Kings))}dropDests(e){return _.empty()}dests(e,t){if(t||=this.ctx(),t.variantEnd)return _.empty();let n=this.board.get(e);if(!n||n.color!==this.turn)return _.empty();let r,i;if(n.role===`pawn`){r=pe(this.turn,e).intersect(this.board[S(this.turn)]);let n=this.turn===`white`?8:-8,a=e+n;if(0<=a&&a<64&&!this.board.occupied.has(a)){r=r.with(a);let t=this.turn===`white`?e<16:e>=48,i=a+n;t&&!this.board.occupied.has(i)&&(r=r.with(i))}x(this.epSquare)&&F(this,e,t)&&(i=_.fromSquare(this.epSquare))}else r=n.role===`bishop`?ye(e,this.board.occupied):n.role===`knight`?fe(e):n.role===`rook`?be(e,this.board.occupied):n.role===`queen`?xe(e,this.board.occupied):de(e);if(r=r.diff(this.board[this.turn]),x(t.king)){if(n.role===`king`){let n=this.board.occupied.without(e);for(let e of r)this.kingAttackers(e,S(this.turn),n).nonEmpty()&&(r=r.without(e));return r.union(I(this,`a`,t)).union(I(this,`h`,t))}if(t.checkers.nonEmpty()){let e=t.checkers.singleSquare();if(!x(e))return _.empty();r=r.intersect(N(e,t.king).with(e))}t.blockers.has(e)&&(r=r.intersect(Se(e,t.king)))}return i&&(r=r.union(i)),r}pseudo_dests(e,t){if(t||=this.ctx(),t.variantEnd)return _.empty();let n=this.board.get(e);if(!n||n.color!==this.turn)return _.empty();let r,i;if(n.role===`pawn`){r=pe(this.turn,e);let n=this.turn===`white`?8:-8,a=e+n;if(0<=a&&a<64&&!this.board.occupied.has(a)){r=r.with(a);let t=this.turn===`white`?e<16:e>=48,i=a+n;t&&!this.board.occupied.has(i)&&(r=r.with(i))}x(this.epSquare)&&F(this,e,t)&&(i=_.fromSquare(this.epSquare))}else r=n.role===`bishop`?ye(e,this.board.occupied):n.role===`knight`?fe(e):n.role===`rook`?be(e,this.board.occupied):n.role===`queen`?xe(e,this.board.occupied):de(e);if(x(t.king)){if(n.role===`king`){this.board.occupied.without(e);for(let e of r);return r.union(I(this,`a`,t)).union(I(this,`h`,t))}if(t.checkers.nonEmpty()){let e=t.checkers.singleSquare();if(!x(e))return _.empty();r=r.intersect(N(e,t.king).with(e))}t.blockers.has(e)&&(r=r.intersect(Se(e,t.king)))}return i&&(r=r.union(i)),r}isVariantEnd(){return!1}variantOutcome(e){}hasInsufficientMaterial(e){return this.board[e].intersect(this.board.pawn.union(this.board.rooksAndQueens())).nonEmpty()?!1:this.board[e].intersects(this.board.knight)?this.board[e].size()<=2&&this.board[S(e)].diff(this.board.king).diff(this.board.queen).isEmpty():this.board[e].intersects(this.board.bishop)?(!this.board.bishop.intersects(_.darkSquares())||!this.board.bishop.intersects(_.lightSquares()))&&this.board.pawn.isEmpty()&&this.board.knight.isEmpty():!0}toSetup(){return{board:this.board.clone(),pockets:this.pockets?.clone(),turn:this.turn,castlingRights:this.castles.castlingRights,epSquare:Ae(this),remainingChecks:this.remainingChecks?.clone(),halfmoves:Math.min(this.halfmoves,150),fullmoves:Math.min(Math.max(this.fullmoves,1),9999)}}isInsufficientMaterial(){return y.every(e=>this.hasInsufficientMaterial(e))}hasDests(e){e||=this.ctx();for(let t of this.board[this.turn])if(this.dests(t,e).nonEmpty())return!0;return this.dropDests(e).nonEmpty()}isLegal(e,t){{if(e.promotion===`pawn`||e.promotion===`king`&&this.rules!==`antichess`||!!e.promotion!==(this.board.pawn.has(e.from)&&_.backranks().has(e.to)))return!1;let n=this.dests(e.from,t);return n.has(e.to)||n.has(Me(this,e).to)}}isCheck(){let e=this.board.kingOf(this.turn);return x(e)&&this.kingAttackers(e,S(this.turn),this.board.occupied).nonEmpty()}isEnd(e){return(e?e.variantEnd:this.isVariantEnd())?!0:this.isInsufficientMaterial()||!this.hasDests(e)}isCheckmate(e){return e||=this.ctx(),!e.variantEnd&&e.checkers.nonEmpty()&&!this.hasDests(e)}isStalemate(e){return e||=this.ctx(),!e.variantEnd&&e.checkers.isEmpty()&&!this.hasDests(e)}outcome(e){let t=this.variantOutcome(e);if(t)return t;if(e||=this.ctx(),this.isCheckmate(e))return{winner:S(this.turn)};if(this.isInsufficientMaterial()||this.isStalemate(e))return{winner:void 0}}allDests(e){e||=this.ctx();let t=new Map;if(e.variantEnd)return t;for(let n of this.board[this.turn])t.set(n,this.dests(n,e));return t}play(e){let t=this.turn,n=this.epSquare,r=je(this,e);this.epSquare=void 0,this.halfmoves+=1,t===`black`&&(this.fullmoves+=1),this.turn=S(t);{let i=this.board.take(e.from);if(!i)return;let a;if(i.role===`pawn`){this.halfmoves=0,e.to===n&&(a=this.board.take(e.to+(t===`white`?-8:8)));let r=e.from-e.to;Math.abs(r)===16&&8<=e.from&&e.from<=55&&(this.epSquare=e.from+e.to>>1),e.promotion&&(i.role=e.promotion,i.promoted=!!this.pockets)}else if(i.role===`rook`)this.castles.discardRook(e.from);else if(i.role===`king`){if(r){let e=this.castles.rook[t][r];if(x(e)){let n=this.board.take(e);this.board.set(D(t,r),i),n&&this.board.set(O(t,r),n)}}this.castles.discardColor(t)}if(!r){let t=this.board.set(e.to,i)||a;t&&this.playCaptureAt(e.to,t)}}this.remainingChecks&&this.isCheck()&&(this.remainingChecks[t]=Math.max(this.remainingChecks[t]-1,0))}},Oe=class extends De{constructor(){super(`chess`)}static default(){let e=new this;return e.reset(),e}static fromSetup(e){let t=new this;return t.setupUnchecked(e),t.validate().map(e=>t)}static fromSetupUnchecked(e){let t=new this;return t.setupUnchecked(e),t}clone(){return super.clone()}};const ke=(e,t)=>{if(!x(t))return;let n=e.turn===`white`?5:2,r=e.turn===`white`?8:-8;if(C(t)!==n||e.board.occupied.has(t+r))return;let i=t-r;if(!(!e.board.pawn.has(i)||!e.board[S(e.turn)].has(i)))return t},Ae=e=>{if(!x(e.epSquare))return;let t=e.ctx(),n=e.board.pieces(e.turn,`pawn`).intersect(pe(S(e.turn),e.epSquare));for(let r of n)if(e.dests(r,t).has(e.epSquare))return e.epSquare},F=(e,t,n)=>{if(!x(e.epSquare)||!pe(e.turn,t).has(e.epSquare))return!1;if(!x(n.king))return!0;let r=e.turn===`white`?8:-8,i=e.epSquare-r;return e.kingAttackers(n.king,S(e.turn),e.board.occupied.toggle(t).toggle(i).with(e.epSquare)).without(i).isEmpty()},I=(e,t,n)=>{if(!x(n.king)||n.checkers.nonEmpty())return _.empty();let r=e.castles.rook[e.turn][t];if(!x(r)||e.castles.path[e.turn][t].intersects(e.board.occupied))return _.empty();let i=D(e.turn,t),a=N(n.king,i),o=e.board.occupied.without(n.king);for(let t of a)if(e.kingAttackers(t,S(e.turn),o).nonEmpty())return _.empty();let s=O(e.turn,t),c=e.board.occupied.toggle(n.king).toggle(r).toggle(s);return e.kingAttackers(i,S(e.turn),c).nonEmpty()?_.empty():_.fromSquare(r)},je=(e,t)=>{let n=t.to-t.from;if(!(Math.abs(n)!==2&&!e.board[e.turn].has(t.to))&&e.board.king.has(t.from))return n>0?`h`:`a`},Me=(e,t)=>{let n=je(e,t);if(!n)return t;let r=e.castles.rook[e.turn][n];return{from:t.from,to:x(r)?r:t.to}};var Ne=class e{pawn;knight;bishop;rook;queen;king;constructor(){}static empty(){let t=new e;for(let e of b)t[e]=0;return t}static fromBoard(t,n){let r=new e;for(let e of b)r[e]=t.pieces(n,e).size();return r}clone(){let t=new e;for(let e of b)t[e]=this[e];return t}equals(e){return b.every(t=>this[t]===e[t])}add(t){let n=new e;for(let e of b)n[e]=this[e]+t[e];return n}subtract(t){let n=new e;for(let e of b)n[e]=this[e]-t[e];return n}nonEmpty(){return b.some(e=>this[e]>0)}isEmpty(){return!this.nonEmpty()}hasPawns(){return this.pawn>0}hasNonPawns(){return this.knight>0||this.bishop>0||this.rook>0||this.queen>0||this.king>0}size(){return this.pawn+this.knight+this.bishop+this.rook+this.queen+this.king}},Pe=class e{white;black;constructor(e,t){this.white=e,this.black=t}static empty(){return new e(Ne.empty(),Ne.empty())}static fromBoard(t){return new e(Ne.fromBoard(t,`white`),Ne.fromBoard(t,`black`))}clone(){return new e(this.white.clone(),this.black.clone())}equals(e){return this.white.equals(e.white)&&this.black.equals(e.black)}add(t){return new e(this.white.add(t.white),this.black.add(t.black))}subtract(t){return new e(this.white.subtract(t.white),this.black.subtract(t.black))}count(e){return this.white[e]+this.black[e]}size(){return this.white.size()+this.black.size()}isEmpty(){return this.white.isEmpty()&&this.black.isEmpty()}nonEmpty(){return!this.isEmpty()}hasPawns(){return this.white.hasPawns()||this.black.hasPawns()}hasNonPawns(){return this.white.hasNonPawns()||this.black.hasNonPawns()}},Fe=class e{white;black;constructor(e,t){this.white=e,this.black=t}static default(){return new e(3,3)}clone(){return new e(this.white,this.black)}equals(e){return this.white===e.white&&this.black===e.black}},L;(function(e){e.Fen=`ERR_FEN`,e.Board=`ERR_BOARD`,e.Pockets=`ERR_POCKETS`,e.Turn=`ERR_TURN`,e.Castling=`ERR_CASTLING`,e.EpSquare=`ERR_EP_SQUARE`,e.RemainingChecks=`ERR_REMAINING_CHECKS`,e.Halfmoves=`ERR_HALFMOVES`,e.Fullmoves=`ERR_FULLMOVES`})(L||={});var R=class extends Error{};const Ie=(e,t,n)=>{let r=e.indexOf(t);for(;n-- >0&&r!==-1;)r=e.indexOf(t,r+t.length);return r},Le=e=>/^\d{1,4}$/.test(e)?parseInt(e,10):void 0,Re=e=>{let t=oe(e);return t&&{role:t,color:e.toLowerCase()===e?`black`:`white`}},ze=e=>{let t=Ce.empty(),n=7,r=0;for(let i=0;i<e.length;i++){let a=e[i];if(a===`/`&&r===8)r=0,n--;else{let o=parseInt(a,10);if(o>0)r+=o;else{if(r>=8||n<0)return h.err(new R(L.Board));let o=r+n*8,s=Re(a);if(!s)return h.err(new R(L.Board));e[i+1]===`~`&&(s.promoted=!0,i++),t.set(o,s),r++}}}return n!==0||r!==8?h.err(new R(L.Board)):h.ok(t)},Be=e=>{if(e.length>64)return h.err(new R(L.Pockets));let t=Pe.empty();for(let n of e){let e=Re(n);if(!e)return h.err(new R(L.Pockets));t[e.color][e.role]++}return h.ok(t)},Ve=(e,t)=>{let n=_.empty();if(t===`-`)return h.ok(n);for(let r of t){let t=r.toLowerCase(),i=r===t?`black`:`white`,a=i===`white`?0:7;if(`a`<=t&&t<=`h`)n=n.with(ie(t.charCodeAt(0)-97,a));else if(t===`k`||t===`q`){let r=e[i].intersect(_.backrank(i)).intersect(e.rook.union(e.king)),o=t===`k`?r.last():r.first();n=n.with(x(o)&&e.rook.has(o)?o:ie(t===`k`?7:0,a))}else return h.err(new R(L.Castling))}return y.some(e=>_.backrank(e).intersect(n).size()>2)?h.err(new R(L.Castling)):h.ok(n)},He=e=>{let t=e.split(`+`);if(t.length===3&&t[0]===``){let e=Le(t[1]),n=Le(t[2]);return!x(e)||e>3||!x(n)||n>3?h.err(new R(L.RemainingChecks)):h.ok(new Fe(3-e,3-n))}else if(t.length===2){let e=Le(t[0]),n=Le(t[1]);return!x(e)||e>3||!x(n)||n>3?h.err(new R(L.RemainingChecks)):h.ok(new Fe(e,n))}else return h.err(new R(L.RemainingChecks))},Ue=e=>{let t=e.split(/[\s_]+/),n=t.shift(),r,i=h.ok(void 0);if(n.endsWith(`]`)){let e=n.indexOf(`[`);if(e===-1)return h.err(new R(L.Fen));r=ze(n.slice(0,e)),i=Be(n.slice(e+1,-1))}else{let e=Ie(n,`/`,7);e===-1?r=ze(n):(r=ze(n.slice(0,e)),i=Be(n.slice(e+1)))}let a,o=t.shift();if(!x(o)||o===`w`)a=`white`;else if(o===`b`)a=`black`;else return h.err(new R(L.Turn));return r.chain(e=>{let n=t.shift(),r=x(n)?Ve(e,n):h.ok(_.empty()),o=t.shift(),s;if(x(o)&&o!==`-`&&(s=T(o),!x(s)))return h.err(new R(L.EpSquare));let c=t.shift(),l;x(c)&&c.includes(`+`)&&(l=He(c),c=t.shift());let u=x(c)?Le(c):0;if(!x(u))return h.err(new R(L.Halfmoves));let d=t.shift(),f=x(d)?Le(d):1;if(!x(f))return h.err(new R(L.Fullmoves));let p=t.shift(),m=h.ok(void 0);if(x(p)){if(x(l))return h.err(new R(L.RemainingChecks));m=He(p)}else x(l)&&(m=l);return t.length>0?h.err(new R(L.Fen)):i.chain(t=>r.chain(n=>m.map(r=>({board:e,pockets:t,turn:a,castlingRights:n,remainingChecks:r,epSquare:s,halfmoves:u,fullmoves:Math.max(1,f)}))))})},We=e=>{let t=ae(e.role);return e.color===`white`&&(t=t.toUpperCase()),e.promoted&&(t+=`~`),t},Ge=e=>{let t=``,n=0;for(let r=7;r>=0;r--)for(let i=0;i<8;i++){let a=i+r*8,o=e.get(a);o?(n>0&&(t+=n,n=0),t+=We(o)):n++,i===7&&(n>0&&(t+=n,n=0),r!==0&&(t+=`/`))}return t},Ke=e=>b.map(t=>ae(t).repeat(e[t])).join(``),z=e=>Ke(e.white).toUpperCase()+Ke(e.black),qe=(e,t)=>{let n=``;for(let r of y){let i=_.backrank(r),a=e.kingOf(r);x(a)&&!i.has(a)&&(a=void 0);let o=e.pieces(r,`rook`).intersect(i);for(let e of t.intersect(i).reversed())if(e===o.first()&&x(a)&&e<a)n+=r===`white`?`Q`:`q`;else if(e===o.last()&&x(a)&&a<e)n+=r===`white`?`K`:`k`;else{let t=v[w(e)];n+=r===`white`?t.toUpperCase():t}}return n||`-`},Je=e=>`${e.white}+${e.black}`,Ye=(e,t)=>[Ge(e.board)+(e.pockets?`[${z(e.pockets)}]`:``),e.turn[0],qe(e.board,e.castlingRights),x(e.epSquare)?E(e.epSquare):`-`,...e.remainingChecks?[Je(e.remainingChecks)]:[],...t?.epd?[]:[Math.max(0,Math.min(e.halfmoves,9999)),Math.max(1,Math.min(e.fullmoves,9999))]].join(` `),Xe=(e,t)=>{let n=``;{let r=e.board.getRole(t.from);if(!r)return`--`;if(r===`king`&&(e.board[e.turn].has(t.to)||Math.abs(t.to-t.from)===2))n=t.to>t.from?`O-O`:`O-O-O`;else{let i=e.board.occupied.has(t.to)||r===`pawn`&&w(t.from)!==w(t.to);if(r!==`pawn`){n=ae(r).toUpperCase();let i;if(i=r===`king`?de(t.to).intersect(e.board.king):r===`queen`?xe(t.to,e.board.occupied).intersect(e.board.queen):r===`rook`?be(t.to,e.board.occupied).intersect(e.board.rook):r===`bishop`?ye(t.to,e.board.occupied).intersect(e.board.bishop):fe(t.to).intersect(e.board.knight),i=i.intersect(e.board[e.turn]).without(t.from),i.nonEmpty()){let r=e.ctx();for(let n of i)e.dests(n,r).has(t.to)||(i=i.without(n));if(i.nonEmpty()){let e=!1,r=i.intersects(_.fromRank(C(t.from)));i.intersects(_.fromFile(w(t.from)))?e=!0:r=!0,r&&(n+=v[w(t.from)]),e&&(n+=ne[C(t.from)])}}}else i&&(n=v[w(t.from)]);i&&(n+=`x`),n+=E(t.to),t.promotion&&(n+=`=`+ae(t.promotion).toUpperCase())}}return n},Ze=(e,t)=>{let n=Xe(e,t);return e.play(t),e.outcome()?.winner?n+`#`:e.isCheck()?n+`+`:n},Qe=(e,t)=>Ze(e.clone(),t);function B(e){return Oe.fromSetup(Ue(e).unwrap()).unwrap()}const $e=[1,2,3,4,5,6],V=[9,10,11,12,13,14];[...$e,...V];function et(e){return e>>3}function H(e){return e&7}function tt(e){let t=et(e),n=H(e);return{color:rt(t),role:nt(n)}}function nt(e){switch(e){case 1:return`pawn`;case 2:return`knight`;case 3:return`bishop`;case 4:return`rook`;case 5:return`queen`;case 6:return`king`}throw`No Piece Type`}function rt(e){return e===0?`white`:`black`}function it(e,t){return 0+(e<<6)+t}function at(e){let t=e&63;return{from:e>>6&63,to:t,promotion:(e&49152)==16384?nt((e>>12&3)+2):void 0}}var U=class e{m;static async make(t){let n=await d({locateFile:t});return n._init(),new e(n)}constructor(e){this.m=e}create_position(e){return this.m._create_position(this.stringToWasm(e))}delete_position(e){this.m._delete_position(e)}unmake_move(e,t){this.m._unmake_move(e,t)}make_move(e,t){this.m._make_move(e,t)}pos_turn(e){return this.m._get_turn(e)}get_legal_moves(e){let t=this.m._malloc(4),n=this.m._get_legal_moves(e,t),r=this.m.getValue(t,`i32`),i=[];for(let e=0;e<r;e++){let t=this.m.getValue(n+e*4,`i32`);i.push(t)}return this.m._free(t),this.m._free(n),i}pos_occupied(e){let t=this.m._malloc(8);this.m._get_occupied(e,t);let n=this.m.getValue(t,`i32`),r=this.m.getValue(t+4,`i32`);return this.m._free(t),new _(n,r)}attacks(e,t,n){let r=this.m._malloc(8);this.m._attacks(e,t,n.lo,n.hi,r);let i=this.m.getValue(r,`i32`),a=this.m.getValue(r+4,`i32`);return this.m._free(r),new _(i,a)}pos_attacks(e,t){let n=this.m._malloc(8);this.m._pos_attacks(e,t,n);let r=this.m.getValue(n,`i32`),i=this.m.getValue(n+4,`i32`);return this.m._free(n),new _(r,i)}pos_attacks_of_color(e,t){let n=this.m._malloc(8);this.m._pos_attacks_to(e,t,0,n);let r=this.m.getValue(n,`i32`),i=this.m.getValue(n+4,`i32`);return this.m._free(n),new _(r,i)}pawn_pushes(e,t){let n=this.m._malloc(8);this.m._pawn_pushes(e,t,n);let r=this.m.getValue(n,`i32`),i=this.m.getValue(n+4,`i32`);return this.m._free(n),new _(r,i)}get_pieces_color_bb(e,t){let n=this.m._malloc(8);this.m._get_pieces_color_bb(e,t,n);let r=this.m.getValue(n,`i32`),i=this.m.getValue(n+4,`i32`);return this.m._free(n),new _(r,i)}get_pieces_bb(e,t){let n=this.m._malloc(8),r=this.m._malloc(4*t.length);for(let e=0;e<t.length;e++)this.m.setValue(r+e*4,t[e],`i32`);this.m._get_pieces_bb(e,r,t.length,n);let i=this.m.getValue(n,`i32`),a=this.m.getValue(n+4,`i32`);return this.m._free(n),this.m._free(r),new _(i,a)}get_at(e,t){let n=this.m._get_at(e,t);if(n!==0)return n}is_checkmate(e){return this.m._is_checkmate(e)}checkers(e){let t=this.m._malloc(8);this.m._checkers(e,t);let n=this.m.getValue(t,`i32`),r=this.m.getValue(t+4,`i32`);return this.m._free(t),new _(n,r)}get_fen(e){return this.wasmToStringAndFree(this.m._get_fen(e))}get_pos_read_fen(e){return B(this.get_fen(e))}make_san(e,t){return Qe(this.get_pos_read_fen(e),at(t))}stringToWasm(e){let t=this.m,n=e.length+1,r=t._malloc(n);return t.stringToUTF8(e,r,n),r}wasmToStringAndFree(e){return this.m.UTF8ToString(e)}},W=class extends Error{constructor(e){super(`No child with id ${e}`)}},ot=class{cache;constructor(){this.cache=new Map}get_node(e){return this.cache.get(e)}add_node(e){this.cache.set(e.id,e)}},G=class{children;constructor(){this.children=new Map}add_move(e){let t=this.children.get(e);if(t)return t;let n=new st(this,e);return this.children.set(e,n),n}},st=class e{static gen_node_id=(()=>{let e=1;return()=>e++})();id;parent;move;children;constructor(t,n){this.id=e.gen_node_id(),this.parent=t,this.move=n,this.children=new Map}add_move(t){let n=this.children.get(t);if(n)return n;let r=new e(this,t);return this.children.set(t,r),r}},ct=class{cache;root;constructor(){this.cache=new ot,this.root=new G}add_move(e,t){if(e===0){let e=this.root.add_move(t);return this.cache.add_node(e),e.id}let n=this.cache.get_node(e);if(!n)throw new W(e);let r=n.add_move(t);return this.cache.add_node(r),r.id}is_a_successor_of_b(e,t){let n=this.cache.get_node(e);if(!n)throw new W(t);if(t===0)return n.parent===this.root;let r=this.cache.get_node(t);if(!r)throw new W(t);return n.parent===r}prefix_test(e,t){if(t===0)return!0;if(e===0)return!1;if(e===t)throw Error(`Same Id Prefix Test `+e);let n=this.cache.get_node(e);if(!n)throw new W(e);let r=this.cache.get_node(t);if(!r)throw new W(t);let i=n.parent;for(;!(i instanceof G);){if(i.id===r.id)return!0;i=i.parent}return!1}history_moves(e){if(e===0)return[];let t=this.cache.get_node(e);if(!t)throw new W(e);let n=[t.move],r=t.parent;for(;!(r instanceof G);)n.unshift(r.move),r=r.parent;return n}depth_of(e){if(e===0)return 0;let t=this.cache.get_node(e);if(!t)throw new W(e);let n=1,r=t.parent;for(;!(r instanceof G);)n++;return n}},lt=class extends Error{},ut=class extends Error{},K;(function(e){e.Different=`Different`,e.Equal=`Equal`,e.BeginFact=`BeginFact`,e.BeginIdea=`BeginIdea`,e.BeginMotif=`BeginMotif`,e.Legal=`Legal`,e.Alias=`Alias`,e.Line=`Line`,e.Word=`Word`,e.Const=`Const`,e.Dot=`Dot`,e.Between=`Between`,e.Newline=`Newline`,e.Eof=`Eof`})(K||={});var q;(function(e){e.King=`King`,e.Queen=`Queen`,e.Bishop=`Bishop`,e.Rook=`Rook`,e.Knight=`Knight`,e.Pawn=`Pawn`})(q||={});const J=[q.King,q.Queen,q.Bishop,q.Rook,q.Knight,q.Pawn];function Y(e){return J.includes(e)}var dt=class{text;pos;current_char;constructor(e){this.text=e,this.pos=0,this.current_char=this.text[this.pos]}advance(){this.current_char=this.text[++this.pos]}skip_whitespace(){let e=!1;for(;this.current_char!==void 0&&/\s/.test(this.current_char);){if(this.current_char===`
`){e=!0,this.advance();break}this.advance()}return e}is_lowercase_num(e){return/[a-z0-9_]/.test(e)}is_uppercase_num(e){return/[A-Z0-9]/.test(e)}word(){let e=``;for(;this.current_char!==void 0&&this.is_lowercase_num(this.current_char);)e+=this.current_char,this.advance();return e}constant(){let e=``;if(this.current_char!==void 0&&this.is_uppercase_num(this.current_char))for(e+=this.current_char,this.advance();this.current_char!==void 0&&this.is_lowercase_num(this.current_char);)e+=this.current_char,this.advance();return e}get_next_token(){for(;this.current_char!==void 0;){if(this.skip_whitespace())return{type:K.Newline,value:`
`};if(this.current_char===`!`&&(this.advance(),this.current_char===`=`))return this.advance(),{type:K.Different,value:`!=`};if(this.current_char===`=`)return this.advance(),{type:K.Equal,value:`=`};if(this.current_char===`.`)return this.advance(),{type:K.Dot,value:`.`};let e=this.constant();if(Y(e))return{type:K.Const,value:e};let t=this.word();if(t===`between`)return{type:K.Between,value:`between`};if(t===`fact`)return{type:K.BeginFact,value:`fact`};if(t===`idea`)return{type:K.BeginIdea,value:`fact`};if(t===`motif`)return{type:K.BeginMotif,value:`motif`};if(t===`alias`)return{type:K.Alias,value:`alias`};if(t===`line`)return{type:K.Line,value:`line`};if(t===`legal`)return{type:K.Legal,value:`legal`};if(t!==void 0)return{type:K.Word,value:t};if(this.current_char===void 0)break;throw new ut(`Unexpected token ${this.current_char}`)}return{type:K.Eof,value:``}}},ft=class{lexer;current_token;lookahead_token;constructor(e){this.lexer=e,this.current_token=this.lexer.get_next_token(),this.lookahead_token=this.lexer.get_next_token()}advance_tokens(){this.current_token=this.lookahead_token,this.lookahead_token=this.lexer.get_next_token()}eat(e){if(this.current_token.type===e){let e=this.current_token.value;return this.advance_tokens(),e}else throw this.error(e)}error(e){return e?new lt(`Expected ${e} but got ${this.current_token.type} ('${this.current_token.value}')`):new lt(`Unexpected token ${this.current_token.type} ('${this.current_token.value}')`)}parse_assigns(){this.eat(K.Dot);let e=this.word();this.eat(K.Equal);let t=this.path();return{[e]:t}}parse_match(){let e=this.path_or_constant();return this.current_token.type===K.Between?(this.eat(K.Between),{path_a:e,path_b:this.path_or_constant(),path_c:this.path_or_constant()}):this.current_token.type===K.Different?(this.eat(K.Different),{path_a:e,path_b:this.path_or_constant(),is_different:!0}):(this.eat(K.Equal),{path_a:e,path_b:this.path_or_constant()})}parse_alias(){return this.eat(K.Alias),{alias:this.path(),column:this.path()}}parse_line(){this.eat(K.Line);let e=[];for(;this.current_token.type!==K.Newline&&this.current_token.type!==K.Eof;)e.push(this.word());return e}word(){return this.eat(K.Word)}path(){let e=``;for(;e+=this.word(),this.current_token.type===K.Dot;)this.eat(K.Dot),e+=`.`;return mt(e)}path_or_constant(){return this.current_token.type===K.Const?[this.eat(K.Const),``]:this.path()}parse_fact(){if(this.current_token.type===K.BeginFact){this.eat(K.BeginFact);let e=this.word();this.eat(K.Newline);let t=[];for(;this.current_token.type===K.Alias;)t.push(this.parse_alias()),this.eat(K.Newline);let n=[];for(;this.current_token.type===K.Dot;)n.push(this.parse_assigns()),this.eat(K.Newline);let r=[];for(;r.push(this.parse_match()),this.current_token.type===K.Newline&&this.advance_tokens(),!(this.current_token.type===K.Newline||this.current_token.type===K.Eof););return{name:e,assigns:n,matches:r,aliases:t}}}parse_idea(){if(this.current_token.type===K.BeginIdea){this.eat(K.BeginIdea);let e=this.eat(K.Word);this.eat(K.Newline);let t=[];for(;this.current_token.type===K.Alias;)t.push(this.parse_alias()),this.eat(K.Newline);this.current_token.type===K.Newline&&this.eat(K.Newline);let n=this.parse_line();if(this.current_token.type===K.Eof)return{name:e,line:n,assigns:[],matches:[],aliases:t};this.eat(K.Newline);let r=[];for(;this.current_token.type===K.Dot;)r.push(this.parse_assigns()),this.eat(K.Newline);let i=[];for(;;){let e=this.current_token;if(this.current_token.type===K.Newline&&this.advance_tokens(),e.type===K.Eof||(e=this.current_token,e.type===K.Newline)||(e=this.current_token,e.type===K.Eof))break;i.push(this.parse_match())}return{name:e,line:n,assigns:r,matches:i,aliases:t}}}parse_motif(){if(this.current_token.type===K.BeginMotif){this.eat(K.BeginMotif);let e=this.eat(K.Word);this.eat(K.Newline);let t=[];for(;this.current_token.type===K.Alias;)t.push(this.parse_alias()),this.eat(K.Newline);this.current_token.type===K.Newline&&this.eat(K.Newline);let n=this.parse_line();this.eat(K.Newline);let r=[];for(;this.current_token.type===K.Dot;)r.push(this.parse_assigns()),this.eat(K.Newline);let i=[];for(;i.push(this.parse_match()),this.current_token.type===K.Newline&&this.advance_tokens(),!(this.current_token.type===K.Newline||this.current_token.type===K.Eof););return{name:e,line:n,assigns:r,matches:i,aliases:t}}}parse_program(){let e=new Map,t=new Map,n=[],r=[],i=this.current_token;for(;i.type!==K.Eof;){for(;this.current_token.type===K.Newline;)this.advance_tokens();if(this.current_token.type===K.Eof)break;if(this.current_token.type===K.Legal){this.eat(K.Legal),n.push(this.word());continue}let i=this.parse_fact();if(i){e.set(i.name,i);continue}let a=this.parse_idea();if(a){t.set(a.name,a);continue}let o=this.parse_motif();if(o){r.push(o);continue}throw new lt(`Fact or Idea expected.`)}return{facts:e,ideas:t,motives:r,legals:n}}};function X(e){return e.path_c!==void 0}function pt(e){return new ft(new dt(e)).parse_program()}function mt(e){let[t,...n]=e.split(`.`);return[t,n.join(`.`)]}function ht(e,t){return{rows:e.rows.filter(t)}}function gt(e,t){let n=new Map(e);for(let[e,r]of t){if(n.has(e)&&n.get(e)!==r)return null;n.set(e,r)}return n}function _t(e,t,n){let r=[];for(let i of e.rows)for(let e of t.rows){let t=n?n(i,e):gt(i,e);t&&r.push(t)}return{rows:r}}function vt(e){let t=[];for(let n of e.rows){let e=[];for(let t=1;t<8;t++){let r=t==1?``:t;if(!n.has(`from`+r))break;e.push(it(n.get(`from`+r),n.get(`to`+r)))}t.find(t=>yt(t,e))||t.push(e)}return t}function yt(e,t){for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}var bt=class extends Error{constructor(e){super(`No such column ${e}.`)}},xt=class extends Error{constructor(e){super(`No end world id ${e}.`)}},Z;(function(e){e[e.UNREQUESTED=0]=`UNREQUESTED`,e[e.REQUESTED=1]=`REQUESTED`,e[e.MATERIALIZING=2]=`MATERIALIZING`,e[e.COMPLETE=3]=`COMPLETE`})(Z||={});const St=e=>{let t=0;for(let n of e)t=(t<<5)-t+n.charCodeAt(0),t|=0;return t};function Ct(e,t){return St(e)+t,St(e)+t}function Q(e,t){return{key:Ct(e,t),column:e,world_id:t,state:Z.UNREQUESTED}}var wt=class{active_ideas;pending_prefixes;facts;fact_queue;active_fact_joins;pending_fact_joins;program;m;pos;nodes;constructor(e,t,n){this.nodes=new ct,this.m=e,this.pos=t,this.active_ideas=new Set,this.pending_prefixes=new Map,this.facts=new Map,this.fact_queue=[],this.active_fact_joins=new Set,this.pending_fact_joins=new Map,this.program=pt(n),this.RMs=new Map}RMs;get_continuations(e){let t=this.RMs.get(e);if(!t)throw new bt(e);return vt(t.get_relation_starting_at_world_id(0))}get_or_create_M(e){return this.RMs.has(e)||this.RMs.set(e,new Tt(e)),this.RMs.get(e)}suspend_prefix_to_request_facts(e,t){let n=this.pending_prefixes.get(t);n?n.add(e):this.pending_prefixes.set(t,new Set([e]))}resume_waiting_prefixes(e){let t=this.pending_prefixes.get(e);if(t){for(let e of t)e.owner.worklist.push(e),this.active_ideas.add(e.owner),e.owner.notify_resume_idea();this.pending_prefixes.delete(e)}}resume_waiting_facts(e){let t=this.pending_fact_joins.get(e.key);if(t){for(let n of t)n.dependencies.set(e.key,n);this.pending_fact_joins.delete(e.key)}}complete_fact(e){e.state=Z.COMPLETE,this.resume_waiting_facts(e),this.resume_waiting_prefixes(e.key)}complete_idea(e){this.active_ideas.delete(e),this.complete_fact(e.fact)}is_facts_joined(e){return this.facts.get(e)?.state===Z.COMPLETE}request_fact(e,t){let n=Ct(e,t),r=this.facts.get(n);r||(r=Q(e,t),this.facts.set(n,r),this.fact_queue.push(r))}request_fact_join(e){let t=this.facts.get(e.key);if(t&&t.state===Z.MATERIALIZING)return;e.state=Z.MATERIALIZING;let n=new jt(e,this.m,this.pos,this.program,this);this.facts.set(e.key,e),this.active_fact_joins.add(n)}request_idea_join(e){let t=this.program.ideas.get(e.column);if(!t){this.request_fact_join(e);return}let n=this.facts.get(e.key);if(n&&n.state===Z.MATERIALIZING)return;e.state=Z.MATERIALIZING;let r=new Ot(e,t,this);this.facts.set(e.key,e),this.active_ideas.add(r)}suspend_fact_join_to_request_facts(e,t){let n=this.pending_fact_joins.get(t);n?n.add(e):this.pending_fact_joins.set(t,new Set([e]))}run(){for(;this.fact_queue.length>0||this.active_ideas.size>0||this.active_fact_joins.size>0;){if(this.fact_queue.length>0){let e=this.fact_queue.shift();e.state===Z.UNREQUESTED&&this.request_idea_join(e)}for(let e of this.active_fact_joins)e.step();for(let e of this.active_ideas)e.step()}}},Tt=class{base;name;index_start_world;key_index;constructor(e){this.base={rows:[]},this.name=e,this.index_start_world=new Map,this.key_index=new Map}compute_key(e){let t=1;for(let[n,r]of e)t+=r+1,t*=r+1,t+=Math.sin(r)+1+Math.sin(r+1);return t=Math.floor(t),t}add_rows(e,t){for(let n of t){let t=this.compute_key(n);if(this.key_index.has(t))continue;let r=this.base.rows.length;this.base.rows.push(n),this.key_index.set(t,r),this.index_start_world.has(e)||this.index_start_world.set(e,[]),this.index_start_world.get(e).push(r)}}add_row(e){let t=this.compute_key(e);if(this.key_index.has(t))return;let n=this.base.rows.length;this.base.rows.push(e),this.key_index.set(t,n);let r=e.get(`start_world_id`);if(r!==void 0){let e=this.index_start_world.get(r);e?e.push(n):this.index_start_world.set(r,[n])}}get_relation_starting_at_world_id(e){return{rows:this.get_row_ids_starting_at_world_id(e).map(e=>this.base.rows[e])}}get_row_ids_starting_at_world_id(e){return this.index_start_world.get(e)??[]}get_row(e){return this.base.rows[e]}lookupRows(e,t){let n=this.get_row_ids_starting_at_world_id(e);for(let{column:e,value:r}of t)n=n.filter(t=>this.base.rows[t].get(e)===r);return n}};function Et(e,t,n){if(t.length===0)return n;let r=e.get_row(t.bindings[t.length-1]).get(`end_world_id`);if(!r)throw new xt(e.name);return r}function Dt(e,t,n){return{owner:n,length:e.length+1,bindings:[...e.bindings,t],env:e.env}}var Ot=class{scheduler;worklist;spec;waiting_on_facts;get line(){return this.spec.line}Ms;fact;constructor(e,t,n){this.fact=e,this.waiting_on_facts=0,this.spec=t,this.scheduler=n,this.worklist=[{owner:this,length:0,bindings:[],env:new Map}],this.Ms=this.line.map(e=>this.scheduler.get_or_create_M(Nt(e,this.spec.aliases))),this.scheduler.get_or_create_M(this.spec.name)}get_row(e,t){return this.Ms[e].get_row(t)}insert_line_into_relation(e){let t=new Map,n=this.get_row(0,e.bindings[0]),r=this.get_row(e.length-1,e.bindings[e.length-1]);t.set(`start_world_id`,n.get(`start_world_id`)),t.set(`end_world_id`,r.get(`end_world_id`));let i=0;for(let n=0;n<e.bindings.length;n++){let r=this.get_row(n,e.bindings[n]);for(let e=0;e<8;e++){let n=e===0?``:e+1,a=i===0?``:i+1;if(!r.has(`from${n}`))break;i++,t.set(`from${a}`,r.get(`from${n}`)),t.set(`to${a}`,r.get(`to${n}`))}}for(let n of this.spec.assigns){let[r]=Object.keys(n),[i,a]=$(n[r]),o=this.spec.line.findIndex(e=>e===i),s=this.get_row(o,e.bindings[o]);t.set(`${r}`,s.get(`${a}`))}this.scheduler.get_or_create_M(this.spec.name)?.add_row(t)}notify_resume_idea(){this.waiting_on_facts--}step(){if(this.worklist.length===0){this.waiting_on_facts===0?this.scheduler.complete_idea(this):this.scheduler.active_ideas.delete(this);return}let e=this.worklist.pop();if(e.length===this.line.length){this.insert_line_into_relation(e);return}let t=e.length,n=this.Ms[t-1],r=this.Ms[t],i=Et(n,e,this.fact.world_id),a=Ct(r.name,i);if(!this.scheduler.is_facts_joined(a)){this.waiting_on_facts++,this.scheduler.suspend_prefix_to_request_facts(e,a),this.scheduler.request_fact(r.name,i);return}for(let t of r.get_row_ids_starting_at_world_id(i)){let n=Dt(e,t,this);this.constraints_hold(n)&&this.worklist.push(n)}}constraints_hold(e){let t=!0,n=new Map;for(let r of this.spec.matches){if(X(r))return!1;let[i,a]=$(r.path_a),[o,s]=$(r.path_b),c=this.spec.line.findIndex(e=>e===i),l=this.spec.line.findIndex(e=>e===o),u;if(Y(o)&&(u=Pt[o]),!a){if(u!==void 0){let e=n.get(i);e===void 0?e.set(i,u):t&&=e===u}else{let r=this.get_row(l,e.bindings[l]);if(r===void 0)return!0;let a=n.get(i);a===void 0?n.set(i,r.get(s)):t&&=a===r.get(s)}continue}let d=this.get_row(c,e.bindings[c]);if(d===void 0)return!0;if(u!==void 0){let e=d.get(a),n=u;t&&=r.is_different?e!==n:e===n}else{let n=this.get_row(l,e.bindings[l]);if(n===void 0)return!0;let i=d,o=n,c=i.get(a),u;u=s?o.get(s):0,t&&=r.is_different?c!==u:c===u}if(!t)return!1}return t}};function kt(e){let t=[],n=[],r=[];for(let n of e.aliases)t.push({alias:n.alias[0],relation:n.column[0]});for(let r of e.matches){let e=r.path_a[0],i=r.path_a[1];i!==``&&!t.find(t=>t.alias===e)&&t.push({alias:e,relation:e});let a=r.path_b[0],o=r.path_b[1];o!==``&&!t.find(e=>e.alias===a)&&t.push({alias:a,relation:a});let s=X(r)?!1:r.is_different===!0;n.push({left:{alias:e,relation:i},right:{alias:a,relation:o},is_different:s})}for(let t of e.assigns)for(let[e,n]of Object.entries(t))r.push({column:e,expr:{alias:n[0],relation:n[1]}});return{name:e.name,sources:t,joins:n,output:r}}function At(e,t){for(let n of t){let t=e.get(n.left.alias),r=e.get(n.right.alias);if(!(t===void 0||r===void 0)){if(n.is_different){if(t.get(n.left.relation)===r.get(n.right.relation))return!1}else if(t.get(n.left.relation)!==r.get(n.right.relation))return!1}}return!0}var jt=class{m;pos;program;get Rs(){return this.scheduler.RMs}get nodes(){return this.scheduler.nodes}dependencies;scheduler;fact;constructor(e,t,n,r,i){this.fact=e,this.scheduler=i,this.m=t,this.pos=n,this.program=r,this.dependencies=new Map,this.Rs.get(e.column)===void 0&&this.Rs.set(e.column,new Tt(e.column))}add_row(e,t){let n=this.Rs.get(e);n||(n=new Tt(e),this.Rs.set(e,n)),n.add_row(t)}add_rows(e,t,n){let r=this.Rs.get(e);r||(r=new Tt(e),this.Rs.set(e,r)),r.add_rows(t,n)}worklist_check_fact(e){let t=this.dependencies.get(e.key);if(!t){this.scheduler.suspend_fact_join_to_request_facts(this,e.key),this.scheduler.request_idea_join(e);return}return t.Rs.get(e.column)?.get_relation_starting_at_world_id(e.world_id)}step(){let e=!0,t=this.fact;switch(t.column){case`occupies`:this.make_moves_to_world(t.world_id),e=this.materialize_occupies(t.world_id),this.unmake_moves_to_base(t.world_id);break;case`push`:this.make_moves_to_world(t.world_id),e=this.materialize_pushes(t.world_id),this.unmake_moves_to_base(t.world_id);break;case`moves`:this.make_moves_to_world(t.world_id),e=this.materialize_moves(t.world_id),this.unmake_moves_to_base(t.world_id);break;case`attacks`:this.make_moves_to_world(t.world_id),e=this.materialize_attacks(t.world_id),this.unmake_moves_to_base(t.world_id);break;case`attacks2`:this.make_moves_to_world(t.world_id),e=this.materialize_attacks2(t.world_id),this.unmake_moves_to_base(t.world_id);break;default:e=this.join_with_program(t)}if(!e)return!1;this.scheduler.active_fact_joins.delete(this),this.scheduler.complete_fact(this.fact)}emitRow(e,t,n){let r=new Map;for(let{column:e,expr:i}of n)r.set(e,t.get(i.alias)?.get(i.relation));r.set(`start_world_id`,this.fact.world_id),this.scheduler.get_or_create_M(e.column).add_row(r)}join_with_execute_fact(e){let t=this.program.facts.get(e.column);return this.executeFact(e,kt(t),e.world_id)}executeFact(e,t,n){let r=t.sources,i=t.joins,a=this;function o(e,t,n){let r=[];for(let t of i)t.left.alias===e.alias&&Y(t.right.alias)?r.push({column:t.left.relation,value:Pt[t.right.alias]}):t.left.alias===e.alias&&n.has(t.right.alias)&&r.push({column:t.left.relation,value:n.get(t.right.alias).get(t.right.relation)}),t.right.alias===e.alias&&n.has(t.left.alias)&&r.push({column:t.right.relation,value:n.get(t.left.alias).get(t.left.relation)});return a.Rs.get(e.relation).lookupRows(t,r)}function s(c,l){if(l===r.length){a.emitRow(e,c,t.output);return}let u=r[l],d=o(u,n,c);for(let e of d){let t=a.Rs.get(u.relation).get_row(e);c.set(u.alias,t),At(c,i)&&s(c,l+1),c.delete(u.alias)}}for(let e of r)if(this.worklist_check_fact(Q(e.relation,n))===void 0)return!1;return s(new Map,0),!0}join_with_program(e){let t=this.program.facts.get(e.column),n=!0;if(t&&(n=this.join_with_execute_fact(e)),!n)return!1;let r=this.program.legals.find(t=>t===e.column);return r&&(n=this.join_legal_with_p(e,r)),!!n}join_legal_with_p(e,t){let n=t.replace(`_moves`,``),r=this.worklist_check_fact(Q(n,e.world_id));if(r===void 0)return!1;let i=this.worklist_check_fact(Q(`moves`,e.world_id));if(i===void 0)return!1;let a=_t(r,i,(t,n)=>{let r=t,i=n;return r.get(`from`)===i.get(`from`)&&r.get(`to`)===i.get(`to`)?(()=>{let t=new Map;t.set(`start_world_id`,e.world_id),t.set(`end_world_id`,n.get(`end_world_id`));for(let[e,n]of r)t.set(e,n);return t})():null});return this.add_rows(e.column,e.world_id,a.rows),!0}join_fact_between_p(e,t){let n,r=t.matches[0];{if(!X(r))return!1;let[i,a]=$(r.path_a),[o,s]=$(r.path_b),[c,l]=$(r.path_c),u=this.worklist_check_fact(Q(Nt(i,t.aliases),e.world_id));if(u===void 0)return!1;let d=this.worklist_check_fact(Q(Nt(o,t.aliases),e.world_id));if(d===void 0)return!1;n=_t(u,d,(n,r)=>{let a=n,o=r,s=!0;for(let e of t.matches){if(!X(e))continue;let[t,n]=$(e.path_a),[r,i]=$(e.path_b),[c,l]=$(e.path_c),u=c===t?a:o,d=a.get(n),f=o.get(i),p=u.get(l);s&&=N(f,p).has(d)}return s?(()=>{let n=new Map;n.set(`start_world_id`,e.world_id);for(let e of t.assigns){let[t]=Object.keys(e),[r,s]=$(e[t]),c=r===i?a:o;n.set(`${t}`,c.get(`${s}`))}return n})():null})}return this.add_rows(e.column,e.world_id,n.rows),!0}join_fact_with_p(e,t){let n,r=t.matches[0];{if(X(r))return this.join_fact_between_p(e,t);let[i,a]=$(r.path_a),[o,s]=$(r.path_b);if(o===`KING`){let r=this.worklist_check_fact(Q(Nt(i,t.aliases),e.world_id));if(r===void 0)return!1;n=ht(r,e=>e.get(a)===6)}else{let r=this.worklist_check_fact(Q(Nt(i,t.aliases),e.world_id));if(r===void 0)return!1;let a=this.worklist_check_fact(Q(Nt(o,t.aliases),e.world_id));if(a===void 0)return!1;n=_t(r,a,(n,r)=>{let a=!0;for(let e of t.matches){if(X(e))continue;let[t,s]=$(e.path_a),[c,l]=$(e.path_b),u=t===i?n:r,d=c===i?n:r,f=u.get(s),p;if(p=o===`KING`?6:l?d.get(l):0,a&&=e.is_different?f!==p:f===p,!a)break}return a?(()=>{let a=new Map;a.set(`start_world_id`,e.world_id);for(let e of t.assigns){let[t]=Object.keys(e),[o,s]=$(e[t]),c=o===i?n:r;a.set(`${t}`,c.get(`${s}`))}return a})():null})}}return this.add_rows(e.column,e.world_id,n.rows),!0}materialize_attacks2(e){for(let t of _.full()){let n=this.m.get_at(this.pos,t);if(n){let r=this.m.attacks(n,t,this.m.pos_occupied(this.pos));for(let i of r){let r=this.m.attacks(n,i,this.m.pos_occupied(this.pos).without(t));for(let a of r)this.add_row(`attacks2`,new Map([[`start_world_id`,e],[`from`,t],[`to`,i],[`to2`,a],[`piece`,H(n)],[`color`,et(n)]]))}}}return!0}materialize_attacks(e){for(let t of _.full()){let n=this.m.get_at(this.pos,t);if(n){let r=this.m.attacks(n,t,this.m.pos_occupied(this.pos));for(let i of r)this.add_row(`attacks`,new Map([[`start_world_id`,e],[`from`,t],[`to`,i],[`piece`,H(n)],[`color`,et(n)]]))}}return!0}materialize_vacants(e){for(let t of _.full())this.m.get_at(this.pos,t)||this.add_row(`vacants`,new Map([[`start_world_id`,e],[`square`,t]]));return!0}materialize_pushes(e){for(let t of _.full()){let n=this.m.get_at(this.pos,t);if(n&&H(n)===1){let r=this.m.pawn_pushes(this.pos,t);for(let i of r){let r=this.m.attacks(n,i,this.m.pos_occupied(this.pos).without(t).with(i));for(let n of r)this.add_row(`push`,new Map([[`start_world_id`,e],[`from`,t],[`to`,i],[`to2`,n]]))}}}return!0}materialize_occupies(e){for(let t of _.full()){let n=this.m.get_at(this.pos,t);n&&this.add_row(`occupies`,new Map([[`start_world_id`,e],[`square`,t],[`piece`,H(n)],[`color`,et(n)]]))}return!0}make_moves_to_world(e){let t=this.nodes.history_moves(e);for(let e of t)this.m.make_move(this.pos,e)}unmake_moves_to_base(e){let t=this.nodes.history_moves(e);for(let e=t.length-1;e>=0;e--){let n=t[e];this.m.unmake_move(this.pos,n)}}materialize_moves(e){let t=this.m.get_legal_moves(this.pos);for(let n of t){let t=this.nodes.add_move(e,n),{from:r,to:i}=at(n);this.add_row(`moves`,new Map([[`from`,r],[`to`,i],[`start_world_id`,e],[`end_world_id`,t]]))}return!0}};function Mt(e,t,n){let r=new wt(e,t,n),i=pt(n);return[...i.facts.keys(),...i.ideas.keys(),...i.legals].forEach(e=>r.request_fact(e,0)),r.run(),r.RMs}function Nt(e,t){return t.find(t=>t.alias[0]===e)?.column[0]??e}function $(e){return e}const Pt={King:6,Queen:5,Rook:4,Bishop:3,Knight:2,Pawn:1},Ft=e=>We(e),It=e=>E(e);var Lt=``+new URL(`hopefox-5gN6Nwd4.wasm`,import.meta.url).href;const Rt=async()=>zt(await fetch(`/data/athousand_sorted.csv`).then(e=>e.text()));function zt(e){return e.trim().split(`
`).map(e=>{let[t,n,r,i,a,o,s,c]=e.split(`,`),l=[],u=`https://lichess.org/training/${t}`,d=!0;return{id:t,link:u,fen:n,moves:r,tags:c,get move_fens(){let e=[],t=Oe.fromSetup(Ue(n).unwrap()).unwrap();return r.split(` `).forEach((n,r)=>{let i=se(n);d&&r>0&&l.push(Qe(t,i)),t.play(i),e.push(Ye(t.toSetup()))}),d=!1,e},sans:l}})}let Bt,Vt;(async()=>{Bt=await U.make(()=>Lt),Vt=await Rt(),postMessage(`ready`)})();const Ht=(e,t)=>{let n=Bt.create_position(e),r,i;try{r=[...Mt(Bt,n,t).values()]}catch(e){e instanceof Error&&(i=e.message)}return Bt.delete_position(n),{relations:r?.map(t=>Kt(B(e),t)),error:i}};let Ut=[501,502,504,506,507,508,509,510,512,513,514,516,517,519,521,522,524,528,529,534,535,537,538,539,540,541,542,544,546,547,549,554,555,556,557,558,559,560,561,562,565,568,570,571,573,574,575,576,577,578,580,581,583,584,585,587,588,590,591,593,594,595,596,597,598,599],Wt;const Gt=e=>{let t=[];clearTimeout(Wt);function n(r){let i=performance.now();for(;r<Ut.length;r++){let a=Vt[r];if(t.push({puzzle:a,result:Ht(a.move_fens[0],e)}),postMessage({t:`progress`,d:`${r+1} ${Ut.length}`}),performance.now()-i>16){Wt=setTimeout(()=>n(r+1));return}}postMessage({t:`run_on_skips`,d:t})}n(0)};onmessage=async e=>{if(e.data.t===`list`&&postMessage({t:`list`,d:Ut.map(e=>Vt[e])}),e.data.t===`one`){let t=Vt.find(t=>t.id===e.data.d.id),n=e.data.d.program,r=Ht(t.move_fens[e.data.d.cursor],n);postMessage({t:`run_on_one`,d:{puzzle:t,result:r}})}if(e.data.t===`batch`){let t=e.data.d.program;Gt(t)}};function Kt(e,t){let n=t.get_relation_starting_at_world_id(0).rows.map(t=>qt(e,t));return{name:t.name,rows:n}}function qt(e,t){let n={},r=e=>It(e),i=e=>Ft(tt(e)),a=e=>e===0?`White`:`Black`;for(let[e,o]of t.entries())switch(e){case`from`:case`to`:case`to2`:case`square`:n[e]=r(o);break;case`piece`:n[e]=i(o);break;case`color`:n[e]=a(o);break;default:e.includes(`piece`)?n[e]=i(o):n[e]=o}let o=Jt(e,Yt(t));return o.length>0&&(n.line=o.join(` `)),n}function Jt(e,t){let n=[],r=e.clone();for(let e=0;e<t.length;e++){let i=at(t[e]);n.push(Qe(r,i)),r.play(i)}return n}function Yt(e){let t=[];for(let n=1;n<8;n++){let r=n==1?``:n;if(!e.has(`from`+r))break;t.push(it(e.get(`from`+r),e.get(`to`+r)))}return t}export{o as t};