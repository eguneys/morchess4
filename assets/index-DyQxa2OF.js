(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();var e={context:void 0,registry:void 0,effects:void 0,done:!1,getContextId(){return t(this.context.count)},getNextContextId(){return t(this.context.count++)}};function t(t){let n=String(t),r=n.length-1;return e.context.id+(r?String.fromCharCode(96+r):``)+n}function n(t){e.context=t}function r(){return{...e.context,id:e.getNextContextId(),count:0}}var i=(e,t)=>e===t,a=Symbol(`solid-proxy`),o=typeof Proxy==`function`,s=Symbol(`solid-track`),c={equals:i},l=null,u=xe,d=1,f=2,p={owned:null,cleanups:null,context:null,owner:null},m={},h=null,g=null,_=null,v=null,y=null,b=null,x=null,S=0;function C(e,t){let n=y,r=h,i=e.length===0,a=t===void 0?r:t,o=i?p:{owned:null,cleanups:null,context:a?a.context:null,owner:a},s=i?e:()=>e(()=>k(()=>Ee(o)));h=o,y=null;try{return N(s,!0)}finally{y=n,h=r}}function w(e,t){t=t?Object.assign({},c,t):c;let n={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0};return[he.bind(n),e=>(typeof e==`function`&&(e=g&&g.running&&g.sources.has(n)?e(n.tValue):e(n.value)),ge(n,e))]}function ee(e,t,n){let r=ve(e,t,!0,d);_&&g&&g.running?b.push(r):M(r)}function T(e,t,n){let r=ve(e,t,!1,d);_&&g&&g.running?b.push(r):M(r)}function E(e,t,n){u=Ce;let r=ve(e,t,!1,d),i=me&&fe(me);i&&(r.suspense=i),(!n||!n.render)&&(r.user=!0),x?x.push(r):M(r)}function D(e,t,n){n=n?Object.assign({},c,n):c;let r=ve(e,t,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,_&&g&&g.running?(r.tState=d,b.push(r)):M(r),he.bind(r)}function te(e){return e&&typeof e==`object`&&`then`in e}function ne(t,n,r){let i,a,o;typeof n==`function`?(i=t,a=n,o=r||{}):(i=!0,a=t,o=n||{});let s=null,c=m,l=null,u=!1,d=!1,f=`initialValue`in o,p=typeof i==`function`&&D(i),_=new Set,[v,b]=(o.storage||w)(o.initialValue),[x,S]=w(void 0),[C,T]=w(void 0,{equals:!1}),[E,ne]=w(f?`ready`:`unresolved`);e.context&&(l=e.getNextContextId(),o.ssrLoadFrom===`initial`?c=o.initialValue:e.load&&e.has(l)&&(c=e.load(l)));function O(e,t,n,r){return s===e&&(s=null,r!==void 0&&(f=!0),(e===c||t===c)&&o.onHydrated&&queueMicrotask(()=>o.onHydrated(r,{value:t})),c=m,g&&e&&u?(g.promises.delete(e),u=!1,N(()=>{g.running=!0,re(t,n)},!1)):re(t,n)),t}function re(e,t){N(()=>{t===void 0&&b(()=>e),ne(t===void 0?f?`ready`:`unresolved`:`errored`),S(t);for(let e of _.keys())e.decrement();_.clear()},!1)}function ie(){let e=me&&fe(me),t=v(),n=x();if(n!==void 0&&!s)throw n;return y&&!y.user&&e&&ee(()=>{C(),s&&(e.resolved&&g&&u?g.promises.add(s):_.has(e)||(e.increment(),_.add(e)))}),t}function A(e=!0){if(e!==!1&&d)return;d=!1;let t=p?p():i;if(u=g&&g.running,t==null||t===!1){O(s,k(v));return}g&&s&&g.promises.delete(s);let n,r=c===m?k(()=>{try{return a(t,{value:v(),refetching:e})}catch(e){n=e}}):c;if(n!==void 0){O(s,void 0,Oe(n),t);return}else if(!te(r))return O(s,r,void 0,t),r;return s=r,`v`in r?(r.s===1?O(s,r.v,void 0,t):O(s,void 0,Oe(r.v),t),r):(d=!0,queueMicrotask(()=>d=!1),N(()=>{ne(f?`refreshing`:`pending`),T()},!1),r.then(e=>O(r,e,void 0,t),e=>O(r,void 0,Oe(e),t)))}Object.defineProperties(ie,{state:{get:()=>E()},error:{get:()=>x()},loading:{get(){let e=E();return e===`pending`||e===`refreshing`}},latest:{get(){if(!f)return ie();let e=x();if(e&&!s)throw e;return v()}}});let ae=h;return p?ee(()=>(ae=h,A(!1))):A(!1),[ie,{refetch:e=>se(ae,()=>A(e)),mutate:b}]}function O(e){return N(e,!1)}function k(e){if(!v&&y===null)return e();let t=y;y=null;try{return v?v.untrack(e):e()}finally{y=t}}function re(e,t,n){let r=Array.isArray(e),i,a=n&&n.defer;return n=>{let o;if(r){o=Array(e.length);for(let t=0;t<e.length;t++)o[t]=e[t]()}else o=e();if(a)return a=!1,n;let s=k(()=>t(o,i,n));return i=o,s}}function ie(e){E(()=>k(e))}function A(e){return h===null||(h.cleanups===null?h.cleanups=[e]:h.cleanups.push(e)),e}function ae(e,t){l||=Symbol(`error`),h=ve(void 0,void 0,!0),h.context={...h.context,[l]:[t]},g&&g.running&&g.sources.add(h);try{return e()}catch(e){Ae(e)}finally{h=h.owner}}function oe(){return y}function j(){return h}function se(e,t){let n=h,r=y;h=e,y=null;try{return N(t,!0)}catch(e){Ae(e)}finally{h=n,y=r}}function ce(e){if(g&&g.running)return e(),g.done;let t=y,n=h;return Promise.resolve().then(()=>{y=t,h=n;let r;return(_||me)&&(r=g||={sources:new Set,effects:[],promises:new Set,disposed:new Set,queue:new Set,running:!0},r.done||=new Promise(e=>r.resolve=e),r.running=!0),N(e,!1),y=h=null,r?r.done:void 0})}var[le,ue]=w(!1);function de(e,t){let n=Symbol(`context`);return{id:n,Provider:Me(n),defaultValue:e}}function fe(e){let t;return h&&h.context&&(t=h.context[e.id])!==void 0?t:e.defaultValue}function pe(e){let t=D(e),n=D(()=>je(t()));return n.toArray=()=>{let e=n();return Array.isArray(e)?e:e==null?[]:[e]},n}var me;function he(){let e=g&&g.running;if(this.sources&&(e?this.tState:this.state))if((e?this.tState:this.state)===d)M(this);else{let e=b;b=null,N(()=>we(this),!1),b=e}if(y){let e=this.observers?this.observers.length:0;y.sources?(y.sources.push(this),y.sourceSlots.push(e)):(y.sources=[this],y.sourceSlots=[e]),this.observers?(this.observers.push(y),this.observerSlots.push(y.sources.length-1)):(this.observers=[y],this.observerSlots=[y.sources.length-1])}return e&&g.sources.has(this)?this.tValue:this.value}function ge(e,t,n){let r=g&&g.running&&g.sources.has(e)?e.tValue:e.value;if(!e.comparator||!e.comparator(r,t)){if(g){let r=g.running;(r||!n&&g.sources.has(e))&&(g.sources.add(e),e.tValue=t),r||(e.value=t)}else e.value=t;e.observers&&e.observers.length&&N(()=>{for(let t=0;t<e.observers.length;t+=1){let n=e.observers[t],r=g&&g.running;r&&g.disposed.has(n)||((r?!n.tState:!n.state)&&(n.pure?b.push(n):x.push(n),n.observers&&Te(n)),r?n.tState=d:n.state=d)}if(b.length>1e6)throw b=[],Error()},!1)}return t}function M(e){if(!e.fn)return;Ee(e);let t=S;_e(e,g&&g.running&&g.sources.has(e)?e.tValue:e.value,t),g&&!g.running&&g.sources.has(e)&&queueMicrotask(()=>{N(()=>{g&&(g.running=!0),y=h=e,_e(e,e.tValue,t),y=h=null},!1)})}function _e(e,t,n){let r,i=h,a=y;y=h=e;try{r=e.fn(t)}catch(t){return e.pure&&(g&&g.running?(e.tState=d,e.tOwned&&e.tOwned.forEach(Ee),e.tOwned=void 0):(e.state=d,e.owned&&e.owned.forEach(Ee),e.owned=null)),e.updatedAt=n+1,Ae(t)}finally{y=a,h=i}(!e.updatedAt||e.updatedAt<=n)&&(e.updatedAt!=null&&`observers`in e?ge(e,r,!0):g&&g.running&&e.pure?(g.sources.add(e),e.tValue=r):e.value=r,e.updatedAt=n)}function ve(e,t,n,r=d,i){let a={fn:e,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:h,context:h?h.context:null,pure:n};if(g&&g.running&&(a.state=0,a.tState=r),h===null||h!==p&&(g&&g.running&&h.pure?h.tOwned?h.tOwned.push(a):h.tOwned=[a]:h.owned?h.owned.push(a):h.owned=[a]),v&&a.fn){let[e,t]=w(void 0,{equals:!1}),n=v.factory(a.fn,t);A(()=>n.dispose());let r=v.factory(a.fn,()=>ce(t).then(()=>r.dispose()));a.fn=t=>(e(),g&&g.running?r.track(t):n.track(t))}return a}function ye(e){let t=g&&g.running;if((t?e.tState:e.state)===0)return;if((t?e.tState:e.state)===f)return we(e);if(e.suspense&&k(e.suspense.inFallback))return e.suspense.effects.push(e);let n=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<S);){if(t&&g.disposed.has(e))return;(t?e.tState:e.state)&&n.push(e)}for(let r=n.length-1;r>=0;r--){if(e=n[r],t){let t=e,i=n[r+1];for(;(t=t.owner)&&t!==i;)if(g.disposed.has(t))return}if((t?e.tState:e.state)===d)M(e);else if((t?e.tState:e.state)===f){let t=b;b=null,N(()=>we(e,n[0]),!1),b=t}}}function N(e,t){if(b)return e();let n=!1;t||(b=[]),x?n=!0:x=[],S++;try{let t=e();return be(n),t}catch(e){n||(x=null),b=null,Ae(e)}}function be(e){if(b&&=(_&&g&&g.running?Se(b):xe(b),null),e)return;let t;if(g){if(!g.promises.size&&!g.queue.size){let e=g.sources,n=g.disposed;x.push.apply(x,g.effects),t=g.resolve;for(let e of x)`tState`in e&&(e.state=e.tState),delete e.tState;g=null,N(()=>{for(let e of n)Ee(e);for(let t of e){if(t.value=t.tValue,t.owned)for(let e=0,n=t.owned.length;e<n;e++)Ee(t.owned[e]);t.tOwned&&(t.owned=t.tOwned),delete t.tValue,delete t.tOwned,t.tState=0}ue(!1)},!1)}else if(g.running){g.running=!1,g.effects.push.apply(g.effects,x),x=null,ue(!0);return}}let n=x;x=null,n.length&&N(()=>u(n),!1),t&&t()}function xe(e){for(let t=0;t<e.length;t++)ye(e[t])}function Se(e){for(let t=0;t<e.length;t++){let n=e[t],r=g.queue;r.has(n)||(r.add(n),_(()=>{r.delete(n),N(()=>{g.running=!0,ye(n)},!1),g&&(g.running=!1)}))}}function Ce(t){let r,i=0;for(r=0;r<t.length;r++){let e=t[r];e.user?t[i++]=e:ye(e)}if(e.context){if(e.count){e.effects||=[],e.effects.push(...t.slice(0,i));return}n()}for(e.effects&&(e.done||!e.count)&&(t=[...e.effects,...t],i+=e.effects.length,delete e.effects),r=0;r<i;r++)ye(t[r])}function we(e,t){let n=g&&g.running;n?e.tState=0:e.state=0;for(let r=0;r<e.sources.length;r+=1){let i=e.sources[r];if(i.sources){let e=n?i.tState:i.state;e===d?i!==t&&(!i.updatedAt||i.updatedAt<S)&&ye(i):e===f&&we(i,t)}}}function Te(e){let t=g&&g.running;for(let n=0;n<e.observers.length;n+=1){let r=e.observers[n];(t?!r.tState:!r.state)&&(t?r.tState=f:r.state=f,r.pure?b.push(r):x.push(r),r.observers&&Te(r))}}function Ee(e){let t;if(e.sources)for(;e.sources.length;){let t=e.sources.pop(),n=e.sourceSlots.pop(),r=t.observers;if(r&&r.length){let e=r.pop(),i=t.observerSlots.pop();n<r.length&&(e.sourceSlots[i]=n,r[n]=e,t.observerSlots[n]=i)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)Ee(e.tOwned[t]);delete e.tOwned}if(g&&g.running&&e.pure)De(e,!0);else if(e.owned){for(t=e.owned.length-1;t>=0;t--)Ee(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}g&&g.running?e.tState=0:e.state=0}function De(e,t){if(t||(e.tState=0,g.disposed.add(e)),e.owned)for(let t=0;t<e.owned.length;t++)De(e.owned[t])}function Oe(e){return e instanceof Error?e:Error(typeof e==`string`?e:`Unknown error`,{cause:e})}function ke(e,t,n){try{for(let n of t)n(e)}catch(e){Ae(e,n&&n.owner||null)}}function Ae(e,t=h){let n=l&&t&&t.context&&t.context[l],r=Oe(e);if(!n)throw r;x?x.push({fn(){ke(r,n,t)},state:d}):ke(r,n,t)}function je(e){if(typeof e==`function`&&!e.length)return je(e());if(Array.isArray(e)){let t=[];for(let n=0;n<e.length;n++){let r=je(e[n]);Array.isArray(r)?t.push.apply(t,r):t.push(r)}return t}return e}function Me(e,t){return function(t){let n;return T(()=>n=k(()=>(h.context={...h.context,[e]:t.value},pe(()=>t.children))),void 0),n}}var Ne=Symbol(`fallback`);function Pe(e){for(let t=0;t<e.length;t++)e[t]()}function Fe(e,t,n={}){let r=[],i=[],a=[],o=0,c=t.length>1?[]:null;return A(()=>Pe(a)),()=>{let l=e()||[],u=l.length,d,f;return l[s],k(()=>{let e,t,s,m,h,g,_,v,y;if(u===0)o!==0&&(Pe(a),a=[],r=[],i=[],o=0,c&&=[]),n.fallback&&(r=[Ne],i[0]=C(e=>(a[0]=e,n.fallback())),o=1);else if(o===0){for(i=Array(u),f=0;f<u;f++)r[f]=l[f],i[f]=C(p);o=u}else{for(s=Array(u),m=Array(u),c&&(h=Array(u)),g=0,_=Math.min(o,u);g<_&&r[g]===l[g];g++);for(_=o-1,v=u-1;_>=g&&v>=g&&r[_]===l[v];_--,v--)s[v]=i[_],m[v]=a[_],c&&(h[v]=c[_]);for(e=new Map,t=Array(v+1),f=v;f>=g;f--)y=l[f],d=e.get(y),t[f]=d===void 0?-1:d,e.set(y,f);for(d=g;d<=_;d++)y=r[d],f=e.get(y),f!==void 0&&f!==-1?(s[f]=i[d],m[f]=a[d],c&&(h[f]=c[d]),f=t[f],e.set(y,f)):a[d]();for(f=g;f<u;f++)f in s?(i[f]=s[f],a[f]=m[f],c&&(c[f]=h[f],c[f](f))):i[f]=C(p);i=i.slice(0,o=u),r=l.slice(0)}return i});function p(e){if(a[f]=e,c){let[e,n]=w(f);return c[f]=n,t(l[f],e)}return t(l[f])}}}var Ie=!1;function P(t,i){if(Ie&&e.context){let a=e.context;n(r());let o=k(()=>t(i||{}));return n(a),o}return k(()=>t(i||{}))}function Le(){return!0}var Re={get(e,t,n){return t===a?n:e.get(t)},has(e,t){return t===a?!0:e.has(t)},set:Le,deleteProperty:Le,getOwnPropertyDescriptor(e,t){return{configurable:!0,enumerable:!0,get(){return e.get(t)},set:Le,deleteProperty:Le}},ownKeys(e){return e.keys()}};function ze(e){return(e=typeof e==`function`?e():e)?e:{}}function Be(){for(let e=0,t=this.length;e<t;++e){let t=this[e]();if(t!==void 0)return t}}function Ve(...e){let t=!1;for(let n=0;n<e.length;n++){let r=e[n];t||=!!r&&a in r,e[n]=typeof r==`function`?(t=!0,D(r)):r}if(o&&t)return new Proxy({get(t){for(let n=e.length-1;n>=0;n--){let r=ze(e[n])[t];if(r!==void 0)return r}},has(t){for(let n=e.length-1;n>=0;n--)if(t in ze(e[n]))return!0;return!1},keys(){let t=[];for(let n=0;n<e.length;n++)t.push(...Object.keys(ze(e[n])));return[...new Set(t)]}},Re);let n={},r=Object.create(null);for(let t=e.length-1;t>=0;t--){let i=e[t];if(!i)continue;let a=Object.getOwnPropertyNames(i);for(let e=a.length-1;e>=0;e--){let t=a[e];if(t===`__proto__`||t===`constructor`)continue;let o=Object.getOwnPropertyDescriptor(i,t);if(!r[t])r[t]=o.get?{enumerable:!0,configurable:!0,get:Be.bind(n[t]=[o.get.bind(i)])}:o.value===void 0?void 0:o;else{let e=n[t];e&&(o.get?e.push(o.get.bind(i)):o.value!==void 0&&e.push(()=>o.value))}}}let i={},s=Object.keys(r);for(let e=s.length-1;e>=0;e--){let t=s[e],n=r[t];n&&n.get?Object.defineProperty(i,t,n):i[t]=n?n.value:void 0}return i}var He=0;function Ue(){return e.context?e.getNextContextId():`cl-${He++}`}var We=e=>`Stale read from <${e}>.`;function Ge(e){let t=`fallback`in e&&{fallback:()=>e.fallback};return D(Fe(()=>e.each,e.children,t||void 0))}function F(e){let t=e.keyed,n=D(()=>e.when,void 0,void 0),r=t?n:D(n,void 0,{equals:(e,t)=>!e==!t});return D(()=>{let i=r();if(i){let a=e.children;return typeof a==`function`&&a.length>0?k(()=>a(t?i:()=>{if(!k(r))throw We(`Show`);return n()})):a}return e.fallback},void 0,void 0)}var Ke;function qe(){Ke&&[...Ke].forEach(e=>e())}var Je=e=>D(()=>e());function Ye(e,t,n){let r=n.length,i=t.length,a=r,o=0,s=0,c=t[i-1].nextSibling,l=null;for(;o<i||s<a;){if(t[o]===n[s]){o++,s++;continue}for(;t[i-1]===n[a-1];)i--,a--;if(i===o){let t=a<r?s?n[s-1].nextSibling:n[a-s]:c;for(;s<a;)e.insertBefore(n[s++],t)}else if(a===s)for(;o<i;)(!l||!l.has(t[o]))&&t[o].remove(),o++;else if(t[o]===n[a-1]&&n[s]===t[i-1]){let r=t[--i].nextSibling;e.insertBefore(n[s++],t[o++].nextSibling),e.insertBefore(n[--a],r),t[i]=n[a]}else{if(!l){l=new Map;let e=s;for(;e<a;)l.set(n[e],e++)}let r=l.get(t[o]);if(r!=null)if(s<r&&r<a){let c=o,u=1,d;for(;++c<i&&c<a&&!((d=l.get(t[c]))==null||d!==r+u);)u++;if(u>r-s){let i=t[o];for(;s<r;)e.insertBefore(n[s++],i)}else e.replaceChild(n[s++],t[o++])}else o++;else t[o++].remove()}}}var Xe=`_$DX_DELEGATE`;function Ze(e,t,n,r={}){let i;return C(r=>{i=r,t===document?e():L(t,e(),t.firstChild?null:void 0,n)},r.owner),()=>{i(),t.textContent=``}}function I(e,t,n,r){let i,a=()=>{let t=r?document.createElementNS(`http://www.w3.org/1998/Math/MathML`,`template`):document.createElement(`template`);return t.innerHTML=e,n?t.content.firstChild.firstChild:r?t.firstChild:t.content.firstChild},o=t?()=>k(()=>document.importNode(i||=a(),!0)):()=>(i||=a()).cloneNode(!0);return o.cloneNode=o,o}function Qe(e,t=window.document){let n=t[Xe]||(t[Xe]=new Set);for(let r=0,i=e.length;r<i;r++){let i=e[r];n.has(i)||(n.add(i),t.addEventListener(i,it))}}function $e(e,t,n){rt(e)||(n==null?e.removeAttribute(t):e.setAttribute(t,n))}function et(e,t){rt(e)||(t==null?e.removeAttribute(`class`):e.className=t)}function tt(e,t,n,r){if(r)Array.isArray(n)?(e[`$$${t}`]=n[0],e[`$$${t}Data`]=n[1]):e[`$$${t}`]=n;else if(Array.isArray(n)){let r=n[0];e.addEventListener(t,n[0]=t=>r.call(e,n[1],t))}else e.addEventListener(t,n,typeof n!=`function`&&n)}function nt(e,t,n){return k(()=>e(t,n))}function L(e,t,n,r){if(n!==void 0&&!r&&(r=[]),typeof t!=`function`)return at(e,t,r,n);T(r=>at(e,t(),r,n),r)}function rt(t){return!!e.context&&!e.done&&(!t||t.isConnected)}function it(t){if(e.registry&&e.events&&e.events.find(([e,n])=>n===t))return;let n=t.target,r=`$$${t.type}`,i=t.target,a=t.currentTarget,o=e=>Object.defineProperty(t,`target`,{configurable:!0,value:e}),s=()=>{let e=n[r];if(e&&!n.disabled){let i=n[`${r}Data`];if(i===void 0?e.call(n,t):e.call(n,i,t),t.cancelBubble)return}return n.host&&typeof n.host!=`string`&&!n.host._$host&&n.contains(t.target)&&o(n.host),!0},c=()=>{for(;s()&&(n=n._$host||n.parentNode||n.host););};if(Object.defineProperty(t,`currentTarget`,{configurable:!0,get(){return n||document}}),e.registry&&!e.done&&(e.done=_$HY.done=!0),t.composedPath){let e=t.composedPath();o(e[0]);for(let t=0;t<e.length-2&&(n=e[t],s());t++){if(n._$host){n=n._$host,c();break}if(n.parentNode===a)break}}else c();o(i)}function at(e,t,n,r,i){let a=rt(e);if(a){!n&&(n=[...e.childNodes]);let t=[];for(let e=0;e<n.length;e++){let r=n[e];r.nodeType===8&&r.data.slice(0,2)===`!$`?r.remove():t.push(r)}n=t}for(;typeof n==`function`;)n=n();if(t===n)return n;let o=typeof t,s=r!==void 0;if(e=s&&n[0]&&n[0].parentNode||e,o===`string`||o===`number`){if(a||o===`number`&&(t=t.toString(),t===n))return n;if(s){let i=n[0];i&&i.nodeType===3?i.data!==t&&(i.data=t):i=document.createTextNode(t),n=ct(e,n,r,i)}else n=n!==``&&typeof n==`string`?e.firstChild.data=t:e.textContent=t}else if(t==null||o===`boolean`){if(a)return n;n=ct(e,n,r)}else if(o===`function`)return T(()=>{let i=t();for(;typeof i==`function`;)i=i();n=at(e,i,n,r)}),()=>n;else if(Array.isArray(t)){let o=[],c=n&&Array.isArray(n);if(ot(o,t,n,i))return T(()=>n=at(e,o,n,r,!0)),()=>n;if(a){if(!o.length)return n;if(r===void 0)return n=[...e.childNodes];let t=o[0];if(t.parentNode!==e)return n;let i=[t];for(;(t=t.nextSibling)!==r;)i.push(t);return n=i}if(o.length===0){if(n=ct(e,n,r),s)return n}else c?n.length===0?st(e,o,r):Ye(e,n,o):(n&&ct(e),st(e,o));n=o}else if(t.nodeType){if(a&&t.parentNode)return n=s?[t]:t;if(Array.isArray(n)){if(s)return n=ct(e,n,r,t);ct(e,n,null,t)}else n==null||n===``||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);n=t}return n}function ot(e,t,n,r){let i=!1;for(let a=0,o=t.length;a<o;a++){let o=t[a],s=n&&n[e.length],c;if(!(o==null||o===!0||o===!1))if((c=typeof o)==`object`&&o.nodeType)e.push(o);else if(Array.isArray(o))i=ot(e,o,s)||i;else if(c===`function`)if(r){for(;typeof o==`function`;)o=o();i=ot(e,Array.isArray(o)?o:[o],Array.isArray(s)?s:[s])||i}else e.push(o),i=!0;else{let t=String(o);s&&s.nodeType===3&&s.data===t?e.push(s):e.push(document.createTextNode(t))}}return i}function st(e,t,n=null){for(let r=0,i=t.length;r<i;r++)e.insertBefore(t[r],n)}function ct(e,t,n,r){if(n===void 0)return e.textContent=``;let i=r||document.createTextNode(``);if(t.length){let r=!1;for(let a=t.length-1;a>=0;a--){let o=t[a];if(i!==o){let t=o.parentNode===e;!r&&!a?t?e.replaceChild(i,o):e.insertBefore(i,n):t&&o.remove()}else r=!0}}else e.insertBefore(i,n);return[i]}const lt=[`white`,`black`],ut=[`a`,`b`,`c`,`d`,`e`,`f`,`g`,`h`],dt=[`1`,`2`,`3`,`4`,`5`,`6`,`7`,`8`],ft=[...dt].reverse(),pt=ut.flatMap(e=>dt.map(t=>e+t)),mt=e=>e.every(e=>e>=0&&e<=7)?pt[8*e[0]+e[1]]:void 0,ht=e=>mt(e),R=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],gt=pt.map(R),_t=pt.map((e,t)=>({key:e,pos:gt[t]}));function vt(e){let t,n=()=>(t===void 0&&(t=e()),t);return n.clear=()=>{t=void 0},n}const yt=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;let t=performance.now()-e;return e=void 0,t}}},bt=e=>e===`white`?`black`:`white`,xt=(e,t)=>(e[0]-t[0])**2+(e[1]-t[1])**2,St=(e,t)=>e.role===t.role&&e.color===t.color,Ct=(e,t)=>e[0]===t[0]&&e[1]===t[1],wt=e=>(t,n)=>[(n?t[0]:7-t[0])*e.width/8,(n?7-t[1]:t[1])*e.height/8],z=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},Tt=(e,t,n=1)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px) scale(${n})`},Et=(e,t)=>{e.style.visibility=t?`visible`:`hidden`},Dt=e=>{if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(e.targetTouches?.[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]};var Ot=vt(()=>!(`ontouchstart`in window)&&[`macintosh`,`firefox`].every(e=>navigator.userAgent.toLowerCase().includes(e)));const kt=e=>e.button===2&&!(e.ctrlKey&&Ot()),B=(e,t)=>{let n=document.createElement(e);return t&&(n.className=t),n};function At(e,t,n){let r=R(e);return t||(r[0]=7-r[0],r[1]=7-r[1]),[n.left+n.width*r[0]/8+n.width/16,n.top+n.height*(7-r[1])/8+n.height/16]}const V=(e,t)=>Math.abs(e-t),jt=(e,t,n,r)=>V(e,n)*V(t,r)===2,Mt=(e,t,n,r)=>e===n!=(t===r),Nt=(e,t,n,r)=>V(e,n)===V(t,r)&&e!==n,Pt=(e,t,n,r)=>Mt(e,t,n,r)||Nt(e,t,n,r),Ft=(e,t,n,r)=>Math.max(V(e,n),V(t,r))===1,It=(e,t,n,r,i)=>{let a=i?1:-1;return e===n&&(r===t+a||r===t+2*a&&(i?t<=1:t>=6))},Lt=(e,t,n,r)=>{let i=n-e,a=r-t;if(i&&a&&Math.abs(i)!==Math.abs(a))return[];let o=Math.sign(i),s=Math.sign(a),c=[],l=e+o,u=t+s;for(;l!==n||u!==r;)c.push([l,u]),l+=o,u+=s;return c.map(mt).filter(e=>e!==void 0)};var Rt=e=>V(e.orig.pos[0],e.dest.pos[0])<=1&&(V(e.orig.pos[0],e.dest.pos[0])===1?e.dest.pos[1]===e.orig.pos[1]+(e.color===`white`?1:-1):It(...e.orig.pos,...e.dest.pos,e.color===`white`)),zt=e=>jt(...e.orig.pos,...e.dest.pos),Bt=e=>Nt(...e.orig.pos,...e.dest.pos),Vt=e=>Mt(...e.orig.pos,...e.dest.pos),Ht={pawn:Rt,knight:zt,bishop:Bt,rook:Vt,queen:e=>Bt(e)||Vt(e),king:e=>Ft(...e.orig.pos,...e.dest.pos)||e.orig.pos[1]===e.dest.pos[1]&&e.orig.pos[1]===(e.color===`white`?0:7)&&(e.orig.pos[0]===4&&(e.dest.pos[0]===2&&e.rookFilesFriendlies.includes(0)||e.dest.pos[0]===6&&e.rookFilesFriendlies.includes(7))||e.rookFilesFriendlies.includes(e.dest.pos[0]))};function Ut(e,t){let n=e.pieces,r=n.get(t);if(!r||r.color===e.turnColor)return[];let i=r.color,a=new Map([...n].filter(([e,t])=>t.color===i)),o=new Map([...n].filter(([e,t])=>t.color===bt(i))),s={key:t,pos:R(t)},c=t=>Ht[r.role](t)&&e.premovable.additionalPremoveRequirements(t),l={orig:s,role:r.role,allPieces:n,friendlies:a,enemies:o,color:i,rookFilesFriendlies:Array.from(n).filter(([e,t])=>e[1]===(i===`white`?`1`:`8`)&&t.color===i&&t.role===`rook`).map(([e])=>R(e)[0]),lastMove:e.lastMove};return _t.filter(e=>c({...l,dest:e})).map(e=>e.key)}function H(e,...t){e&&setTimeout(()=>e(...t),1)}function Wt(e){e.orientation=bt(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function Gt(e,t){for(let[n,r]of t)r?e.pieces.set(n,r):e.pieces.delete(n)}function Kt(e,t){if(e.check=void 0,t===!0&&(t=e.turnColor),t)for(let[n,r]of e.pieces)r.role===`king`&&r.color===t&&(e.check=n)}function qt(e,t,n,r){W(e),e.premovable.current=[t,n],H(e.premovable.events.set,t,n,r)}function U(e){e.premovable.current&&(e.premovable.current=void 0,H(e.premovable.events.unset))}function Jt(e,t,n){U(e),e.predroppable.current={role:t,key:n},H(e.predroppable.events.set,t,n)}function W(e){let t=e.predroppable;t.current&&(t.current=void 0,H(t.events.unset))}function Yt(e,t,n){if(!e.autoCastle)return!1;let r=e.pieces.get(t);if(!r||r.role!==`king`)return!1;let i=R(t),a=R(n);if(i[1]!==0&&i[1]!==7||i[1]!==a[1])return!1;i[0]===4&&!e.pieces.has(n)&&(a[0]===6?n=ht([7,a[1]]):a[0]===2&&(n=ht([0,a[1]])));let o=e.pieces.get(n);return!o||o.color!==r.color||o.role!==`rook`?!1:(e.pieces.delete(t),e.pieces.delete(n),i[0]<a[0]?(e.pieces.set(ht([6,a[1]]),r),e.pieces.set(ht([5,a[1]]),o)):(e.pieces.set(ht([2,a[1]]),r),e.pieces.set(ht([3,a[1]]),o)),!0)}function Xt(e,t,n){let r=e.pieces.get(t),i=e.pieces.get(n);if(t===n||!r)return!1;let a=i&&i.color!==r.color?i:void 0;return n===e.selected&&G(e),H(e.events.move,t,n,a),Yt(e,t,n)||(e.pieces.set(n,r),e.pieces.delete(t)),e.lastMove=[t,n],e.check=void 0,H(e.events.change),a||!0}function Zt(e,t,n,r){if(e.pieces.has(n))if(r)e.pieces.delete(n);else return!1;return H(e.events.dropNewPiece,t,n),e.pieces.set(n,t),e.lastMove=[n],e.check=void 0,H(e.events.change),e.movable.dests=void 0,e.turnColor=bt(e.turnColor),!0}function Qt(e,t,n){let r=Xt(e,t,n);return r&&(e.movable.dests=void 0,e.turnColor=bt(e.turnColor),e.animation.current=void 0),r}function $t(e,t,n){if(an(e,t,n)){let r=Qt(e,t,n);if(r){let i=e.hold.stop();G(e);let a={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:i};return r!==!0&&(a.captured=r),H(e.movable.events.after,t,n,a),!0}}else if(cn(e,t,n))return qt(e,t,n,{ctrlKey:e.stats.ctrlKey}),G(e),!0;return G(e),!1}function en(e,t,n,r){let i=e.pieces.get(t);i&&(on(e,t,n)||r)?(e.pieces.delete(t),Zt(e,i,n,r),H(e.movable.events.afterNewPiece,i.role,n,{premove:!1,predrop:!1})):i&&ln(e,t,n)?Jt(e,i.role,n):(U(e),W(e)),e.pieces.delete(t),G(e)}function tn(e,t,n){if(H(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled){G(e),e.hold.cancel();return}else if((e.selectable.enabled||n)&&e.selected!==t&&$t(e,e.selected,t)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(rn(e,t)||sn(e,t))&&(nn(e,t),e.hold.start())}function nn(e,t){e.selected=t,sn(e,t)?e.premovable.customDests||(e.premovable.dests=Ut(e,t)):e.premovable.dests=void 0}function G(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function rn(e,t){let n=e.pieces.get(t);return!!n&&(e.movable.color===`both`||e.movable.color===n.color&&e.turnColor===n.color)}const an=(e,t,n)=>t!==n&&rn(e,t)&&(e.movable.free||!!e.movable.dests?.get(t)?.includes(n));function on(e,t,n){let r=e.pieces.get(t);return!!r&&(t===n||!e.pieces.has(n))&&(e.movable.color===`both`||e.movable.color===r.color&&e.turnColor===r.color)}function sn(e,t){let n=e.pieces.get(t);return!!n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}var cn=(e,t,n)=>t!==n&&sn(e,t)&&(e.premovable.customDests?.get(t)??Ut(e,t)).includes(n);function ln(e,t,n){let r=e.pieces.get(t),i=e.pieces.get(n);return!!r&&(!i||i.color!==e.movable.color)&&e.predroppable.enabled&&(r.role!==`pawn`||n[1]!==`1`&&n[1]!==`8`)&&e.movable.color===r.color&&e.turnColor!==r.color}function un(e,t){let n=e.pieces.get(t);return!!n&&e.draggable.enabled&&(e.movable.color===`both`||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function dn(e){let t=e.premovable.current;if(!t)return!1;let n=t[0],r=t[1],i=!1;if(an(e,n,r)){let t=Qt(e,n,r);if(t){let a={premove:!0};t!==!0&&(a.captured=t),H(e.movable.events.after,n,r,a),i=!0}}return U(e),i}function fn(e,t){let n=e.predroppable.current,r=!1;return n?(t(n)&&Zt(e,{role:n.role,color:e.movable.color},n.key)&&(H(e.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),r=!0),W(e),r):!1}function pn(e){U(e),W(e),G(e)}function mn(e){e.movable.color=e.movable.dests=e.animation.current=void 0,pn(e)}function hn(e,t,n){let r=Math.floor(8*(e[0]-n.left)/n.width);t||(r=7-r);let i=7-Math.floor(8*(e[1]-n.top)/n.height);return t||(i=7-i),r>=0&&r<8&&i>=0&&i<8?mt([r,i]):void 0}function gn(e,t,n,r){let i=R(e),a=gt.filter(e=>Ct(i,e)||Pt(i[0],i[1],e[0],e[1])||jt(i[0],i[1],e[0],e[1])),o=a.map(e=>At(ht(e),n,r)).map(e=>xt(t,e)),[,s]=o.reduce((e,t,n)=>e[0]<t?e:[t,n],[o[0],0]);return mt(a[s])}const K=e=>e.orientation===`white`,_n=`rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR`;var vn={p:`pawn`,r:`rook`,n:`knight`,b:`bishop`,q:`queen`,k:`king`},yn={pawn:`p`,rook:`r`,knight:`n`,bishop:`b`,queen:`q`,king:`k`};function bn(e){e===`start`&&(e=_n);let t=new Map,n=7,r=0;for(let i of e)switch(i){case` `:case`[`:return t;case`/`:if(--n,n<0)return t;r=0;break;case`~`:{let e=mt([r-1,n]),i=e&&t.get(e);i&&(i.promoted=!0);break}default:{let e=i.charCodeAt(0);if(e<57)r+=e-48;else{let e=i.toLowerCase(),a=mt([r,n]);a&&t.set(a,{role:vn[e],color:i===e?`black`:`white`}),++r}}}return t}function xn(e){return ft.map(t=>ut.map(n=>{let r=e.get(n+t);if(r){let e=yn[r.role];return r.color===`white`&&(e=e.toUpperCase()),r.promoted&&(e+=`~`),e}else return`1`}).join(``)).join(`/`).replace(/1{2,}/g,e=>e.length.toString())}function Sn(e,t){t.animation&&(wn(e.animation,t.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function Cn(e,t){if(t.movable?.dests&&(e.movable.dests=void 0),t.drawable?.autoShapes&&(e.drawable.autoShapes=[]),wn(e,t),t.fen&&(e.pieces=bn(t.fen),e.drawable.shapes=t.drawable?.shapes||[]),`check`in t&&Kt(e,t.check||!1),`lastMove`in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&nn(e,e.selected),Sn(e,t),!e.movable.rookCastle&&e.movable.dests){let t=e.movable.color===`white`?`1`:`8`,n=`e`+t,r=e.movable.dests.get(n),i=e.pieces.get(n);if(!r||!i||i.role!==`king`)return;e.movable.dests.set(n,r.filter(e=>!(e===`a`+t&&r.includes(`c`+t))&&!(e===`h`+t&&r.includes(`g`+t))))}}function wn(e,t){for(let n in t)n===`__proto__`||n===`constructor`||!Object.prototype.hasOwnProperty.call(t,n)||(Object.prototype.hasOwnProperty.call(e,n)&&Tn(e[n])&&Tn(t[n])?wn(e[n],t[n]):e[n]=t[n])}function Tn(e){if(typeof e!=`object`||!e)return!1;let t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}const En=(e,t)=>t.animation.enabled?jn(e,t):q(e,t);function q(e,t){let n=e(t);return t.dom.redraw(),n}var Dn=(e,t)=>({key:e,pos:R(e),piece:t}),On=(e,t)=>t.sort((t,n)=>xt(e.pos,t.pos)-xt(e.pos,n.pos))[0];function kn(e,t){let n=new Map,r=[],i=new Map,a=[],o=[],s=new Map,c,l,u;for(let[t,n]of e)s.set(t,Dn(t,n));for(let e of pt)c=t.pieces.get(e),l=s.get(e),c?l?St(c,l.piece)||(a.push(l),o.push(Dn(e,c))):o.push(Dn(e,c)):l&&a.push(l);for(let e of o)l=On(e,a.filter(t=>St(e.piece,t.piece))),l&&(u=[l.pos[0]-e.pos[0],l.pos[1]-e.pos[1]],n.set(e.key,u.concat(u)),r.push(l.key));for(let e of a)r.includes(e.key)||i.set(e.key,e.piece);return{anims:n,fadings:i}}function An(e,t){let n=e.animation.current;if(n===void 0){e.dom.destroyed||e.dom.redrawNow();return}let r=1-(t-n.start)*n.frequency;if(r<=0)e.animation.current=void 0,e.dom.redrawNow();else{let t=Mn(r);for(let e of n.plan.anims.values())e[2]=e[0]*t,e[3]=e[1]*t;e.dom.redrawNow(!0),requestAnimationFrame((t=performance.now())=>An(e,t))}}function jn(e,t){let n=new Map(t.pieces),r=e(t),i=kn(n,t);if(i.anims.size||i.fadings.size){let e=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:i},e||An(t,performance.now())}else t.dom.redraw();return r}var Mn=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,Nn=[`green`,`red`,`blue`,`yellow`];function Pn(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?G(e):pn(e);let n=Dt(t),r=hn(n,K(e),e.dom.bounds());r&&(e.drawable.current={orig:r,pos:n,brush:Hn(t),snapToValidMove:e.drawable.defaultSnapToValidMove},Fn(e))}function Fn(e){requestAnimationFrame(()=>{let t=e.drawable.current;if(t){let n=hn(t.pos,K(e),e.dom.bounds());n||(t.snapToValidMove=!1);let r=t.snapToValidMove?gn(t.orig,t.pos,K(e),e.dom.bounds()):n;r!==t.mouseSq&&(t.mouseSq=r,t.dest=r===t.orig?void 0:r,e.dom.redrawNow()),Fn(e)}})}function In(e,t){e.drawable.current&&(e.drawable.current.pos=Dt(t))}function Ln(e){let t=e.drawable.current;t&&(t.mouseSq&&Un(e.drawable,t),Rn(e))}function Rn(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function zn(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),Wn(e.drawable))}const Bn=(e,t)=>e.orig===t.orig&&e.dest===t.dest,Vn=(e,t)=>e.brush===t.brush;function Hn(e){let t=(e.shiftKey||e.ctrlKey)&&kt(e),n=e.altKey||e.metaKey||e.getModifierState?.(`AltGraph`);return Nn[(t?1:0)+(n?2:0)]}function Un(e,t){let n=e.shapes.find(e=>Bn(e,t));n&&(e.shapes=e.shapes.filter(e=>!Bn(e,t))),(!n||!Vn(n,t))&&e.shapes.push({orig:t.orig,dest:t.dest,brush:t.brush}),Wn(e)}function Wn(e){e.onChange&&e.onChange(e.shapes)}function Gn(e,t){if(!(e.trustAllEvents||t.isTrusted)||t.buttons!==void 0&&t.buttons>1||t.touches&&t.touches.length>1)return;let n=e.dom.bounds(),r=Dt(t),i=hn(r,K(e),n);if(!i)return;let a=e.pieces.get(i),o=e.selected;if(!o&&e.drawable.enabled&&(e.drawable.eraseOnMovablePieceClick||!a||a.color!==e.turnColor)&&zn(e),t.cancelable!==!1&&(!t.touches||e.blockTouchScroll||a||o||Kn(e,r)))t.preventDefault();else if(t.touches)return;let s=!!e.premovable.current,c=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&an(e,e.selected,i)?En(e=>tn(e,i),e):tn(e,i);let l=e.selected===i,u=$n(e,i);if(a&&u&&l&&un(e,i)){e.draggable.current={orig:i,piece:a,origPos:r,pos:r,started:e.draggable.autoDistance&&e.stats.dragged,element:u,previouslySelected:o,originTarget:t.target,keyHasChanged:!1},u.cgDragging=!0,u.classList.add(`dragging`);let s=e.dom.elements.ghost;s&&(s.className=`ghost ${a.color} ${a.role}`,z(s,wt(n)(R(i),K(e))),Et(s,!0)),Jn(e)}else s&&U(e),c&&W(e);e.dom.redraw()}function Kn(e,t){let n=K(e),r=e.dom.bounds(),i=(e.touchIgnoreRadius*r.width/16)**2*2;for(let a of e.pieces.keys())if(xt(At(a,n,r),t)<=i)return!0;return!1}function qn(e,t,n,r){e.pieces.set(`a0`,t),e.dom.redraw();let i=Dt(n);e.draggable.current={orig:`a0`,piece:t,origPos:i,pos:i,started:!0,element:()=>$n(e,`a0`),originTarget:n.target,newPiece:!0,force:!!r,keyHasChanged:!1},Jn(e)}function Jn(e){requestAnimationFrame(()=>{let t=e.draggable.current;if(!t)return;e.animation.current?.plan.anims.has(t.orig)&&(e.animation.current=void 0);let n=e.pieces.get(t.orig);if(!n||!St(n,t.piece))Zn(e);else if(!t.started&&xt(t.pos,t.origPos)>=e.draggable.distance**2&&(t.started=!0),t.started){if(typeof t.element==`function`){let e=t.element();if(!e)return;e.cgDragging=!0,e.classList.add(`dragging`),t.element=e}let n=e.dom.bounds();z(t.element,[t.pos[0]-n.left-n.width/16,t.pos[1]-n.top-n.height/16]),t.keyHasChanged||=t.orig!==hn(t.pos,K(e),n)}Jn(e)})}function Yn(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=Dt(t))}function Xn(e,t){let n=e.draggable.current;if(!n)return;if(t.type===`touchend`&&t.cancelable!==!1&&t.preventDefault(),t.type===`touchend`&&n.originTarget!==t.target&&!n.newPiece){e.draggable.current=void 0;return}U(e),W(e);let r=hn(Dt(t)||n.pos,K(e),e.dom.bounds());r&&n.started&&n.orig!==r?n.newPiece?en(e,n.orig,r,n.force):(e.stats.ctrlKey=t.ctrlKey,$t(e,n.orig,r)&&(e.stats.dragged=!0)):n.newPiece?e.pieces.delete(n.orig):e.draggable.deleteOnDropOff&&!r&&(e.pieces.delete(n.orig),H(e.events.change)),(n.orig===n.previouslySelected||n.keyHasChanged)&&(n.orig===r||!r)?G(e):e.selectable.enabled||G(e),Qn(e),e.draggable.current=void 0,e.dom.redraw()}function Zn(e){let t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,G(e),Qn(e),e.dom.redraw())}function Qn(e){let t=e.dom.elements;t.ghost&&Et(t.ghost,!1)}function $n(e,t){let n=e.dom.elements.board.firstChild;for(;n;){if(n.cgKey===t&&n.tagName===`PIECE`)return n;n=n.nextSibling}}function er(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout(()=>{tr(e,2),setTimeout(()=>tr(e,void 0),120)},120)}function tr(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}function nr(e,t){function n(){Wt(e),t()}return{set(t){t.orientation&&t.orientation!==e.orientation&&n(),Sn(e,t),(t.fen?En:q)(e=>Cn(e,t),e)},state:e,getFen:()=>xn(e.pieces),toggleOrientation:n,setPieces(t){En(e=>Gt(e,t),e)},selectSquare(t,n){t?En(e=>tn(e,t,n),e):e.selected&&(G(e),e.dom.redraw())},move(t,n){En(e=>Xt(e,t,n),e)},newPiece(t,n){En(e=>Zt(e,t,n),e)},playPremove(){if(e.premovable.current){if(En(dn,e))return!0;e.dom.redraw()}return!1},playPredrop(t){if(e.predroppable.current){let n=fn(e,t);return e.dom.redraw(),n}return!1},cancelPremove(){q(U,e)},cancelPredrop(){q(W,e)},cancelMove(){q(e=>{pn(e),Zn(e)},e)},stop(){q(e=>{mn(e),Zn(e)},e)},explode(t){er(e,t)},setAutoShapes(t){q(e=>e.drawable.autoShapes=t,e)},setShapes(t){q(e=>e.drawable.shapes=t.slice(),e)},getKeyAtDomPos(t){return hn(t,K(e),e.dom.bounds())},redrawAll:t,dragNewPiece(t,n,r){qn(e,t,n,r)},destroy(){mn(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function rr(){return{pieces:bn(_n),orientation:`white`,turnColor:`white`,coordinates:!0,coordinatesOnSquares:!1,ranksPosition:`right`,autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,touchIgnoreRadius:1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:`both`,showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,additionalPremoveRequirements:e=>!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!(`ontouchstart`in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnMovablePieceClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:`g`,color:`#15781B`,opacity:1,lineWidth:10},red:{key:`r`,color:`#882020`,opacity:1,lineWidth:10},blue:{key:`b`,color:`#003088`,opacity:1,lineWidth:10},yellow:{key:`y`,color:`#e68f00`,opacity:1,lineWidth:10},paleBlue:{key:`pb`,color:`#003088`,opacity:.4,lineWidth:15},paleGreen:{key:`pg`,color:`#15781B`,opacity:.4,lineWidth:15},paleRed:{key:`pr`,color:`#882020`,opacity:.4,lineWidth:15},paleGrey:{key:`pgr`,color:`#4a4a4a`,opacity:.35,lineWidth:15},purple:{key:`purple`,color:`#68217a`,opacity:.65,lineWidth:10},pink:{key:`pink`,color:`#ee2080`,opacity:.5,lineWidth:10},white:{key:`white`,color:`white`,opacity:1,lineWidth:10},paleWhite:{key:`pwhite`,color:`white`,opacity:.6,lineWidth:10}},prevSvgHash:``},hold:yt()}}function ir(){let e=J(`defs`),t=Y(J(`filter`),{id:`cg-filter-blur`});return t.appendChild(Y(J(`feGaussianBlur`),{stdDeviation:`0.013`})),e.appendChild(t),e}function ar(e,t){let n=e.drawable,r=n.current,i=r&&r.mouseSq?r:void 0,a=new Map,o=e.dom.bounds(),s=n.autoShapes.filter(e=>!e.piece);for(let t of n.shapes.concat(s).concat(i?[i]:[])){if(!t.dest)continue;let n=a.get(t.dest)??new Set,r=Tr(_r(R(t.orig),e.orientation),o),i=Tr(_r(R(t.dest),e.orientation),o);n.add(Dr(r,i)),a.set(t.dest,n)}let c=[],l=i?n.shapes.findIndex(e=>Bn(e,i)&&Vn(e,i)):-1;for(let[e,t]of n.shapes.concat(s).entries()){let n=l!==-1&&l===e;c.push({shape:t,current:!1,pendingErase:n,hash:cr(t,vr(t.dest,a),!1,o,n)})}i&&l===-1&&c.push({shape:i,current:!0,hash:cr(i,vr(i.dest,a),!0,o,!1),pendingErase:!1});let u=c.map(e=>e.hash).join(`;`);u!==e.drawable.prevSvgHash&&(e.drawable.prevSvgHash=u,or(n,c,t),sr(c,t,t=>fr(e,t,n.brushes,a,o)))}function or(e,t,n){for(let r of[n.shapes,n.shapesBelow]){let i=r.querySelector(`defs`),a=t.filter(e=>r===n.shapesBelow==!!e.shape.below),o=new Map;for(let t of a.filter(e=>e.shape.dest&&e.shape.brush)){let n=yr(e.brushes[t.shape.brush],t.shape.modifiers),{key:r,color:i}=Sr(t.shape);r&&i&&o.set(r,{key:r,color:i,opacity:1,lineWidth:1}),o.set(n.key,n)}let s=new Set,c=i.firstElementChild;for(;c;)s.add(c.getAttribute(`cgKey`)),c=c.nextElementSibling;for(let[e,t]of o.entries())s.has(e)||i.appendChild(hr(t))}}function sr(e,t,n){for(let[r,i]of[[t.shapes,t.custom],[t.shapesBelow,t.customBelow]]){let[a,o]=[r,i].map(e=>e.querySelector(`g`)),s=e.filter(e=>r===t.shapesBelow==!!e.shape.below),c=new Map;for(let e of s)c.set(e.hash,!1);for(let e of[a,o]){let t=[],n=e.firstElementChild,r;for(;n;)r=n.getAttribute(`cgHash`),c.has(r)?c.set(r,!0):t.push(n),n=n.nextElementSibling;for(let n of t)e.removeChild(n)}for(let e of s.filter(e=>!c.get(e.hash)))for(let t of n(e))t.isCustom?o.appendChild(t.el):a.appendChild(t.el)}}function cr({orig:e,dest:t,brush:n,piece:r,modifiers:i,customSvg:a,label:o,below:s},c,l,u,d){return[u.width,u.height,l,d&&`pendingErase`,e,t,n,c&&`-`,r&&lr(r),i&&ur(i),a&&`custom-${dr(a.html)},${a.center?.[0]??`o`}`,o&&`label-${dr(o.text)}`,s&&`below`].filter(e=>e).join(`,`)}function lr(e){return[e.color,e.role,e.scale].filter(e=>e).join(`,`)}function ur(e){return[e.lineWidth,e.hilite].filter(e=>e).join(`,`)}function dr(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n)>>>0;return t.toString()}function fr(e,{shape:t,current:n,pendingErase:r,hash:i},a,o,s){let c=Tr(_r(R(t.orig),e.orientation),s),l=t.dest?Tr(_r(R(t.dest),e.orientation),s):c,u=t.brush&&yr(a[t.brush],t.modifiers),d=o.get(t.dest),f=[];if(u){let e=Y(J(`g`),{cgHash:i});f.push({el:e}),c[0]!==l[0]||c[1]!==l[1]?e.appendChild(mr(t,u,c,l,n,vr(t.dest,o),r)):e.appendChild(pr(a[t.brush],c,n,s,r))}if(t.label){let e=t.label;e.fill??=t.brush&&a[t.brush].color;let n=t.brush?void 0:`tr`;f.push({el:gr(e,i,c,l,d,n),isCustom:!0})}if(t.customSvg){let e=t.customSvg.center??`orig`,[n,r]=e===`label`?kr(c,l,d).map(e=>e-.5):e===`dest`?l:c,a=Y(J(`g`),{transform:`translate(${n},${r})`,cgHash:i});a.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${t.customSvg.html}</svg>`,f.push({el:a,isCustom:!0})}return f}function pr(e,t,n,r,i){let a=br(),o=(r.width+r.height)/(4*Math.max(r.width,r.height));return Y(J(`circle`),{stroke:e.color,"stroke-width":a[n?0:1],fill:`none`,opacity:Cr(e,n,i),cx:t[0],cy:t[1],r:o-a[1]/2})}function mr(e,t,n,r,i,a,o){function s(s){let c=wr(a&&!i),l=r[0]-n[0],u=r[1]-n[1],d=Math.atan2(u,l),f=Math.cos(d)*c,p=Math.sin(d)*c,m=Sr(e);return Y(J(`line`),{stroke:s?m.color:t.color,"stroke-width":xr(t,i)*(s?1.14:1),"stroke-linecap":`round`,"marker-end":`url(#arrowhead-${s?m.key:t.key})`,opacity:e.modifiers?.hilite&&!o?1:Cr(t,i,o),x1:n[0],y1:n[1],x2:r[0]-f,y2:r[1]-p})}if(!e.modifiers?.hilite)return s(!1);let c=Y(J(`g`),{opacity:t.opacity}),l=Y(J(`g`),{filter:`url(#cg-filter-blur)`});return l.appendChild(Er(n,r)),l.appendChild(s(!0)),c.appendChild(l),c.appendChild(s(!1)),c}function hr(e){let t=Y(J(`marker`),{id:`arrowhead-`+e.key,orient:`auto`,overflow:`visible`,markerWidth:4,markerHeight:4,refX:e.key.startsWith(`hilite`)?1.86:2.05,refY:2});return t.appendChild(Y(J(`path`),{d:`M0,0 V4 L3,2 Z`,fill:e.color})),t.setAttribute(`cgKey`,e.key),t}function gr(e,t,n,r,i,a){let o=.4,s=o*.75**e.text.length,c=kr(n,r,i),l=a===`tr`?.4:0,u=Y(J(`g`),{transform:`translate(${c[0]+l},${c[1]-l})`,cgHash:t});u.appendChild(Y(J(`circle`),{r:o/2,"fill-opacity":a?1:.8,"stroke-opacity":a?1:.7,"stroke-width":.03,fill:e.fill??`#666`,stroke:`white`}));let d=Y(J(`text`),{"font-size":s,"font-family":`Noto Sans`,"text-anchor":`middle`,fill:`white`,y:.13*.75**e.text.length});return d.innerHTML=e.text,u.appendChild(d),u}function _r(e,t){return t===`white`?e:[7-e[0],7-e[1]]}function vr(e,t){return!0===(e&&t.has(e)&&t.get(e).size>1)}function J(e){return document.createElementNS(`http://www.w3.org/2000/svg`,e)}function Y(e,t){for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.setAttribute(n,t[n]);return e}function yr(e,t){return t?{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter(e=>e).join(``)}:e}function br(){return[3/64,4/64]}function xr(e,t){return(e.lineWidth||10)*(t?.85:1)/64}function Sr(e){let t=e.modifiers?.hilite;return{key:t&&`hilite-${t.replace(`#`,``)}`,color:t}}function Cr(e,t,n){return(e.opacity||1)*(n?.6:t?.9:1)}function wr(e){return(e?20:10)/64}function Tr(e,t){let n=Math.min(1,t.width/t.height),r=Math.min(1,t.height/t.width);return[(e[0]-3.5)*n,(3.5-e[1])*r]}function Er(e,t){let n={from:[Math.floor(Math.min(e[0],t[0])),Math.floor(Math.min(e[1],t[1]))],to:[Math.ceil(Math.max(e[0],t[0])),Math.ceil(Math.max(e[1],t[1]))]};return Y(J(`rect`),{x:n.from[0],y:n.from[1],width:n.to[0]-n.from[0],height:n.to[1]-n.from[1],fill:`none`,stroke:`none`})}function Dr(e,t,n=!0){let r=Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI;return n?(Math.round(r*8/Math.PI)+16)%16:r}function Or(e,t){return Math.sqrt([e[0]-t[0],e[1]-t[1]].reduce((e,t)=>e+t*t,0))}function kr(e,t,n){let r=Or(e,t),i=Dr(e,t,!1);if(n&&(r-=33/64,n.size>1)){r-=10/64;let i=Dr(e,t);(n.has((i+1)%16)||n.has((i+15)%16))&&i&1&&(r-=.4)}return[e[0]-Math.cos(i)*r,e[1]-Math.sin(i)*r].map(e=>e+.5)}function Ar(e,t){e.innerHTML=``,e.classList.add(`cg-wrap`);for(let n of lt)e.classList.toggle(`orientation-`+n,t.orientation===n);e.classList.toggle(`manipulable`,!t.viewOnly);let n=B(`cg-container`);e.appendChild(n);let r=B(`cg-board`);n.appendChild(r);let i,a,o,s,c;if(t.drawable.visible&&([i,a]=[`cg-shapes-below`,`cg-shapes`].map(e=>jr(e,!0)),[o,s]=[`cg-custom-below`,`cg-custom-svgs`].map(e=>jr(e,!1)),c=B(`cg-auto-pieces`),n.appendChild(i),n.appendChild(o),n.appendChild(a),n.appendChild(s),n.appendChild(c)),t.coordinates){let e=t.orientation===`black`?` black`:``,r=t.ranksPosition===`left`?` left`:``;if(t.coordinatesOnSquares){let i=t.orientation===`white`?e=>e+1:e=>8-e;ut.forEach((t,a)=>n.appendChild(Mr(dt.map(e=>t+e),`squares rank`+i(a)+e+r)))}else n.appendChild(Mr(dt,`ranks`+e+r)),n.appendChild(Mr(ut,`files`+e))}let l;return t.draggable.enabled&&t.draggable.showGhost&&(l=B(`piece`,`ghost`),Et(l,!1),n.appendChild(l)),{board:r,container:n,wrap:e,ghost:l,shapes:a,shapesBelow:i,custom:s,customBelow:o,autoPieces:c}}function jr(e,t){let n=Y(J(`svg`),{class:e,viewBox:t?`-4 -4 8 8`:`-3.5 -3.5 8 8`,preserveAspectRatio:`xMidYMid slice`});return t&&n.appendChild(ir()),n.appendChild(J(`g`)),n}function Mr(e,t){let n=B(`coords`,t),r;for(let t of e)r=B(`coord`),r.textContent=t,n.appendChild(r);return n}function Nr(e,t){if(!e.dropmode.active)return;U(e),W(e);let n=e.dropmode.piece;if(n){e.pieces.set(`a0`,n);let r=Dt(t),i=r&&hn(r,K(e),e.dom.bounds());i&&en(e,`a0`,i)}e.dom.redraw()}function Pr(e,t){let n=e.dom.elements.board;if(`ResizeObserver`in window&&new ResizeObserver(t).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&n.addEventListener(`contextmenu`,e=>e.preventDefault()),e.viewOnly)return;let r=Lr(e);n.addEventListener(`touchstart`,r,{passive:!1}),n.addEventListener(`mousedown`,r,{passive:!1})}function Fr(e,t){let n=[];if(`ResizeObserver`in window||n.push(Ir(document.body,`chessground.resize`,t)),!e.viewOnly){let t=Rr(e,Yn,In),r=Rr(e,Xn,Ln);for(let e of[`touchmove`,`mousemove`])n.push(Ir(document,e,t));for(let e of[`touchend`,`mouseup`])n.push(Ir(document,e,r));let i=()=>e.dom.bounds.clear();n.push(Ir(document,`scroll`,i,{capture:!0,passive:!0})),n.push(Ir(window,`resize`,i,{passive:!0}))}return()=>n.forEach(e=>e())}function Ir(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}var Lr=e=>t=>{e.draggable.current?Zn(e):e.drawable.current?Rn(e):t.shiftKey||kt(t)?e.drawable.enabled&&Pn(e,t):e.viewOnly||(e.dropmode.active?Nr(e,t):Gn(e,t))},Rr=(e,t,n)=>r=>{e.drawable.current?e.drawable.enabled&&n(e,r):e.viewOnly||t(e,r)};function zr(e){let t=K(e),n=wt(e.dom.bounds()),r=e.dom.elements.board,i=e.pieces,a=e.animation.current,o=a?a.plan.anims:new Map,s=a?a.plan.fadings:new Map,c=e.draggable.current,l=Jr(e),u=new Set,d=new Set,f=new Map,p=new Map,m,h,g,_,v,y,b,x,S,C;for(h=r.firstChild;h;){if(m=h.cgKey,Hr(h))if(g=i.get(m),v=o.get(m),y=s.get(m),_=h.cgPiece,h.cgDragging&&(!c||c.orig!==m)&&(h.classList.remove(`dragging`),z(h,n(R(m),t)),h.cgDragging=!1),!y&&h.cgFading&&(h.cgFading=!1,h.classList.remove(`fading`)),g){if(v&&h.cgAnimating&&_===Kr(g)){let e=R(m);e[0]+=v[2],e[1]+=v[3],h.classList.add(`anim`),z(h,n(e,t))}else h.cgAnimating&&(h.cgAnimating=!1,h.classList.remove(`anim`),z(h,n(R(m),t)),e.addPieceZIndex&&(h.style.zIndex=Gr(R(m),t)));_===Kr(g)&&(!y||!h.cgFading)?u.add(m):y&&_===Kr(y)?(h.classList.add(`fading`),h.cgFading=!0):Yr(f,_,h)}else Yr(f,_,h);else if(Ur(h)){let e=h.className;l.get(m)===e?d.add(m):Yr(p,e,h)}h=h.nextSibling}for(let[e,i]of l)if(!d.has(e)){S=p.get(i),C=S&&S.pop();let a=n(R(e),t);if(C)C.cgKey=e,z(C,a);else{let t=B(`square`,i);t.cgKey=e,z(t,a),r.insertBefore(t,r.firstChild)}}for(let[a,s]of i)if(v=o.get(a),!u.has(a))if(b=f.get(Kr(s)),x=b&&b.pop(),x){x.cgKey=a,x.cgFading&&=(x.classList.remove(`fading`),!1);let r=R(a);e.addPieceZIndex&&(x.style.zIndex=Gr(r,t)),v&&(x.cgAnimating=!0,x.classList.add(`anim`),r[0]+=v[2],r[1]+=v[3]),z(x,n(r,t))}else{let i=Kr(s),o=B(`piece`,i),c=R(a);o.cgPiece=i,o.cgKey=a,v&&(o.cgAnimating=!0,c[0]+=v[2],c[1]+=v[3]),z(o,n(c,t)),e.addPieceZIndex&&(o.style.zIndex=Gr(c,t)),r.appendChild(o)}for(let t of f.values())Wr(e,t);for(let t of p.values())Wr(e,t)}function Br(e){let t=K(e),n=wt(e.dom.bounds()),r=e.dom.elements.board.firstChild;for(;r;)(Hr(r)&&!r.cgAnimating||Ur(r))&&z(r,n(R(r.cgKey),t)),r=r.nextSibling}function Vr(e){let t=e.dom.elements.wrap.getBoundingClientRect(),n=e.dom.elements.container,r=t.height/t.width,i=Math.floor(t.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,a=i*r;n.style.width=i+`px`,n.style.height=a+`px`,e.dom.bounds.clear(),e.addDimensionsCssVarsTo?.style.setProperty(`---cg-width`,i+`px`),e.addDimensionsCssVarsTo?.style.setProperty(`---cg-height`,a+`px`)}var Hr=e=>e.tagName===`PIECE`,Ur=e=>e.tagName===`SQUARE`;function Wr(e,t){for(let n of t)e.dom.elements.board.removeChild(n)}function Gr(e,t){let n=e[1];return`${t?10-n:3+n}`}var Kr=e=>`${e.color} ${e.role}`,qr=(e,t)=>e.lastMove?.[1]&&!e.pieces.has(e.lastMove[1])&&e.lastMove[0][0]===`e`&&[`h`,`a`].includes(e.lastMove[1][0])&&e.lastMove[0][1]===e.lastMove[1][1]&&Lt(...R(e.lastMove[0]),...R(e.lastMove[1])).some(t=>e.pieces.has(t))?(t>e.lastMove[0]?`g`:`c`)+t[1]:t;function Jr(e){let t=new Map;if(e.lastMove&&e.highlight.lastMove)for(let[n,r]of e.lastMove.entries())X(t,n===1?qr(e,r):r,`last-move`);if(e.check&&e.highlight.check&&X(t,e.check,`check`),e.selected&&(X(t,e.selected,`selected`),e.movable.showDests)){for(let n of e.movable.dests?.get(e.selected)??[])X(t,n,`move-dest`+(e.pieces.has(n)?` oc`:``));for(let n of e.premovable.customDests?.get(e.selected)??e.premovable.dests??[])X(t,n,`premove-dest`+(e.pieces.has(n)?` oc`:``))}let n=e.premovable.current;if(n)for(let e of n)X(t,e,`current-premove`);else e.predroppable.current&&X(t,e.predroppable.current.key,`current-premove`);let r=e.exploding;if(r)for(let e of r.keys)X(t,e,`exploding`+r.stage);return e.highlight.custom&&e.highlight.custom.forEach((e,n)=>{X(t,n,e)}),t}function X(e,t,n){let r=e.get(t);r?e.set(t,`${r} ${n}`):e.set(t,n)}function Yr(e,t,n){let r=e.get(t);r?r.push(n):e.set(t,[n])}function Xr(e,t,n){let r=new Map,i=[];for(let t of e)r.set(t.hash,!1);let a=t.firstElementChild,o;for(;a;)o=a.getAttribute(`cgHash`),r.has(o)?r.set(o,!0):i.push(a),a=a.nextElementSibling;for(let e of i)t.removeChild(e);for(let i of e)r.get(i.hash)||t.appendChild(n(i))}function Zr(e,t){Xr(e.drawable.autoShapes.filter(e=>e.piece).map(e=>({shape:e,hash:ei(e),current:!1,pendingErase:!1})),t,t=>$r(e,t,e.dom.bounds()))}function Qr(e){let t=K(e),n=wt(e.dom.bounds()),r=e.dom.elements.autoPieces?.firstChild;for(;r;)Tt(r,n(R(r.cgKey),t),r.cgScale),r=r.nextSibling}function $r(e,{shape:t,hash:n},r){let i=t.orig,a=t.piece?.role,o=t.piece?.color,s=t.piece?.scale,c=B(`piece`,`${a} ${o}`);return c.setAttribute(`cgHash`,n),c.cgKey=i,c.cgScale=s,Tt(c,wt(r)(R(i),K(e)),s),c}var ei=e=>[e.orig,e.piece?.role,e.piece?.color,e.piece?.scale].join(`,`);function ti(e,t){let n=rr();Cn(n,t||{});function r(){let t=`dom`in n?n.dom.unbind:void 0,r=Ar(e,n),i=vt(()=>r.board.getBoundingClientRect()),a=e=>{zr(s),r.autoPieces&&Zr(s,r.autoPieces),!e&&r.shapes&&ar(s,r)},o=()=>{Vr(s),Br(s),r.autoPieces&&Qr(s)},s=n;return s.dom={elements:r,bounds:i,redraw:ni(a),redrawNow:a,unbind:t},s.drawable.prevSvgHash=``,Vr(s),a(!1),Pr(s,o),t||(s.dom.unbind=Fr(s,o)),s.events.insert&&s.events.insert(r),s}return nr(r(),r)}function ni(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame(()=>{e(),t=!1}))}}var ri=e=>(e-=e>>>1&1431655765,e=(e&858993459)+(e>>>2&858993459),Math.imul(e+(e>>>4)&252645135,16843009)>>24),ii=e=>(e=e>>>8&16711935|(e&16711935)<<8,e>>>16&65535|(e&65535)<<16),ai=e=>(e=e>>>1&1431655765|(e&1431655765)<<1,e=e>>>2&858993459|(e&858993459)<<2,e=e>>>4&252645135|(e&252645135)<<4,ii(e)),oi=class e{lo;hi;constructor(e,t){this.lo=e|0,this.hi=t|0}static fromSquare(t){return t>=32?new e(0,1<<t-32):new e(1<<t,0)}static fromRank(t){return new e(255,0).shl64(8*t)}static fromFile(t){return new e(16843009<<t,16843009<<t)}static empty(){return new e(0,0)}static full(){return new e(4294967295,4294967295)}static corners(){return new e(129,2164260864)}static center(){return new e(402653184,24)}static backranks(){return new e(255,4278190080)}static backrank(t){return t===`white`?new e(255,0):new e(0,4278190080)}static lightSquares(){return new e(1437226410,1437226410)}static darkSquares(){return new e(2857740885,2857740885)}complement(){return new e(~this.lo,~this.hi)}xor(t){return new e(this.lo^t.lo,this.hi^t.hi)}union(t){return new e(this.lo|t.lo,this.hi|t.hi)}intersect(t){return new e(this.lo&t.lo,this.hi&t.hi)}diff(t){return new e(this.lo&~t.lo,this.hi&~t.hi)}intersects(e){return this.intersect(e).nonEmpty()}isDisjoint(e){return this.intersect(e).isEmpty()}supersetOf(e){return e.diff(this).isEmpty()}subsetOf(e){return this.diff(e).isEmpty()}shr64(t){return t>=64?e.empty():t>=32?new e(this.hi>>>t-32,0):t>0?new e(this.lo>>>t^this.hi<<32-t,this.hi>>>t):this}shl64(t){return t>=64?e.empty():t>=32?new e(0,this.lo<<t-32):t>0?new e(this.lo<<t,this.hi<<t^this.lo>>>32-t):this}bswap64(){return new e(ii(this.hi),ii(this.lo))}rbit64(){return new e(ai(this.hi),ai(this.lo))}minus64(t){let n=this.lo-t.lo,r=(n&t.lo&1)+(t.lo>>>1)+(n>>>1)>>>31;return new e(n,this.hi-(t.hi+r))}equals(e){return this.lo===e.lo&&this.hi===e.hi}size(){return ri(this.lo)+ri(this.hi)}isEmpty(){return this.lo===0&&this.hi===0}nonEmpty(){return this.lo!==0||this.hi!==0}has(e){return(e>=32?this.hi&1<<e-32:this.lo&1<<e)!=0}set(e,t){return t?this.with(e):this.without(e)}with(t){return t>=32?new e(this.lo,this.hi|1<<t-32):new e(this.lo|1<<t,this.hi)}without(t){return t>=32?new e(this.lo,this.hi&~(1<<t-32)):new e(this.lo&~(1<<t),this.hi)}toggle(t){return t>=32?new e(this.lo,this.hi^1<<t-32):new e(this.lo^1<<t,this.hi)}last(){if(this.hi!==0)return 63-Math.clz32(this.hi);if(this.lo!==0)return 31-Math.clz32(this.lo)}first(){if(this.lo!==0)return 31-Math.clz32(this.lo&-this.lo);if(this.hi!==0)return 63-Math.clz32(this.hi&-this.hi)}withoutFirst(){return this.lo===0?new e(0,this.hi&this.hi-1):new e(this.lo&this.lo-1,this.hi)}moreThanOne(){return this.hi!==0&&this.lo!==0||(this.lo&this.lo-1)!=0||(this.hi&this.hi-1)!=0}singleSquare(){return this.moreThanOne()?void 0:this.last()}*[Symbol.iterator](){let e=this.lo,t=this.hi;for(;e!==0;){let t=31-Math.clz32(e&-e);e^=1<<t,yield t}for(;t!==0;){let e=31-Math.clz32(t&-t);t^=1<<e,yield 32+e}}*reversed(){let e=this.lo,t=this.hi;for(;t!==0;){let e=31-Math.clz32(t);t^=1<<e,yield 32+e}for(;e!==0;){let t=31-Math.clz32(e);e^=1<<t,yield t}}};const si=[`a`,`b`,`c`,`d`,`e`,`f`,`g`,`h`],ci=[`1`,`2`,`3`,`4`,`5`,`6`,`7`,`8`],li=e=>e!==void 0,ui=e=>e>>3,di=e=>e&7,fi=(e,t)=>0<=e&&e<8&&0<=t&&t<8?e+8*t:void 0;function pi(e){switch(e.toLowerCase()){case`p`:return`pawn`;case`n`:return`knight`;case`b`:return`bishop`;case`r`:return`rook`;case`q`:return`queen`;case`k`:return`king`;default:return}}function mi(e){if(e.length===2)return fi(e.charCodeAt(0)-97,e.charCodeAt(1)-49)}const hi=e=>si[di(e)]+ci[ui(e)],gi=e=>{if(!(e[1]===`@`&&e.length===4)&&(e.length===4||e.length===5)){let t=mi(e.slice(0,2)),n=mi(e.slice(2,4)),r;if(e.length===5&&(r=pi(e[4]),!r))return;if(li(t)&&li(n))return{from:t,to:n,promotion:r}}};var _i=(e,t)=>{let n=oi.empty();for(let r of t){let t=e+r;0<=t&&t<64&&Math.abs(di(e)-di(t))<=2&&(n=n.with(t))}return n},vi=e=>{let t=[];for(let n=0;n<64;n++)t[n]=e(n);return t};vi(e=>_i(e,[-9,-8,-7,-1,1,7,8,9])),vi(e=>_i(e,[-17,-15,-10,-6,6,10,15,17])),vi(e=>_i(e,[7,9])),vi(e=>_i(e,[-7,-9])),vi(e=>oi.fromFile(di(e)).without(e)),vi(e=>oi.fromRank(ui(e)).without(e)),vi(e=>{let t=new oi(134480385,2151686160),n=8*(ui(e)-di(e));return(n>=0?t.shl64(n):t.shr64(-n)).without(e)}),vi(e=>{let t=new oi(270549120,16909320),n=8*(ui(e)+di(e)-7);return(n>=0?t.shl64(n):t.shr64(-n)).without(e)});var yi;(function(e){e.Empty=`ERR_EMPTY`,e.OppositeCheck=`ERR_OPPOSITE_CHECK`,e.PawnsOnBackrank=`ERR_PAWNS_ON_BACKRANK`,e.Kings=`ERR_KINGS`,e.Variant=`ERR_VARIANT`})(yi||={});var bi;(function(e){e.Fen=`ERR_FEN`,e.Board=`ERR_BOARD`,e.Pockets=`ERR_POCKETS`,e.Turn=`ERR_TURN`,e.Castling=`ERR_CASTLING`,e.EpSquare=`ERR_EP_SQUARE`,e.RemainingChecks=`ERR_REMAINING_CHECKS`,e.Halfmoves=`ERR_HALFMOVES`,e.Fullmoves=`ERR_FULLMOVES`})(bi||={});const xi=[1,2,3,4,5,6],Si=[9,10,11,12,13,14];[...xi,...Si],class e{static gen_node_id=(()=>{let e=1;return()=>e++})();id;parent;move;children;constructor(t,n){this.id=e.gen_node_id(),this.parent=t,this.move=n,this.children=new Map}add_move(t){let n=this.children.get(t);if(n)return n;let r=new e(this,t);return this.children.set(t,r),r}};var Ci;(function(e){e.Different=`Different`,e.Equal=`Equal`,e.BeginFact=`BeginFact`,e.BeginIdea=`BeginIdea`,e.BeginMotif=`BeginMotif`,e.Legal=`Legal`,e.Alias=`Alias`,e.Line=`Line`,e.Word=`Word`,e.Const=`Const`,e.Dot=`Dot`,e.Between=`Between`,e.NotBetween=`NotBetween`,e.Newline=`Newline`,e.Eof=`Eof`})(Ci||={});var wi;(function(e){e.King=`King`,e.Queen=`Queen`,e.Bishop=`Bishop`,e.Rook=`Rook`,e.Knight=`Knight`,e.Pawn=`Pawn`})(wi||={}),wi.King,wi.Queen,wi.Bishop,wi.Rook,wi.Knight,wi.Pawn;var Ti;(function(e){e[e.UNREQUESTED=0]=`UNREQUESTED`,e[e.REQUESTED=1]=`REQUESTED`,e[e.MATERIALIZING=2]=`MATERIALIZING`,e[e.COMPLETE=3]=`COMPLETE`})(Ti||={});const Ei=e=>hi(e);var Di=I(`<div class="is2d chessboard-wrap tinos-bold">`);function Oi(e){let t;ie(()=>{let r={fen:e.fen};e.last_move&&(r.lastMove=[Ei(e.last_move.from),Ei(e.last_move.to)]),t=ti(n,r)}),E(()=>{let n=e.fen,r;e.last_move&&(r=[Ei(e.last_move.from),Ei(e.last_move.to)]),t&&t.set({fen:n,lastMove:r})});let n,r={handleEvent:t=>{e.on_wheel?.(t.deltaY)},passive:!0};return(()=>{var e=Di(),t=n;return typeof t==`function`?nt(t,e):n=e,tt(e,`wheel`,r),e})()}var ki=Symbol(`store-raw`),Ai=Symbol(`store-node`),Z=Symbol(`store-has`),ji=Symbol(`store-self`);function Mi(e){let t=e[a];if(!t&&(Object.defineProperty(e,a,{value:t=new Proxy(e,Bi)}),!Array.isArray(e))){let n=Object.keys(e),r=Object.getOwnPropertyDescriptors(e);for(let i=0,a=n.length;i<a;i++){let a=n[i];r[a].get&&Object.defineProperty(e,a,{enumerable:r[a].enumerable,get:r[a].get.bind(t)})}}return t}function Ni(e){let t;return typeof e==`object`&&!!e&&(e[a]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function Pi(e,t=new Set){let n,r,i,a;if(n=e!=null&&e[ki])return n;if(!Ni(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let n=0,a=e.length;n<a;n++)i=e[n],(r=Pi(i,t))!==i&&(e[n]=r)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);let n=Object.keys(e),o=Object.getOwnPropertyDescriptors(e);for(let s=0,c=n.length;s<c;s++)a=n[s],!o[a].get&&(i=e[a],(r=Pi(i,t))!==i&&(e[a]=r))}return e}function Fi(e,t){let n=e[t];return n||Object.defineProperty(e,t,{value:n=Object.create(null)}),n}function Ii(e,t,n){if(e[t])return e[t];let[r,i]=w(n,{equals:!1,internal:!0});return r.$=i,e[t]=r}function Li(e,t){let n=Reflect.getOwnPropertyDescriptor(e,t);return!n||n.get||!n.configurable||t===a||t===Ai?n:(delete n.value,delete n.writable,n.get=()=>e[a][t],n)}function Ri(e){oe()&&Ii(Fi(e,Ai),ji)()}function zi(e){return Ri(e),Reflect.ownKeys(e)}var Bi={get(e,t,n){if(t===ki)return e;if(t===a)return n;if(t===s)return Ri(e),n;let r=Fi(e,Ai),i=r[t],o=i?i():e[t];if(t===Ai||t===Z||t===`__proto__`)return o;if(!i){let n=Object.getOwnPropertyDescriptor(e,t);oe()&&(typeof o!=`function`||e.hasOwnProperty(t))&&!(n&&n.get)&&(o=Ii(r,t,o)())}return Ni(o)?Mi(o):o},has(e,t){return t===ki||t===a||t===s||t===Ai||t===Z||t===`__proto__`?!0:(oe()&&Ii(Fi(e,Z),t)(),t in e)},set(){return!0},deleteProperty(){return!0},ownKeys:zi,getOwnPropertyDescriptor:Li};function Q(e,t,n,r=!1){if(!r&&e[t]===n)return;let i=e[t],a=e.length;n===void 0?(delete e[t],e[Z]&&e[Z][t]&&i!==void 0&&e[Z][t].$()):(e[t]=n,e[Z]&&e[Z][t]&&i===void 0&&e[Z][t].$());let o=Fi(e,Ai),s;if((s=Ii(o,t,i))&&s.$(()=>n),Array.isArray(e)&&e.length!==a){for(let t=e.length;t<a;t++)(s=o[t])&&s.$();(s=Ii(o,`length`,a))&&s.$(e.length)}(s=o[ji])&&s.$()}function Vi(e,t){let n=Object.keys(t);for(let r=0;r<n.length;r+=1){let i=n[r];Q(e,i,t[i])}}function Hi(e,t){if(typeof t==`function`&&(t=t(e)),t=Pi(t),Array.isArray(t)){if(e===t)return;let n=0,r=t.length;for(;n<r;n++){let r=t[n];e[n]!==r&&Q(e,n,r)}Q(e,`length`,r)}else Vi(e,t)}function Ui(e,t,n=[]){let r,i=e;if(t.length>1){r=t.shift();let a=typeof r,o=Array.isArray(e);if(Array.isArray(r)){for(let i=0;i<r.length;i++)Ui(e,[r[i]].concat(t),n);return}else if(o&&a===`function`){for(let i=0;i<e.length;i++)r(e[i],i)&&Ui(e,[i].concat(t),n);return}else if(o&&a===`object`){let{from:i=0,to:a=e.length-1,by:o=1}=r;for(let r=i;r<=a;r+=o)Ui(e,[r].concat(t),n);return}else if(t.length>1){Ui(e[r],t,[r].concat(n));return}i=e[r],n=[r].concat(n)}let a=t[0];typeof a==`function`&&(a=a(i,n),a===i)||r===void 0&&a==null||(a=Pi(a),r===void 0||Ni(i)&&Ni(a)&&!Array.isArray(a)?Vi(i,a):Q(e,r,a))}function Wi(...[e,t]){let n=Pi(e||{}),r=Array.isArray(n),i=Mi(n);function a(...e){O(()=>{r&&e.length===1?Hi(n,e[0]):Ui(n,e)})}return[i,a]}var Gi=Symbol(`store-root`);function Ki(e,t,n,r,i){let a=t[n];if(e===a)return;let o=Array.isArray(e);if(n!==Gi&&(!Ni(e)||!Ni(a)||o!==Array.isArray(a)||i&&e[i]!==a[i])){Q(t,n,e);return}if(o){if(e.length&&a.length&&(!r||i&&e[0]&&e[0][i]!=null)){let t,n,o,s,c,l,u,d;for(o=0,s=Math.min(a.length,e.length);o<s&&(a[o]===e[o]||i&&a[o]&&e[o]&&a[o][i]&&a[o][i]===e[o][i]);o++)Ki(e[o],a,o,r,i);let f=Array(e.length),p=new Map;for(s=a.length-1,c=e.length-1;s>=o&&c>=o&&(a[s]===e[c]||i&&a[s]&&e[c]&&a[s][i]&&a[s][i]===e[c][i]);s--,c--)f[c]=a[s];if(o>c||o>s){for(n=o;n<=c;n++)Q(a,n,e[n]);for(;n<e.length;n++)Q(a,n,f[n]),Ki(e[n],a,n,r,i);a.length>e.length&&Q(a,`length`,e.length);return}for(u=Array(c+1),n=c;n>=o;n--)l=e[n],d=i&&l?l[i]:l,t=p.get(d),u[n]=t===void 0?-1:t,p.set(d,n);for(t=o;t<=s;t++)l=a[t],d=i&&l?l[i]:l,n=p.get(d),n!==void 0&&n!==-1&&(f[n]=a[t],n=u[n],p.set(d,n));for(n=o;n<e.length;n++)n in f?(Q(a,n,f[n]),Ki(e[n],a,n,r,i)):Q(a,n,e[n])}else for(let t=0,n=e.length;t<n;t++)Ki(e[t],a,t,r,i);a.length>e.length&&Q(a,`length`,e.length);return}let s=Object.keys(e);for(let t=0,n=s.length;t<n;t++)Ki(e[s[t]],a,s[t],r,i);let c=Object.keys(a);for(let t=0,n=c.length;t<n;t++)e[c[t]]===void 0&&Q(a,c[t],void 0)}function qi(e,t={}){let{merge:n,key:r=`id`}=t,i=Pi(e);return e=>{if(!Ni(e)||!Ni(i))return i;let t=Ki(i,{[Gi]:e},Gi,n,r);return t===void 0?e:t}}function Ji(e,t={}){let n=t.storage||globalThis.localStorage,r=t.name||`storage-${Ue()}`;if(!n)return[e[0],e[1],null];let i=t.storageOptions,a=t.serialize||JSON.stringify.bind(JSON),o=t.deserialize||JSON.parse.bind(JSON),s=n.getItem(r,i),c=typeof e[0]==`function`?t=>{try{let n=o(t);e[1](()=>n)}catch{}}:t=>{try{let n=o(t);e[1](qi(n))}catch{}},l=!0;if(s instanceof Promise?s.then(e=>l&&e&&c(e)):s&&c(s),typeof t.sync?.[0]==`function`){let n=typeof e[0]==`function`?e[0]:()=>e[0];t.sync[0](e=>{e.key!==r||(e.url||globalThis.location.href)!==globalThis.location.href||e.newValue===a(k(n))||c(e.newValue)})}return[e[0],typeof e[0]==`function`?o=>{let s=e[1](o),c=o==null?o:a(s);return t.sync?.[1](r,c),c==null?n.removeItem(r,i):n.setItem(r,c,i),l=!1,s}:(...o)=>{e[1](...o);let s=a(k(()=>e[0]));t.sync?.[1](r,s),n.setItem(r,s,i),l=!1},s]}var Yi=I(`<div tabindex=1 class="flex flex-col space-mono-regular editor bg-slate-800 w-full h-full text-white cursor-text"><div class="flex flex-col overflow-hidden w-100"></div><div class="flex-1 bg-slate-800"></div><div>`),Xi=I(`<div class=whitespace-pre>`),Zi=I(`<span class=relative><span>`),Qi=I(`<span>`),$i=(()=>{let e=0;return()=>++e})();function ea(e){return{id:$i(),content:e}}function ta(e){return P(ca,{get children(){return P(na,e)}})}function na(e){let[t,{load_program:n,handle_key_down:r,set_on_save_program_callback:i,set_on_column_under_cursor_callback:a,set_on_cursor_change_callback:o,set_on_command_execute_callback:s,scroll_camera_y:c}]=la();ie(()=>{d(),i(e.on_save_program),a(e.on_set_column_under_cursor),o(l),s(e.on_command_execute),n()});let l=()=>{t.i_line<t.camera_y+3?c(t.i_line-3):t.i_line>t.camera_y+20&&c(t.i_line-20)},u,d=()=>u.focus(),[f,p]=w(!1);return(()=>{var e=Yi(),n=e.firstChild,i=n.nextSibling.nextSibling;tt(e,`keydown`,r,!0),e.$$mousedown=()=>d,e.addEventListener(`blur`,()=>p(!1)),e.addEventListener(`focus`,()=>p(!0));var a=u;return typeof a==`function`?nt(a,e):u=e,L(n,P(Ge,{get each(){return t.lines},children:(e,n)=>P(F,{get when(){return n()>=t.camera_y},get children(){return P(ra,{get mode(){return t.mode},block:e,get cursor(){return Je(()=>n()===t.i_line)()?t.i_cursor:void 0},get on_focus(){return f()}})}})})),L(i,(()=>{var e=Je(()=>t.mode===`command`);return()=>e()?`:`+t.command:t.mode})()),T(()=>et(i,`flex ${t.mode===`edit`?`bg-emerald-500`:`bg-amber-500`}`)),e})()}function ra(e){let[t]=la(),n=D(()=>e.block.content.split(``)),r=D(()=>t.meta[e.block.id]),i=e=>r()?.tokens.find(t=>t.begin_char<=e&&e<t.end_char);return(()=>{var t=Xi();return L(t,P(Ge,{get each(){return n()},children:(t,n)=>P(ia,{get in_token(){return i(n())},char:t,get cursor(){return Je(()=>n()===e.cursor)()?{mode:e.mode}:void 0},get on_focus(){return e.on_focus}})}),null),L(t,P(ia,{char:` `,get cursor(){return Je(()=>n().length===e.cursor)()?{mode:e.mode}:void 0},get on_focus(){return e.on_focus}}),null),t})()}function ia(e){let t=D(()=>e.in_token?.type===$.BeginFact?`text-emerald-500`:`text-gray-200`);return(()=>{var n=Zi(),r=n.firstChild;return L(n,P(F,{get when(){return e.cursor},children:t=>P(aa,{get cursor(){return t()},get char(){return e.char},get blink(){return e.on_focus}})}),r),L(r,()=>e.char),T(()=>et(r,`relative ${t()}`)),n})()}function aa(e){return(()=>{var t=Qi();return T(()=>et(t,`cursor ${e.blink?`animate-blink`:``} left-0 absolute h-full ${e.cursor.mode===`normal`?`w-full bg-amber-800`:`w-0.5 bg-emerald-500`}`)),t})()}function oa(e,t){return e.in_fact===t.in_fact&&e.in_idea===t.in_idea&&e.in_legal===t.in_legal}var $=function(e){return e.Whitespace=`Whitespace`,e.BeginFact=`Fact`,e.BeginIdea=`Idea`,e.BeginLegal=`Legal`,e.Path=`Path`,e.Newline=`Newline`,e}($||{}),sa=de(),ca=e=>P(sa.Provider,{get value(){return ua()},get children(){return e.children}}),la=()=>fe(sa);function ua(){let[e,t]=Wi({meta:[],states:[]}),[n,r]=Wi({has_unsaved_changes:!1,g_mode:!1,camera_y:0,motion:null,command:``,mode:`normal`,i_line:0,i_cursor:0,lines:[ea(`hello`)]}),i=e=>{let t=n.camera_y;return r(`camera_y`,Math.min(Math.max(0,e),n.lines.length)),t!==n.camera_y},a=()=>{O(()=>{n.i_line<0&&r(`i_line`,0),n.i_line>=n.lines.length&&r(`i_line`,n.lines.length-1),n.lines.length===0?(r(`lines`,[ea(`hello`)]),r(`i_line`,0),r(`i_cursor`,0)):n.i_cursor>n.lines[n.i_line].content.length&&r(`i_cursor`,n.lines[n.i_line].content.length-1),n.i_cursor<0&&r(`i_cursor`,0),le()})},o=()=>{let e=n.lines[n.i_line].content.slice(0,n.i_cursor),t=n.lines[n.i_line].content.slice(n.i_cursor);O(()=>{let i=n.i_line;r(`lines`,n.i_line,`content`,e),r(`lines`,e=>e.toSpliced(n.i_line+1,0,ea(t))),r(`i_line`,n.i_line+1),r(`i_cursor`,0),j(i)})},s=()=>{let e=n.lines[n.i_line].content,t=n.lines[n.i_line+1].content;O(()=>{let i=n.i_line;r(`lines`,n.i_line,`content`,e+t),r(`lines`,e=>e.toSpliced(n.i_line+1,1)),r(`i_line`,n.i_line),r(`i_cursor`,e.length),j(i)})},c=()=>{let e=n.lines[n.i_line].content,t=e.slice(0,n.i_cursor)+e.slice(n.i_cursor+1);O(()=>{r(`lines`,n.i_line,`content`,t)})},l=()=>{O(()=>{r(`motion`,null),d(),d()})},u=()=>{O(()=>{r(`motion`,null),r(`i_line`,n.i_line-1),d(),d(),r(`i_line`,n.i_line+1)})},d=()=>{O(()=>{if(n.lines.length===1){r(`lines`,[ea(`hello`)]);return}r(`lines`,e=>e.toSpliced(n.i_line,1)),a()})},f=()=>{let e=n.lines[n.i_line].content.slice(0,n.i_cursor);O(()=>{r(`lines`,n.i_line,`content`,e),a()})},p=()=>{O(()=>{f(),r(`mode`,`edit`)})},m=()=>{let e=n.lines[n.i_line].content,t=e.slice(0,n.i_cursor-1)+e.slice(n.i_cursor);O(()=>{r(`lines`,n.i_line,`content`,t),r(`i_cursor`,n.i_cursor-1)})},h=()=>{O(()=>{r(`lines`,e=>e.toSpliced(0,n.i_line)),r(`i_line`,0),a(),j(0)})},g=()=>{O(()=>{let e=n.i_line;r(`lines`,e=>e.toSpliced(n.i_line,999)),r(`i_line`,999),a(),j(e)})},_=()=>{O(()=>{r(`lines`,e=>e.toSpliced(n.i_line+1,0,ea(``))),r(`i_line`,n.i_line+1),r(`i_cursor`,0),j(n.i_line-1)})},v=()=>{O(()=>{r(`lines`,e=>e.toSpliced(n.i_line,0,ea(``))),j(n.i_line),a()})},y=e=>{let t=e.split(`
`);O(()=>{let e=n.i_line,i=n.lines[n.i_line].content,a=i.slice(0,n.i_cursor)+t[0]+i.slice(n.i_cursor);r(`lines`,n.i_line,`content`,a),r(`i_cursor`,n.i_cursor+t[0].length);for(let e of t.slice(1))r(`lines`,t=>t.toSpliced(n.i_line+1,0,ea(e))),r(`i_cursor`,e.length),r(`i_line`,n.i_line+1);j(e)})},b=e=>{let t=n.lines[n.i_line].content,i=t.slice(0,n.i_cursor)+e+t.slice(n.i_cursor);O(()=>{r(`lines`,n.i_line,`content`,i),r(`i_cursor`,n.i_cursor+1),j(n.i_line)})},x=e=>{let t=!1;n.mode===`command`?t=S(e.key):n.mode===`edit`?t=ae(e.key,e.ctrlKey,e.shiftKey):n.mode===`normal`&&(t=ne(e.key,e.ctrlKey,e.shiftKey)),t&&e.preventDefault()},S=e=>{switch(e){case`Escape`:r(`command`,``),r(`mode`,`normal`);break;case`w`:r(`command`,`w`);break;case`Enter`:E(),r(`command`,``),r(`mode`,`normal`);break;default:return/[A-Za-z0-9]/.test(e)&&r(`command`,n.command+e),!1}return!0},[C,w]=Ji(Wi({program:`hello`,i_cursor:0,i_line:0,camera_y:0}),{name:`.morchess4.program`}),ee=()=>{let e=C.program.split(`
`).map(e=>ea(e));O(()=>{r(`lines`,e),r(`i_line`,C.i_line),r(`i_cursor`,C.i_cursor),r(`camera_y`,C.camera_y??0),oe(n.lines)}),he(T())},T=()=>n.lines.map(e=>e.content).join(`
`),E=()=>n.command===`w`?(O(()=>{w(`program`,T()),w(`i_cursor`,n.i_cursor),w(`i_line`,n.i_line),w(`camera_y`,n.camera_y),ce()}),!0):pe(n.command),D=()=>{n.motion===`delete`?(O(()=>{r(`motion`,null)}),d()):r(`motion`,`delete`)},te=e=>{switch(e){case`u`:O(()=>{r(`i_line`,n.i_line-13),a()});break;case`d`:O(()=>{r(`i_line`,n.i_line+13),a()});break;default:return!1}return!0},ne=(e,t,i)=>{if(t)return te(e);switch(e){case`g`:case`G`:if(i){if(n.motion===`delete`){g(),r(`motion`,null);break}O(()=>{r(`i_line`,999),r(`i_cursor`,999),a(),r(`g_mode`,!1)});break}if(n.g_mode){if(n.motion===`delete`){h(),r(`motion`,null);break}O(()=>{r(`i_line`,0),r(`i_cursor`,0),a(),r(`g_mode`,!1)})}else r(`g_mode`,!0);break;case`:`:r(`mode`,`command`);break;case`c`:case`C`:i&&p();break;case`d`:case`D`:i?f():D();break;case`x`:c();break;case`Backspace`:O(()=>{r(`i_cursor`,n.i_cursor-1),a()});break;case`o`:case`O`:O(()=>{i?v():_(),r(`mode`,`edit`)});break;case`j`:case`J`:if(i){s();break}if(n.motion===`delete`){O(()=>{l(),a()});break}O(()=>{r(`i_line`,n.i_line+1),a()});break;case`k`:if(n.motion===`delete`){O(()=>{u(),a()});break}O(()=>{r(`i_line`,n.i_line-1),a()});break;case`a`:case`A`:O(()=>{r(`i_cursor`,i?n.lines[n.i_line].content.length:n.i_cursor+1),r(`mode`,`edit`)});break;case`i`:r(`mode`,`edit`);break;case`l`:O(()=>{r(`i_cursor`,n.i_cursor+1),a()});break;case`h`:O(()=>{r(`i_cursor`,n.i_cursor-1),a()});break;case`w`:O(()=>{r(`i_cursor`,k(n.i_cursor)),a()});break;case`b`:O(()=>{r(`i_cursor`,re(n.i_cursor)),a()});break;case`0`:r(`i_cursor`,0);break;case`$`:O(()=>{r(`i_cursor`,999),a()});break;default:return!1}return!0},k=e=>{let t=n.lines[n.i_line].content,r;for(;e<t.length;){let n=/[A-Za-z0-9]/.test(t[e]);if(r===void 0){r=n;continue}if(r!==n)break;e++}return e},re=e=>{let t=n.lines[n.i_line].content,r;for(;e>0;){let n=/[A-Za-z0-9]/.test(t[e]);if(r===void 0){r=n;continue}if(r!==n)break;e--}return e},ie=e=>{switch(e){case`o`:break;case`h`:m();break;case`j`:o();break;case`v`:navigator.clipboard.readText().then(e=>{y(e)});break;default:return!1}return!0},A=e=>{switch(e){case`j`:case`J`:s();break;default:return e.length>1?!1:/[a-zA-Z0-9 \.\=\!\_]/.test(e)?(b(e),!0):!1}return!0},ae=(e,t,n)=>{if(t)return ie(e);if(n)return A(e);switch(e){case`Enter`:return o(),!0;case`Backspace`:return m(),!0;case`Escape`:r(`mode`,`normal`),r(`motion`,null);break;default:return e.length>1?!1:/[a-zA-Z0-9 \.\=\!\_]/.test(e)?(b(e),!0):!1}return r(`has_unsaved_changes`,!0),!0},oe=e=>{O(()=>{t(`meta`,{}),t(`states`,{});let n=ue;for(let r=0;r<e.length;r++){let[i,a]=da(n,e[r].content);n=i,t(`states`,e[r].id,n),t(`meta`,e[r].id,a)}})},j=e=>{de(e)};function se(){for(let t=n.i_line;t>=0;t--){let r=n.lines[t],i=e.meta[r.id];if(!i)continue;let a=i.tokens.findIndex(e=>e.type===$.BeginFact||e.type===$.BeginIdea||e.type===$.BeginLegal);if(a!==-1){for(let e=a+1;e<i.tokens.length;e++)if(i.tokens[e].type===$.Path)return i.tokens[e].value}}}function ce(){O(()=>{he(T()),le(),r(`has_unsaved_changes`,!1)})}function le(){M(se()??``),ve()}let ue={in_fact:!1,in_idea:!1,in_legal:!1,line:0};function de(r){let i=(e,t)=>da(t,e),a=(e,n)=>{t(`states`,e,n[0]),t(`meta`,e,n[1])},o=r,s=o>0&&n.lines.length>o-1?e.states[n.lines[o-1].id]:ue;for(;o<n.lines.length;){let t=n.lines[o],c=e.states[t.id],l=i(t.content,s);if(a(t.id,l),o>r&&c&&oa(l[0],c))break;s=l[0],o++}}let fe={get has_unsaved_changes(){return n.has_unsaved_changes},get camera_y(){return n.camera_y},get meta(){return e.meta},get command(){return n.command},get i_cursor(){return n.i_cursor},get i_line(){return n.i_line},get lines(){return n.lines},get mode(){return n.mode}},pe=()=>!1,me=e=>{pe=e},he=()=>{},ge=e=>{he=e},M=()=>{},_e=e=>{M=e},ve=()=>{};return[fe,{scroll_camera_y:i,load_program:ee,handle_key_down:x,set_on_save_program_callback:ge,set_on_column_under_cursor_callback:_e,set_on_cursor_change_callback:e=>{ve=e},set_on_command_execute_callback:me}]}function da(e,t){let n={line:e.line+1,in_fact:e.in_fact,in_idea:e.in_idea,in_legal:e.in_legal},r=[];function i(){e.in_fact?m():e.in_idea?h():e.in_legal?g():_()}let a={line:e.line+1,tokens:r},o=t.split(``),s=0,c=o[s],l,u,d;i();function f(){return o[s]}function p(){if(!(s>=o.length))return c=o[s++],c}function m(){[l,u,d]=v(),l!==u&&r.push({begin_char:l,end_char:u,type:$.Whitespace,value:d}),f()===void 0&&(r.push({begin_char:l,end_char:u,type:$.Newline,value:d}),n.in_fact=!1)}function h(){[l,u,d]=v(),l!==u&&r.push({begin_char:l,end_char:u,type:$.Whitespace,value:d}),f()===void 0&&(r.push({begin_char:l,end_char:u,type:$.Newline,value:d}),n.in_idea=!1)}function g(){[l,u,d]=v(),l!==u&&r.push({begin_char:l,end_char:u,type:$.Whitespace,value:d}),f()===void 0&&(r.push({begin_char:l,end_char:u,type:$.Newline,value:d}),n.in_legal=!1)}function _(){[l,u,d]=v(),l!==u&&r.push({begin_char:l,end_char:u,type:$.Whitespace,value:d}),[l,u,d]=y(),l!==u&&(d===`fact`?(r.push({begin_char:l,end_char:u,type:$.BeginFact,value:d}),n.in_fact=!0):d===`idea`?(r.push({begin_char:l,end_char:u,type:$.BeginIdea,value:d}),n.in_idea=!0):d===`legal`?(r.push({begin_char:l,end_char:u,type:$.BeginLegal,value:d}),n.in_legal=!0):r.push({begin_char:l,end_char:u,type:$.Path,value:d})),[l,u,d]=v(),l!==u&&r.push({begin_char:l,end_char:u,type:$.Whitespace,value:d}),[l,u,d]=y(),l!==u&&(d===`fact`?(r.push({begin_char:l,end_char:u,type:$.BeginFact,value:d}),n.in_fact=!0):d===`idea`?(r.push({begin_char:l,end_char:u,type:$.BeginIdea,value:d}),n.in_idea=!0):d===`legal`?(r.push({begin_char:l,end_char:u,type:$.BeginLegal,value:d}),n.in_legal=!0):r.push({begin_char:l,end_char:u,type:$.Path,value:d}))}function v(){let e=s,t=``;for(;f()!==void 0&&/ /.test(f());)t+=p();return[e,s,t]}function y(){let e=``,t=s;for(;f()!==void 0&&b(f());)e+=p();return[t,s,e]}function b(e){return/[A-Za-z0-9_]/.test(e)}return[n,a]}Qe([`mousedown`,`keydown`]);function fa(){let e=new Set;function t(t){return e.add(t),()=>e.delete(t)}let n=!1;function r(t,r){if(n)return!(n=!1);let i={to:t,options:r,defaultPrevented:!1,preventDefault:()=>i.defaultPrevented=!0};for(let a of e)a.listener({...i,from:a.location,retry:e=>{e&&(n=!0),a.navigate(t,{...r,resolve:!1})}});return!i.defaultPrevented}return{subscribe:t,confirm:r}}var pa;function ma(){(!window.history.state||window.history.state._depth==null)&&window.history.replaceState({...window.history.state,_depth:window.history.length-1},``),pa=window.history.state._depth}ma();function ha(e){return{...e,_depth:window.history.state&&window.history.state._depth}}function ga(e,t){let n=!1;return()=>{let r=pa;ma();let i=r==null?null:pa-r;if(n){n=!1;return}i&&t(i)?(n=!0,window.history.go(-i)):e()}}var _a=/^(?:[a-z0-9]+:)?\/\//i,va=/^\/+|(\/)\/+$/g;const ya=`http://sr`;function ba(e,t=!1){let n=e.replace(va,`$1`);return n?t||/^[?#]/.test(n)?n:`/`+n:``}function xa(e,t,n){if(_a.test(t))return;let r=ba(e),i=n&&ba(n),a=``;return a=!i||t.startsWith(`/`)?r:i.toLowerCase().indexOf(r.toLowerCase())===0?i:r+i,(a||`/`)+ba(t,!a)}function Sa(e,t){return ba(e).replace(/\/*(\*.*)?$/g,``)+ba(t)}function Ca(e){let t={};return e.searchParams.forEach((e,n)=>{n in t?Array.isArray(t[n])?t[n].push(e):t[n]=[t[n],e]:t[n]=e}),t}function wa(e,t,n){let[r,i]=e.split(`/*`,2),a=r.split(`/`).filter(Boolean),o=a.length;return e=>{let r=e.split(`/`).filter(Boolean),s=r.length-o;if(s<0||s>0&&i===void 0&&!t)return null;let c={path:o?``:`/`,params:{}},l=e=>n===void 0?void 0:n[e];for(let e=0;e<o;e++){let t=a[e],n=t[0]===`:`,i=n?r[e]:r[e].toLowerCase(),o=n?t.slice(1):t.toLowerCase();if(n&&Ta(i,l(o)))c.params[o]=i;else if(n||!Ta(i,o))return null;c.path+=`/${i}`}if(i){let e=s?r.slice(-s).join(`/`):``;if(Ta(e,l(i)))c.params[i]=e;else return null}return c}}function Ta(e,t){let n=t=>t===e;return t===void 0?!0:typeof t==`string`?n(t):typeof t==`function`?t(e):Array.isArray(t)?t.some(n):t instanceof RegExp?t.test(e):!1}function Ea(e){let[t,n]=e.pattern.split(`/*`,2),r=t.split(`/`).filter(Boolean);return r.reduce((e,t)=>e+(t.startsWith(`:`)?2:3),r.length-(n===void 0?0:1))}function Da(e){let t=new Map,n=j();return new Proxy({},{get(r,i){return t.has(i)||se(n,()=>t.set(i,D(()=>e()[i]))),t.get(i)()},getOwnPropertyDescriptor(){return{enumerable:!0,configurable:!0}},ownKeys(){return Reflect.ownKeys(e())},has(t,n){return n in e()}})}function Oa(e){let t=/(\/?\:[^\/]+)\?/.exec(e);if(!t)return[e];let n=e.slice(0,t.index),r=e.slice(t.index+t[0].length),i=[n,n+=t[1]];for(;t=/^(\/\:[^\/]+)\?/.exec(r);)i.push(n+=t[1]),r=r.slice(t[0].length);return Oa(r).reduce((e,t)=>[...e,...i.map(e=>e+t)],[])}var ka=100;const Aa=de(),ja=de();function Ma(e,t=``){let{component:n,preload:r,load:i,children:a,info:o}=e,s=!a||Array.isArray(a)&&!a.length,c={key:e,component:n,preload:r||i,info:o};return Pa(e.path).reduce((n,r)=>{for(let i of Oa(r)){let a=Sa(t,i),o=s?a:a.split(`/*`,1)[0];o=o.split(`/`).map(e=>e.startsWith(`:`)||e.startsWith(`*`)?e:encodeURIComponent(e)).join(`/`),n.push({...c,originalPath:r,pattern:o,matcher:wa(o,!s,e.matchFilters)})}return n},[])}function Na(e,t=0){return{routes:e,score:Ea(e[e.length-1])*1e4-t,matcher(t){let n=[];for(let r=e.length-1;r>=0;r--){let i=e[r],a=i.matcher(t);if(!a)return null;n.unshift({...a,route:i})}return n}}}function Pa(e){return Array.isArray(e)?e:[e]}function Fa(e,t=``,n=[],r=[]){let i=Pa(e);for(let e=0,a=i.length;e<a;e++){let a=i[e];if(a&&typeof a==`object`){a.hasOwnProperty(`path`)||(a.path=``);let e=Ma(a,t);for(let t of e){n.push(t);let e=Array.isArray(a.children)&&a.children.length===0;if(a.children&&!e)Fa(a.children,t.pattern,n,r);else{let e=Na([...n],r.length);r.push(e)}n.pop()}}}return n.length?r:r.sort((e,t)=>t.score-e.score)}function Ia(e,t){for(let n=0,r=e.length;n<r;n++){let r=e[n].matcher(t);if(r)return r}return[]}function La(e,t,n){let r=new URL(ya),i=D(t=>{let n=e();try{return new URL(n,r)}catch{return console.error(`Invalid path ${n}`),t}},r,{equals:(e,t)=>e.href===t.href}),a=D(()=>i().pathname),o=D(()=>i().search,!0),s=D(()=>i().hash),c=()=>``,l=re(o,()=>Ca(i()));return{get pathname(){return a()},get search(){return o()},get hash(){return s()},get state(){return t()},get key(){return c()},query:n?n(l):Da(l)}}var Ra;function za(){return Ra}function Ba(e,t,n,r={}){let{signal:[i,a],utils:o={}}=e,s=o.parsePath||(e=>e),c=o.renderPath||(e=>e),l=o.beforeLeave||fa(),u=xa(``,r.base||``);if(u===void 0)throw Error(`${u} is not a valid base path`);u&&!i().value&&a({value:u,replace:!0,scroll:!1});let[d,f]=w(!1),p,m=(e,t)=>{t.value===h()&&t.state===_()||(p===void 0&&f(!0),Ra=e,p=t,ce(()=>{p===t&&(g(p.value),v(p.state),qe(),x[1](e=>e.filter(e=>e.pending)))}).finally(()=>{p===t&&O(()=>{Ra=void 0,e===`navigate`&&ie(p),f(!1),p=void 0})}))},[h,g]=w(i().value),[_,v]=w(i().state),y=La(h,_,o.queryWrapper),b=[],x=w([]),S=D(()=>typeof r.transformUrl==`function`?Ia(t(),r.transformUrl(y.pathname)):Ia(t(),y.pathname)),C=()=>{let e=S(),t={};for(let n=0;n<e.length;n++)Object.assign(t,e[n].params);return t},ee=o.paramsWrapper?o.paramsWrapper(C,t):Da(C),E={pattern:u,path:()=>u,outlet:()=>null,resolvePath(e){return xa(u,e)}};return T(re(i,e=>m(`native`,e),{defer:!0})),{base:E,location:y,params:ee,isRouting:d,renderPath:c,parsePath:s,navigatorFactory:ne,matches:S,beforeLeave:l,preloadRoute:A,singleFlight:r.singleFlight===void 0?!0:r.singleFlight,submissions:x};function te(e,t,n){k(()=>{if(typeof t==`number`){t&&(o.go?o.go(t):console.warn(`Router integration does not support relative routing`));return}let r=!t||t[0]===`?`,{replace:i,resolve:a,scroll:s,state:c}={replace:!1,resolve:!r,scroll:!0,...n},u=a?e.resolvePath(t):xa(r&&y.pathname||``,t);if(u===void 0)throw Error(`Path '${t}' is not a routable path`);if(b.length>=ka)throw Error(`Too many redirects`);let d=h();(u!==d||c!==_())&&l.confirm(u,n)&&(b.push({value:d,replace:i,scroll:s,state:_()}),m(`navigate`,{value:u,state:c}))})}function ne(e){return e=e||fe(ja)||E,(t,n)=>te(e,t,n)}function ie(e){let t=b[0];t&&(a({...e,replace:t.replace,scroll:t.scroll}),b.length=0)}function A(e,r){let i=Ia(t(),e.pathname),a=Ra;for(let t in Ra=`preload`,i){let{route:a,params:o}=i[t];a.component&&a.component.preload&&a.component.preload();let{preload:s}=a;r&&s&&se(n(),()=>s({params:o,location:{pathname:e.pathname,search:e.search,hash:e.hash,query:Ca(e),state:null,key:``},intent:`preload`}))}Ra=a}}function Va(e,t,n,r){let{base:i,location:a,params:o}=e,{pattern:s,component:c,preload:l}=r().route,u=D(()=>r().path);c&&c.preload&&c.preload();let d=l?l({params:o,location:a,intent:Ra||`initial`}):void 0;return{parent:t,pattern:s,path:u,outlet:()=>c?P(c,{params:o,location:a,data:d,get children(){return n()}}):n(),resolvePath(e){return xa(i.path(),e,u())}}}const Ha=e=>t=>{let{base:n}=t,r=pe(()=>t.children),i=D(()=>Fa(r(),t.base||``)),a,o=Ba(e,i,()=>a,{base:n,singleFlight:t.singleFlight,transformUrl:t.transformUrl});return e.create&&e.create(o),P(Aa.Provider,{value:o,get children(){return P(Ua,{routerState:o,get root(){return t.root},get preload(){return t.rootPreload||t.rootLoad},get children(){return[Je(()=>(a=j())&&null),P(Wa,{routerState:o,get branches(){return i()}})]}})}})};function Ua(e){let t=e.routerState.location,n=e.routerState.params,r=D(()=>e.preload&&k(()=>{e.preload({params:n,location:t,intent:za()||`initial`})}));return P(F,{get when(){return e.root},keyed:!0,get fallback(){return e.children},children:i=>P(i,{params:n,location:t,get data(){return r()},get children(){return e.children}})})}function Wa(e){let t=[],n,r=D(re(e.routerState.matches,(i,a,o)=>{let s=a&&i.length===a.length,c=[];for(let n=0,l=i.length;n<l;n++){let l=a&&a[n],u=i[n];o&&l&&u.route.key===l.route.key?c[n]=o[n]:(s=!1,t[n]&&t[n](),C(i=>{t[n]=i,c[n]=Va(e.routerState,c[n-1]||e.routerState.base,Ga(()=>r()[n+1]),()=>{let t=e.routerState.matches();return t[n]??t[0]})}))}return t.splice(i.length).forEach(e=>e()),o&&s?o:(n=c[0],c)}));return Ga(()=>r()&&n)()}var Ga=e=>()=>P(F,{get when(){return e()},keyed:!0,children:e=>P(ja.Provider,{value:e,get children(){return e.outlet()}})});const Ka=e=>{let t=pe(()=>e.children);return Ve(e,{get children(){return t()}})};function qa([e,t],n,r){return[n?()=>n(e()):e,r?e=>t(r(e)):t]}function Ja(t){let n=!1,r=e=>typeof e==`string`?{value:e}:e,i=qa(w(r(t.get()),{equals:(e,t)=>e.value===t.value&&e.state===t.state}),void 0,r=>(!n&&t.set(r),e.registry&&!e.done&&(e.done=!0),r));return t.init&&A(t.init((e=t.get())=>{n=!0,i[1](r(e)),n=!1})),Ha({signal:i,create:t.create,utils:t.utils})}function Ya(e,t,n){return e.addEventListener(t,n),()=>e.removeEventListener(t,n)}function Xa(e,t){let n=e&&document.getElementById(e);n?n.scrollIntoView():t&&window.scrollTo(0,0)}const Za=new Map;function Qa(e=!0,t=!1,n=`/_server`,r){return i=>{let a=i.base.path(),o=i.navigatorFactory(i.base),s,c;function l(e){return e.namespaceURI===`http://www.w3.org/2000/svg`}function u(e){if(e.defaultPrevented||e.button!==0||e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)return;let n=e.composedPath().find(e=>e instanceof Node&&e.nodeName.toUpperCase()===`A`);if(!n||t&&!n.hasAttribute(`link`))return;let r=l(n),i=r?n.href.baseVal:n.href;if((r?n.target.baseVal:n.target)||!i&&!n.hasAttribute(`state`))return;let o=(n.getAttribute(`rel`)||``).split(/\s+/);if(n.hasAttribute(`download`)||o&&o.includes(`external`))return;let s=r?new URL(i,document.baseURI):new URL(i);if(!(s.origin!==window.location.origin||a&&s.pathname&&!s.pathname.toLowerCase().startsWith(a.toLowerCase())))return[n,s]}function d(e){let t=u(e);if(!t)return;let[n,r]=t,a=i.parsePath(r.pathname+r.search+r.hash),s=n.getAttribute(`state`);e.preventDefault(),o(a,{resolve:!1,replace:n.hasAttribute(`replace`),scroll:!n.hasAttribute(`noscroll`),state:s?JSON.parse(s):void 0})}function f(e){let t=u(e);if(!t)return;let[n,a]=t;r&&(a.pathname=r(a.pathname)),i.preloadRoute(a,n.getAttribute(`preload`)!==`false`)}function p(e){clearTimeout(s);let t=u(e);if(!t)return c=null;let[n,a]=t;c!==n&&(r&&(a.pathname=r(a.pathname)),s=setTimeout(()=>{i.preloadRoute(a,n.getAttribute(`preload`)!==`false`),c=n},20))}function m(e){if(e.defaultPrevented)return;let t=e.submitter&&e.submitter.hasAttribute(`formaction`)?e.submitter.getAttribute(`formaction`):e.target.getAttribute(`action`);if(!t)return;if(!t.startsWith(`https://action/`)){let e=new URL(t,ya);if(t=i.parsePath(e.pathname+e.search),!t.startsWith(n))return}if(e.target.method.toUpperCase()!==`POST`)throw Error(`Only POST forms are supported for Actions`);let r=Za.get(t);if(r){e.preventDefault();let t=new FormData(e.target,e.submitter);r.call({r:i,f:e.target},e.target.enctype===`multipart/form-data`?t:new URLSearchParams(t))}}Qe([`click`,`submit`]),document.addEventListener(`click`,d),e&&(document.addEventListener(`mousemove`,p,{passive:!0}),document.addEventListener(`focusin`,f,{passive:!0}),document.addEventListener(`touchstart`,f,{passive:!0})),document.addEventListener(`submit`,m),A(()=>{document.removeEventListener(`click`,d),e&&(document.removeEventListener(`mousemove`,p),document.removeEventListener(`focusin`,f),document.removeEventListener(`touchstart`,f)),document.removeEventListener(`submit`,m)})}}function $a(e){let t=e.replace(/^.*?#/,``);if(!t.startsWith(`/`)){let[,e=`/`]=window.location.hash.split(`#`,2);return`${e}#${t}`}return t}function eo(e){let t=()=>window.location.hash.slice(1),n=fa();return Ja({get:t,set({value:e,replace:t,scroll:n,state:r}){t?window.history.replaceState(ha(r),``,`#`+e):window.history.pushState(r,``,`#`+e);let i=e.indexOf(`#`);Xa(i>=0?e.slice(i+1):``,n),ma()},init:e=>Ya(window,`hashchange`,ga(e,e=>!n.confirm(e&&e<0?e:t()))),create:Qa(e.preload,e.explicitLinks,e.actionBase),utils:{go:e=>window.history.go(e),renderPath:e=>`#${e}`,parsePath:$a,beforeLeave:n}})(e)}function to(e,t){let n,r=()=>!n||n.state===`unresolved`?void 0:n.latest;[n]=ne(()=>ro(e,ae(()=>k(r),()=>void 0)),e=>e,t);let i=(()=>n());return Object.defineProperty(i,`latest`,{get(){return n.latest}}),i}var no=class e{static all(){return new e}static allSettled(){return new e}static any(){return new e}static race(){return new e}static reject(){return new e}static resolve(){return new e}catch(){return new e}then(){return new e}finally(){return new e}};function ro(t,n){if(!e.context)return t(n);let r=fetch,i=Promise;try{return window.fetch=()=>new no,Promise=no,t(n)}finally{window.fetch=r,Promise=i}}function io(e){return new Worker(``+new URL(`worker_job-ByuTpgbN.js`,import.meta.url).href,{type:`module`,name:e?.name})}var ao=de();const oo=()=>fe(ao),so=e=>{let t=new io;t.onmessage=e=>{e.data===`ready`&&(r(`ready`,!0),t.postMessage({t:`list`})),e.data.t===`progress`&&r(`progress`,e.data.d),e.data.t===`list`&&i(e.data.d),e.data.t===`run_on_skips`&&u(e.data.d),e.data.t===`run_on_one`&&o(e.data.d)};let[n,r]=Wi({ready:!1,progress:void 0}),i,a=to(()=>new Promise(e=>i=e)),o,[s,c]=w(void 0),l=to(()=>{let e=s();return e&&t.postMessage({t:`one`,d:e}),new Promise(e=>o=e)}),u,[d,f]=w(void 0),p=to(()=>{let e=d();return e&&t.postMessage({t:`batch`,d:e}),new Promise(e=>u=e)});return P(ao.Provider,{value:[{get progress(){return n.progress},get list(){return a()},get run_on_list(){return p()},get run_on_one(){return l()}},{one(e,t,n){c({id:e,program:t,cursor:n})},batch(e){f({program:e})}}],get children(){return e.children}})};var co=I(`<div class="flex h-screen bg-stone-200"><div class=flex-2><div class="flex flex-col"><div class=h-150></div></div></div><div class="flex-2 min-h-0 overflow-y-auto"></div><div class=flex-2><div><div></div><div>`),lo=I(`<div class="px-2 py-1 bg-red-500 text-white">`),uo=I(`<div class="bg-amber-400 p-2">`),fo=I(`<div class="bg-emerald-400 p-2">`),po=I(`<div class="flex flex-col overflow-y-scroll max-h-30">`),mo=I(`<div><div class="text-sm font-bold ml-0.5 mr-2">.</div><div><a class=text-blue-800 target=_blank></a></div><div class=flex-2></div><div class="text-xs flex-1">`),ho=I(`<div class="relative overflow-x-auto"><div class="px-1 py-1 bg-amber-800 text-white tracking-wide">: <!> rows</div><div class="overflow-y-auto max-h-40"><table class="min-w-full divide-y divide-gray-200"><thead class=bg-gray-50></thead><tbody class="bg-white divide-y divide-gray-200">`),go=I(`<tr class=overflow-y-scroll>`),_o=I(`<th scope=col class="px-6 py-2 text-left text-xs font-meidum text-gray-500 tracking-wider">.`),vo=I(`<tr>`),yo=I(`<td class="px-6 py-0 whitespace-nowrap">`);function bo(){return P(eo,{root:xo,get children(){return P(Ka,{path:`/`,component:So})}})}function xo(e){return Je(()=>e.children)}function So(){return P(so,{get children(){return P(Co,{})}})}function Co(){let[e,{one:t}]=oo(),[n,r]=Wi({program:``,selected_puzzle:void 0,get run_on_one(){return e.run_on_one}}),[i,a]=Ji(Wi({selected_puzzle:void 0}),{name:`.morchess4.app-state.v1`});function o(){r(`selected_puzzle`,i.selected_puzzle)}function s(){a(`selected_puzzle`,n.selected_puzzle)}let c=D(()=>n.run_on_one?.result.relations?.find(e=>e.name===`solution`)?.rows[0]?.line??`--`),l=()=>{n.selected_puzzle!==void 0&&t(n.selected_puzzle.id,n.program,n.selected_puzzle.i_cursor)},u=D(()=>{if(e.list!==void 0){if(o(),n.selected_puzzle===void 0||!e.list.find(e=>e.id===n.selected_puzzle.id)){let t=e.list[0];r(`selected_puzzle`,{id:t.id,puzzle:t,i_cursor:0,fen:t.move_fens[0],last_move:gi(t.moves.split(` `)[0]),solution:t.sans.join(` `)}),s()}l()}return e.list?.find(e=>e.id===n.selected_puzzle?.id)}),d=e=>{r(`program`,e),l()},f=e=>{r(`selected_puzzle`,{id:e.id,puzzle:e,i_cursor:0,fen:e.move_fens[0],last_move:gi(e.moves.split(` `)[0]),solution:e.sans.join(` `)}),s(),l()},p=D(()=>n.run_on_one?.result.relations?.slice(0)),[m,h]=w(void 0),g=()=>{let e=m();return p()?.sort((t,n)=>t.name===e?-1:0)},_=()=>{if(n.selected_puzzle===void 0)return;let e=n.selected_puzzle.i_cursor-1,t=n.selected_puzzle.puzzle.move_fens[e];t&&(O(()=>{r(`selected_puzzle`,`i_cursor`,e),r(`selected_puzzle`,`fen`,t)}),s(),l())},v=()=>{if(n.selected_puzzle===void 0)return;let e=n.selected_puzzle.i_cursor+1,t=n.selected_puzzle.puzzle.move_fens[e];t&&(O(()=>{r(`selected_puzzle`,`i_cursor`,e),r(`selected_puzzle`,`fen`,t)}),s(),l())},y=e=>{e<0?_():v()},b=e=>{switch(e.key){case`ArrowRight`:v();break;case`ArrowLeft`:_();break;case`ArrowDown`:x();break;case`ArrowUp`:S();break;default:return}e.preventDefault()};document.addEventListener(`keydown`,b),A(()=>{document.removeEventListener(`keydown`,b)});let x=()=>{if(e.list===void 0)return;let t=e.list.findIndex(e=>e.id===u()?.id);t>-1&&f(e.list[(t+1+e.list.length)%e.list.length])},S=()=>{if(e.list===void 0)return;let t=e.list.findIndex(e=>e.id===u()?.id);t>-1&&f(e.list[(t-1+e.list.length)%e.list.length])},C=e=>{switch(e){case`next`:x();break;case`prev`:S();break;case`copy`:navigator.clipboard.writeText(n.program);break;default:return!1}return!0};return(()=>{var e=co(),t=e.firstChild,r=t.firstChild,i=r.firstChild,a=t.nextSibling,o=a.nextSibling.firstChild.firstChild,s=o.nextSibling;return L(i,P(ta,{on_command_execute:C,on_save_program:d,on_set_column_under_cursor:h})),L(r,P(F,{get when(){return n.run_on_one?.result.error},children:e=>(()=>{var t=lo();return L(t,e),t})()}),null),L(a,P(Ge,{get each(){return g()},children:e=>P(Eo,{relation:e})})),L(o,P(F,{get when(){return u()?.id},children:e=>P(wo,{get selected(){return e()},on_select_puzzle:f})})),L(s,P(F,{get when(){return n.selected_puzzle},children:e=>[P(Oi,{on_wheel:y,get fen(){return e().fen},get last_move(){return e().last_move}}),(()=>{var t=uo();return L(t,()=>e().solution),t})(),(()=>{var e=fo();return L(e,c),e})()]})),e})()}function wo(e){let[t]=oo();return(()=>{var n=po();return L(n,P(Ge,{get each(){return t.list},children:(t,n)=>P(To,{get n(){return n()+1},get selected(){return e.selected===t.id},puzzle:t,on_click:()=>e.on_select_puzzle(t)})})),n})()}function To(e){E(()=>{e.selected&&t.scrollIntoView({block:`nearest`})});let t;return(()=>{var n=mo(),r=n.firstChild,i=r.firstChild,a=r.nextSibling,o=a.firstChild,s=a.nextSibling.nextSibling;tt(n,`click`,e.on_click,!0);var c=t;return typeof c==`function`?nt(c,n):t=n,L(r,()=>e.n,i),L(o,()=>e.puzzle.id),L(s,()=>e.puzzle.tags),T(t=>{var r=`flex items-center px-1 py-1 ${e.selected?`bg-amber-200`:`bg-slate-400`} hover:bg-gray-200 cursor-pointer`,i=e.puzzle.link;return r!==t.e&&et(n,t.e=r),i!==t.t&&$e(o,`href`,t.t=i),t},{e:void 0,t:void 0}),n})()}function Eo(e){let t=D(()=>e.relation.rows.slice(0,100)),n=D(()=>t()[0]);return(()=>{var r=ho(),i=r.firstChild,a=i.firstChild,o=a.nextSibling;o.nextSibling;var s=i.nextSibling.firstChild.firstChild,c=s.nextSibling;return L(i,()=>e.relation.name,a),L(i,()=>e.relation.rows.length,o),L(s,P(F,{get when(){return n()},children:e=>P(Do,{get row_header(){return e()}})})),L(c,P(Ge,{get each(){return t()},children:e=>P(Oo,{row:e})})),r})()}function Do(e){let t=[...Object.keys(e.row_header)];return(()=>{var e=go();return L(e,P(Ge,{each:t,children:e=>(()=>{var t=_o();return t.firstChild,L(t,e,null),t})()})),e})()}function Oo(e){let t=D(()=>Object.values(e.row));return(()=>{var e=vo();return L(e,P(Ge,{get each(){return t()},children:e=>(()=>{var t=yo();return L(t,e),t})()})),e})()}Qe([`click`]),Ze(()=>P(bo,{}),document.getElementById(`root`));